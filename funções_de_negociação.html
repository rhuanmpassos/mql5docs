<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun√ß√µes de Negocia√ß√£o - MQL5 Docs</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
</head>
<body>
    <nav class="sidebar">
        <div class="logo">
            <h1>MQL5 Docs</h1>
            <p>Documenta√ß√£o Completa</p>
        </div>
        <div class="search-box">
            <input type="text" id="search" placeholder="Buscar..." onkeyup="filterNav()">
        </div>
        <ul class="nav-list" id="nav-list">
            <li class=""><a href="index.html">üìö √çndice</a></li>
            <li class=""><a href="introducao.html">Introducao</a></li>
<li class=""><a href="refer√™ncia_mql5.html">Refer√™ncia MQL5</a></li>
<li class=""><a href="elementos_b√°sicos_da_linguagem.html">Elementos B√°sicos da Linguagem</a></li>
<li class=""><a href="constantes,_enumeradores_e_estruturas.html">Constantes, Enumeradores e Estruturas</a></li>
<li class=""><a href="programas_mql5.html">Programas MQL5</a></li>
<li class=""><a href="vari√°veis_predefinidas.html">Vari√°veis Predefinidas</a></li>
<li class=""><a href="fun√ß√µes_comuns.html">Fun√ß√µes Comuns</a></li>
<li class=""><a href="fun√ß√µes_para_array.html">Fun√ß√µes para Array</a></li>
<li class=""><a href="m√©todos_matriciais_e_vetoriais.html">M√©todos matriciais e vetoriais</a></li>
<li class=""><a href="fun√ß√µes_de_convers√£o.html">Fun√ß√µes de Convers√£o</a></li>
<li class=""><a href="fun√ß√µes_matem√°ticas.html">Fun√ß√µes Matem√°ticas</a></li>
<li class=""><a href="fun√ß√µes_de_string.html">Fun√ß√µes de String</a></li>
<li class=""><a href="data_e_hora.html">Data e Hora</a></li>
<li class=""><a href="informa√ß√µes_de_conta.html">Informa√ß√µes de Conta</a></li>
<li class=""><a href="verificando_estado.html">Verificando Estado</a></li>
<li class=""><a href="manipula√ß√£o_de_eventos.html">Manipula√ß√£o de eventos</a></li>
<li class=""><a href="informa√ß√µes_de_mercado.html">Informa√ß√µes de Mercado</a></li>
<li class=""><a href="calend√°rio_econ√¥mico.html">Calend√°rio econ√¥mico</a></li>
<li class=""><a href="s√©ries_temporais_e_acesso_a_indicadores.html">S√©ries Temporais e Acesso a Indicadores</a></li>
<li class=""><a href="s√≠mbolos_personalizados.html">S√≠mbolos personalizados</a></li>
<li class=""><a href="opera√ß√µes_de_gr√°ficos.html">Opera√ß√µes de Gr√°ficos</a></li>
<li class="active"><a href="fun√ß√µes_de_negocia√ß√£o.html">Fun√ß√µes de Negocia√ß√£o</a></li>
<li class=""><a href="gerenciamento_de_sinais.html">Gerenciamento de sinais</a></li>
<li class=""><a href="fun√ß√µes_de_rede.html">Fun√ß√µes de rede</a></li>
<li class=""><a href="vari√°veis_globais_do_terminal.html">Vari√°veis Globais do Terminal</a></li>
<li class=""><a href="fun√ß√µes_de_arquivo.html">Fun√ß√µes de Arquivo</a></li>
<li class=""><a href="indicadores_customizados.html">Indicadores Customizados</a></li>
<li class=""><a href="fun√ß√µes_de_objeto.html">Fun√ß√µes de Objeto</a></li>
<li class=""><a href="indicadores_t√©cnicos.html">Indicadores T√©cnicos</a></li>
<li class=""><a href="trabalhando_com_resultados_de_otimiza√ß√£o.html">Trabalhando com Resultados de Otimiza√ß√£o</a></li>
<li class=""><a href="trabalhando_com_eventos.html">Trabalhando com Eventos</a></li>
<li class=""><a href="trabalhando_com_opencl.html">Trabalhando com OpenCL</a></li>
<li class=""><a href="trabalhar_com_bancos_de_dados.html">Trabalhar com bancos de dados</a></li>
<li class=""><a href="trabalho_com_directx.html">Trabalho com DirectX</a></li>
<li class=""><a href="metatrader_para_python.html">MetaTrader para Python</a></li>
<li class=""><a href="modelos_onnx.html">Modelos ONNX</a></li>
<li class=""><a href="biblioteca_padr√£o.html">Biblioteca Padr√£o</a></li>
<li class=""><a href="migrando_do_mql4.html">Migrando do MQL4</a></li>
<li class=""><a href="lista_de_fun√ß√µes_mql5.html">Lista de Fun√ß√µes MQL5</a></li>
<li class=""><a href="lista_de_constantes_mql5.html">Lista de Constantes MQL5</a></li>

        </ul>
    </nav>
    
    <main class="content">
        <header>
            <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <h1>Fun√ß√µes de Negocia√ß√£o</h1>
        </header>
        
        <article>
            <p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2284
<h3>Fun√ß√µes de Negocia√ß√£o (Trade)</h3>
Este √© o grupo de fun√ß√µes destina-se √† gest√£o de atividades de negocia√ß√£o.
Antes de come√ßar a estudar as fun√ß√µes da plataforma, voc√™ deve compreender claramente todos os
termos e fun√ß√µes: ordem, transa√ß√£o e posi√ß√£o:
¬∑ Ordem ‚Äî solicita√ß√£o feita pela empresa de corretagem para comprar ou vender um instrumento
financeiro. Existem dois tipos de ordens b√°sicos: de mercado e pendentes. Al√©m disso, existem
ordens especiais Take Profit e Stop Loss.
¬∑ Transa√ß√£o ‚Äî fato da compra ou venda de um instrumento financeiro. A compra (Buy) acontece
segundo o pre√ßo de demanda (Ask) e a venda acontece segundo o pre√ßo de oferta (Bid). A transa√ß√£o
pode ser feita como resultado da execu√ß√£o de uma ordem de mercado ou ativa√ß√£o de uma opera√ß√£o
pendente. Voc√™ deve ter em conta que, em alguns casos, v√°rias transa√ß√µes podem ser o resultado
da execu√ß√£o de uma ordem.
¬∑ Posi√ß√£o ‚Äî obriga√ß√£o de mercado, n√∫mero de contratos comprados ou vendidos de um instrumento
financeiro. Uma posi√ß√£o longa (Long) √© um instrumento financeiro adquirido com base no aumento
do pre√ßo e uma posi√ß√£o curta (Short) √© uma obriga√ß√£o colocada com base na diminui√ß√£o de pre√ßos
no futuro.
Informa√ß√µes gerais sobre opera√ß√µes de negocia√ß√£o est√£o dispon√≠veis no manual do usu√°rio do terminal
do cliente.
As fun√ß√µes de negocia√ß√£o podem ser usadas em Experts Advisors e scripts. Fun√ß√µes de negocia√ß√£o s√≥
podem ser chamadas se as propriedades do Expert Advisor ou script estiverem habilitadas na sua
caixa de controle &quot;Permitir negocia√ß√£o ao vivo&quot;.
A negocia√ß√£o pode ser permitida ou proibida dependendo de v√°rios fatores descritos na se√ß√£o Trade
Permission.
<h3>Fun√ß√£o</h3>
<h3>A√ß√£o</h3>
<h3>OrderCalcMargin</h3>
Calcula a margem necess√°ria para o tipo de ordem especificado, na
moeda de dep√≥sito
<h3>OrderCalcProfit</h3>
Calcula o lucro com base nos par√¢metros passados‚Äã, na moeda de
dep√≥sito
<h3>OrderCheck</h3>
Verifica se h√° fundos suficientes para executar a opera√ß√£o de
neg√≥cio necess√°ria.
<h3>OrderSend</h3>
Envia pedidos de neg√≥cios para um servidor
<h3>OrderSendAsync</h3>
De forma ass√≠ncrona envia pedidos de com√©rcio sem esperar a
resposta da negocia√ß√£o do servidor de neg√≥cio
<h3>PositionsTotal</h3>
Retorna o n√∫mero de posi√ß√µes em aberto
<h3>PositionGetSymbol</h3>
Retorna o s√≠mbolo correspondente √† posi√ß√£o aberta
<h3>PositionSelect</h3>
Escolhe uma posi√ß√£o aberta para posteriormente trabalhar com ele
<h3>PositionSelectByTicket</h3>
Selects a position to work with by the ticket number specified in it
<h3>PositionGetDouble</h3>
Retorna a propriedade solicitado de uma posi√ß√£o aberta (double)</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2285
<h3>Fun√ß√£o</h3>
<h3>A√ß√£o</h3>
<h3>PositionGetInteger</h3>
Retorna a propriedade solicitada uma posi√ß√£o aberta (datetime ou
int)
<h3>PositionGetString</h3>
Retorna a propriedade solicitada uma posi√ß√£o aberta (string)
<h3>PositionGetTicket</h3>
Returns the ticket of the position with the specified index in the list
of open positions
<h3>OrdersTotal</h3>
<h3>Retorna o n√∫mero de ordens</h3>
<h3>OrderGetTicket</h3>
Devolver o bilhete de uma ordem correspondente
<h3>OrderSelect</h3>
Seleciona uma ordem para posteriormente trabalhar com ele
<h3>OrderGetDouble</h3>
Retorna a propriedade solicitada da ordem (double)
<h3>OrderGetInteger</h3>
Retorna a propriedade solicitada da ordem (datetime ou int)
<h3>OrderGetString</h3>
Retorna a propriedade solicitada da ordem (string)
<h3>HistorySelect</h3>
Recupera o hist√≥rico de transa√ß√µes e ordens para o per√≠odo do
tempo de servidor especificado
<h3>HistorySelectByPosition</h3>
Pedido de hist√≥rico de acordo com um identificador de posi√ß√£o
especificada.
<h3>HistoryOrderSelect</h3>
Seleciona uma ordem no hist√≥rico para posteriormente trabalhar
com ele
<h3>HistoryOrdersTotal</h3>
Retorna o n√∫mero de pedidos no hist√≥rico
<h3>HistoryOrderGetTicket</h3>
Retornar bilhete ordem de uma ordem correspondente no hist√≥rico
<h3>HistoryOrderGetDouble</h3>
Retorna a propriedade solicitada de uma ordem no hist√≥rico
(double)
<h3>HistoryOrderGetInteger</h3>
Retorna a propriedade solicitada de uma ordem no hist√≥rico
(datetime ou int)
<h3>HistoryOrderGetString</h3>
Retorna a propriedade solicitada de uma ordem no hist√≥rico (string)
<h3>HistoryDealSelect</h3>
Seleciona um neg√≥cio no hist√≥rico para posterior chamada atrav√©s
de fun√ß√µes apropriadas
<h3>HistoryDealsTotal</h3>
Retorna o n√∫mero de ofertas no hist√≥rico
<h3>HistoryDealGetTicket</h3>
Devolve um bilhete de uma quantidade correspondente no hist√≥rico
<h3>HistoryDealGetDouble</h3>
Retorna a propriedade solicitada de um acordo no hist√≥rico (double)
<h3>HistoryDealGetInteger</h3>
Retorna a propriedade solicitada de um acordo no hist√≥rico
(datetime ou int)
<h3>HistoryDealGetString</h3>
Retorna a propriedade solicitada de uma opera√ß√£o no hist√≥rico
(string)</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2286
<h3>OrderCalcMargin</h3>
A fun√ß√£o calcula a margem necess√°ria para o tipo de ordem especificado, considerando a conta atual e
o mercado do momento, sem levar em conta as ordens pendentes ou posi√ß√µes abertas. Ela possibilita
a avalia√ß√£o da margem para a opera√ß√£o de negocia√ß√£o planejada. O valor retornado √© na moeda da
conta. 
</p>
<pre><code class="language-mql5">
bool¬† OrderCalcMargin(
   ENUM_ORDER_TYPE¬†      action,¬†          // tipo de ordem
   string¬†               symbol,¬†          // nome do s√≠mbolo
   double¬†               volume,¬†          // volume
   double¬†               price,¬†           // pre√ßo aberto
   double&amp;               margin ¬†          // valor para a obten√ß√£o do valor da margem
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
action
[in]  O tipo de ordem pode ser um dos valores da enumera√ß√£o ENUM_ORDER_TYPE. 
symbol
[in]  Nome do ativo.
volume
[in]  Volume das opera√ß√µes de negocia√ß√£o (com√©rcio).
price
[in]  Pre√ßo de abertura.
margin
[out]  A vari√°vel onde o valor da margem requerida ser√° armazenado, caso a fun√ß√£o seja
executada com sucesso. O c√°lculo √© feito como se n√£o houvesse ordens pendentes ou posi√ß√µes
abertas na conta atual. O valor da margem depende de v√°rios fatores e pode mudar conforme o
ambiente de mercado.
<h3>Valor retornado</h3>
A fun√ß√£o retorna true em caso de sucesso, caso contr√°rio ela retorna false. Para obter informa√ß√µes
sobre o erro, chame a fun√ß√£o GetLastError().
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#define   VOLUME     1.0   // // volume da ordem
#define   DEVIATION  100   // // dist√¢ncia de coloca√ß√£o da ordem pendente
#define   STOP_LIMIT 50    // // dist√¢ncia do StopLimit da ordem
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
   string currency=AccountInfoString(ACCOUNT_CURRENCY);</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2287
</p>
<pre><code class="language-mql5">
   int array_types[8]={ORDER_TYPE_BUY,
                       ORDER_TYPE_SELL,
                       ORDER_TYPE_BUY_LIMIT,
                       ORDER_TYPE_SELL_LIMIT,
                       ORDER_TYPE_BUY_STOP,
                       ORDER_TYPE_SELL_STOP,
                       ORDER_TYPE_BUY_STOP_LIMIT,
                       ORDER_TYPE_SELL_STOP_LIMIT };
                       
//--- no loop pelo array de tipos de ordens
   for(int i=0; i&lt;(int)array_types.Size(); i++)
     {
      //--- dependendo do tipo de ordem, obtemos o tipo ORDER_TYPE_BUY ou ORDER_TYPE_S
      ENUM_ORDER_TYPE type=MarketOrderByOrderType((ENUM_ORDER_TYPE)array_types[i]);
      
      //--- dependendo do tipo de ordem, obtemos o pre√ßo
      double price=PriceByOrderType(_Symbol, type);
      
      //--- obtemos o tamanho da margem necess√°ria para o tipo de ordem especificado e
      double margin=EMPTY_VALUE;
      ResetLastError();
      if(!OrderCalcMargin(type, _Symbol, VOLUME, price, margin))
        {
         Print(&quot;OrderCalcMargin() failed. Error &quot;,GetLastError());
         continue;
        }
      //--- imprimimos o resultado no log
      PrintFormat(&quot;Margin required for %.2f %s order at price %.*f on %s symbol: %.2f 
     }
   /*
¬†  Resultado:
   Margin required for 1.00 Buy order at price 1.31668 on GBPUSD symbol: 1316.68 USD
   Margin required for 1.00 Sell order at price 1.31661 on GBPUSD symbol: 1316.61 USD
   Margin required for 1.00 Buy Limit order at price 1.31568 on GBPUSD symbol: 1315.68
   Margin required for 1.00 Sell Limit order at price 1.31761 on GBPUSD symbol: 1317.6
   Margin required for 1.00 Buy Stop order at price 1.31768 on GBPUSD symbol: 1317.68 
   Margin required for 1.00 Sell Stop order at price 1.31561 on GBPUSD symbol: 1315.61
   Margin required for 1.00 Buy Stop Limit order at price 1.31718 on GBPUSD symbol: 13
   Margin required for 1.00 Sell Stop Limit order at price 1.31611 on GBPUSD symbol: 1
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o tipo de ordem Buy ou Sell com base no tipo de ordem    |
//+------------------------------------------------------------------+
</code></pre>
<p>
ENUM_ORDER_TYPE MarketOrderByOrderType(ENUM_ORDER_TYPE type)
</p>
<pre><code class="language-mql5">
  {
   switch(type)
     {
      case ORDER_TYPE_BUY  : case ORDER_TYPE_BUY_LIMIT  : case ORDER_TYPE_BUY_STOP  : </p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2288
</p>
<pre><code class="language-mql5">
        return(ORDER_TYPE_BUY);
      case ORDER_TYPE_SELL : case ORDER_TYPE_SELL_LIMIT : case ORDER_TYPE_SELL_STOP : 
        return(ORDER_TYPE_SELL);
     }
   return(WRONG_VALUE);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o pre√ßo de abertura com base no tipo de ordem            |
//+------------------------------------------------------------------+
double PriceByOrderType(const string symbol, const ENUM_ORDER_TYPE order_type)
  {
   int     digits=0;
   double  point=0;
   MqlTick tick={};
//--- obtemos o valor do Point do s√≠mbolo
   ResetLastError();
   if(!SymbolInfoDouble(symbol, SYMBOL_POINT, point))
     {
      Print(&quot;SymbolInfoDouble() failed. Error &quot;, GetLastError());
      return 0;
     }
     
//--- obtemos o valor de Digits do s√≠mbolo
   long value=0;
   if(!SymbolInfoInteger(symbol, SYMBOL_DIGITS, value))
     {
      Print(&quot;SymbolInfoInteger() failed. Error &quot;, GetLastError());
      return 0;
     }
   digits=(int)value;
   
//--- obtemos os √∫ltimos pre√ßos do s√≠mbolo
   if(!SymbolInfoTick(symbol, tick))
     {
      Print(&quot;SymbolInfoTick() failed. Error &quot;, GetLastError());
      return 0;
     }
     
//--- dependendo do tipo de ordem, retornamos o pre√ßo
   switch(order_type)
     {
      case ORDER_TYPE_BUY              :  return(tick.ask);
      case ORDER_TYPE_SELL             :  return(tick.bid);
      case ORDER_TYPE_BUY_LIMIT        :  return(NormalizeDouble(tick.ask - DEVIATION 
      case ORDER_TYPE_SELL_LIMIT       :  return(NormalizeDouble(tick.bid + DEVIATION 
      case ORDER_TYPE_BUY_STOP         :  return(NormalizeDouble(tick.ask + DEVIATION 
      case ORDER_TYPE_SELL_STOP        :  return(NormalizeDouble(tick.bid - DEVIATION 
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(NormalizeDouble(tick.ask + DEVIATION </p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2289
</p>
<pre><code class="language-mql5">
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(NormalizeDouble(tick.bid - DEVIATION 
      default                          :  return(0);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE order_type)
  {
   switch(order_type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      case ORDER_TYPE_CLOSE_BY         :  return(&quot;Close By&quot;);
      default                          :  return(&quot;Unknown order type&quot;);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
</code></pre>
<p>
<h3>Tamb√©m Veja</h3>
OrderSend(), Order Properties, Tipos de Opera√ß√µes de Negocia√ß√£o (Trade)</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2290
<h3>OrderCalcProfit</h3>
Essa fun√ß√£o calcula o lucro para a conta atual, considerando as condi√ß√µes de mercado do momento,
com base nos par√¢metros fornecidos. Ela √© utilizada para fazer uma pr√©-avalia√ß√£o do resultado de uma
opera√ß√£o de negocia√ß√£o (com√©rcio). O valor retornado √© na moeda da conta. 
</p>
<pre><code class="language-mql5">
bool¬† OrderCalcProfit(
   ENUM_ORDER_TYPE¬†      action,¬†          // tipo de ordem (ORDER_TYPE_BUY ou ORDER_T
   string¬†               symbol,¬†          // nome do s√≠mbolo
   double¬†               volume,¬†          // volume
   double¬†               price_open,¬†      // pre√ßo de abertura
   double¬†               price_close,¬†     // pre√ßo de fechamento
   double&amp;               profit¬†           // vari√°vel para a obten√ß√£o do valor de luc
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
action
[in]  Tipo de ordem. Porde ser um dos dois valores da enumera√ß√£o ENUM_ORDER_TYPE:
ORDER_TYPE_BUY ou ORDER_TYPE_SELL. 
symbol
[in]  Nome do ativo.
volume
[in]  Volume das opera√ß√µes de negocia√ß√£o (com√©rcio).
price_open
[in]  Pre√ßo de abertura.
price_close
[in]  Pre√ßo de fechamento.
profit
[out]  A vari√°vel onde o valor do lucro √© armazenado, caso a fun√ß√£o seja executada com sucesso.
O valor do lucro estimado depende de muitos fatores, e pode variar em diferentes ambientes de
mercado.
<h3>Valor retornado</h3>
A fun√ß√£o retorna true em caso de sucesso, caso contr√°rio ela retorna false. Se for especificado um
tipo de ordem inv√°lido, a fun√ß√£o retornar√° false. Para informa√ß√µes sobre o erro na ordem, chame
GetLastError().
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#define   VOLUME     1.0   // // volume da ordem
#define   DEVIATION  100   // n√∫mero de pontos at√© o pre√ßo de fechamento
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2291
</p>
<pre><code class="language-mql5">
void OnStart()
  {
   string currency_profit=SymbolInfoString(_Symbol,SYMBOL_CURRENCY_PROFIT);   // moeda
   double close_price=ChartPriceOnDropped(); // o pre√ßo de fechamento ser√° a coordenad
//---
   for(int i=0; i&lt;=ORDER_TYPE_SELL; i++)
     {
      ENUM_ORDER_TYPE order_type=(ENUM_ORDER_TYPE)i;                 // tipo de ordem:
      double open_price=PriceOpenByOrderType(_Symbol, order_type);   // pre√ßo de abert
     
      //--- se o pre√ßo de abertura n√£o for obtido, continuamos o loop
      if(open_price==0)
         continue;
      
      //--- se o pre√ßo de fechamento for zero (script n√£o iniciado arrastando no gr√°fi
      if(close_price==0)
         close_price=(order_type==ORDER_TYPE_BUY ? open_price + DEVIATION * _Point : o
      
      //--- calculamos o tamanho aproximado do lucro para a conta atual e o ambiente d
      double profit=0;
      ResetLastError();
      if(!OrderCalcProfit(order_type, _Symbol, VOLUME, open_price, close_price, profit
        {
         Print(&quot;OrderCalcProfit() failed. Error &quot;, GetLastError());
         continue;
        }
      
      //--- o valor de lucro obtido ser√° impresso no log
      PrintFormat(&quot;Estimated profit for %.2f %s position on %s with opening price of %
                  VOLUME, OrderTypeDescription(order_type), _Symbol, _Digits, open_pri
      
     }
   /*
¬†  Resultado:
   Estimated profit for 1.00 Buy position on EURUSD with opening price of 1.10757 and 
   Estimated profit for 1.00 Sell position on EURUSD with opening price of 1.10753 and
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o pre√ßo de abertura com base no tipo de ordem            |
//+------------------------------------------------------------------+
double PriceOpenByOrderType(const string symbol, const ENUM_ORDER_TYPE order_type)
  {
   MqlTick tick={};
//--- obtemos os √∫ltimos pre√ßos do s√≠mbolo
   if(!SymbolInfoTick(symbol, tick))
     {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2292
</p>
<pre><code class="language-mql5">
      Print(&quot;SymbolInfoTick() failed. Error &quot;, GetLastError());
      return 0;
     }
     
//--- dependendo do tipo de ordem, retornamos o pre√ßo
   switch(order_type)
     {
      case ORDER_TYPE_BUY              :  return(tick.ask);
      case ORDER_TYPE_SELL             :  return(tick.bid);
      default                          :  return(0);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE order_type)
  {
   switch(order_type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      default                          :  return(&quot;Unknown order type&quot;);
     }
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
OrderSend(), Order Properties, Tipos de Opera√ß√µes de Negocia√ß√£o (Trade)</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2293
<h3>OrderCheck</h3>
A fun√ß√£o OrderCheck() verifica se h√° fundos suficientes para executar a respectiva opera√ß√£o de
negocia√ß√£o. Os resultados da verifica√ß√£o s√£o colocadas nos campos da estrutura MqlTradeCheckResult.
</p>
<pre><code class="language-mql5">
bool¬† OrderCheck(
   MqlTradeRequest&amp;¬†      request,¬†     // estrutura solicitada
   MqlTradeCheckResult&amp; ¬† result ¬†      // resultado da estrutura
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
request
[in]  Ponteiro para a estrutura do tipo MqlTradeRequest que descreve a a√ß√£o de negocia√ß√£o
requerida.
result
[in,out]  Ponteiro para a estrutura do tipo MqlTradeCheckResult onde o resultado da verifica√ß√£o √©
colocada.
<h3>Valor retornado</h3>
Se os fundos n√£o s√£o suficientes ou os par√¢metros s√£o preenchidos incorretamente, a fun√ß√£o
retorna false. Em caso de verifica√ß√£o de estruturas (ponteiros) bem sucedida, ele retorna true. No
entanto, isto n√£o indica que a opera√ß√£o solicitada n√£o seja executada com sucesso. Para uma
descri√ß√£o mais detalhada do resultado da execu√ß√£o da fun√ß√£o, analise os campos do resultado da
estrutura. 
Para obter informa√ß√µes sobre o erro, chame a fun√ß√£o GetLastError().
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#define   DEVIATION     5              // desvio permitido do pre√ßo
#define   VOLUME     1.0   // // volume da ordem
#define   EXPERT_MAGIC  123            // MagicNumber
#define   DIRECTION     ORDER_TYPE_BUY // dire√ß√£o da posi√ß√£o aberta (ORDER_TYPE_BUY ou
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- declara√ß√£o e inicializa√ß√£o das estruturas de solicita√ß√£o, verifica√ß√£o e resultad
   MqlTradeRequest     request={};
   MqlTradeCheckResult check  ={};
   MqlTradeResult      result ={};
   
//--- preparamos os par√¢metros da solicita√ß√£o de negocia√ß√£o
   PrepareRequest(_Symbol, DIRECTION, VOLUME, request);
   
//--- verificamos os par√¢metros da solicita√ß√£o de negocia√ß√£o
   ResetLastError();</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2294
</p>
<pre><code class="language-mql5">
   bool res=OrderCheck(request, check);
   if(!res)
     {
      PrintFormat(&quot;Trade request verification completed with error %d\nServer retcode:
      return;
     }
     
//--- a verifica√ß√£o da solicita√ß√£o de negocia√ß√£o foi bem-sucedida, imprimimos no log a
   Print(&quot;Trade request verification completed successfully&quot;);
   MqlTradeCheckResultPrint(check, 14);
   
//--- envio da solicita√ß√£o de negocia√ß√£o
   if(!OrderSend(request, result))
      Print(&quot;OrderSend error &quot;, GetLastError());    // se n√£o for poss√≠vel enviar a so
      
//--- informa√ß√µes sobre a opera√ß√£o
   PrintFormat(&quot;Trade request result: retcode=%u, deal=%I64u, order=%I64u&quot;, result.ret
   /*
¬†  resultado com a negocia√ß√£o autom√°tica desativada no terminal do cliente:
   Trade request verification completed with error 4752
   Server retcode: 10027, comment: AutoTrading disabled by client
   
¬†  ativamos a negocia√ß√£o autom√°tica e verificamos novamente no mercado fechado:
   Experts   automated trading is enabled
   Trade request verification completed successfully
   Retcode:      0
   Balance:      10779.50 USD
   Equity:       10779.50 USD
   Profit:       0.00 USD
   Margin:       1104.79 USD
   Margin free:  9674.71 USD
   Margin level: 975.71 %
   Comment:      Done
   OrderSend error 4756
   Trade request result: retcode=10018, deal=0, order=0
   
¬†  verificamos no mercado aberto:
   Trade request verification completed successfully
   Retcode:      0
   Balance:      10779.50 USD
   Equity:       10779.50 USD
   Profit:       0.00 USD
   Margin:       110.46 USD
   Margin free:  10669.04 USD
   Margin level: 9758.74 %
   Comment:      Done
   Trade request result: retcode=10009, deal=2777010968, order=2802818813
   */
</code></pre>
<p>
  }</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2295
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Prepara√ß√£o de par√¢metros para a solicita√ß√£o de negocia√ß√£o        |
//+------------------------------------------------------------------+
void PrepareRequest(const string symbol, const ENUM_ORDER_TYPE order_type, const doubl
  {
   ENUM_ORDER_TYPE type=(DIRECTION !=ORDER_TYPE_BUY ? ORDER_TYPE_SELL : DIRECTION);
   double price=(DIRECTION==ORDER_TYPE_BUY ? SymbolInfoDouble(Symbol(), SYMBOL_ASK) : 
//--- par√¢metros da solicita√ß√£o
   request.action    = TRADE_ACTION_DEAL; // tipo de opera√ß√£o de negocia√ß√£o
   request.symbol    = symbol;            // s√≠mbolo
   request.volume    = volume;            // volume
   request.type      = type;              // tipo de ordem
   request.price     = price;             // pre√ßo para abertura
   request.deviation = DEVIATION;         // desvio permitido em rela√ß√£o ao pre√ßo
   request.magic     = EXPERT_MAGIC;      // MagicNumber da ordem
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log os campos da estrutura                            |
//| do resultado da verifica√ß√£o da solicita√ß√£o de negocia√ß√£o         |
//+------------------------------------------------------------------+
void MqlTradeCheckResultPrint(const MqlTradeCheckResult &amp;check, const uint header_widt
  {
//--- obtemos a moeda da conta e o n√∫mero de d√≠gitos ap√≥s a v√≠rgula para a moeda da co
   string currency=AccountInfoString(ACCOUNT_CURRENCY);
   int    digits  =(int)AccountInfoInteger(ACCOUNT_CURRENCY_DIGITS);
   
//--- definimos o texto do cabe√ßalho e a largura do campo de cabe√ßalho
//--- se a largura do cabe√ßalho for passada para a fun√ß√£o igual a zero, a largura ser√°
   string header=&quot;Retcode:&quot;;
   uint w=(header_width==0 ? header.Length()+1 : header_width);
//--- imprimimos no log o c√≥digo de retorno com um cabe√ßalho de largura definida
   PrintFormat(&quot;%-*s%-u&quot;, w, header, check.retcode);
   
//--- imprimimos no log o valor do saldo que estar√° dispon√≠vel ap√≥s a execu√ß√£o da oper
   header=&quot;Balance:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   PrintFormat(&quot;%-*s%-.*f %s&quot;, w, header, digits, check.balance, currency);
   
//--- imprimimos no log o valor dos fundos pr√≥prios que estar√£o dispon√≠veis ap√≥s a exe
   header=&quot;Equity:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   PrintFormat(&quot;%-*s%-.*f %s&quot;, w, header, digits, check.equity, currency);
      
//--- imprimimos no log o valor do lucro flutuante que estar√° dispon√≠vel ap√≥s a execu√ß
   header=&quot;Profit:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   PrintFormat(&quot;%-*s%-.*f %s&quot;, w, header, digits, check.profit, currency);      
      
//--- imprimimos no log o tamanho da margem necess√°ria para a opera√ß√£o de negocia√ß√£o r</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2296
</p>
<pre><code class="language-mql5">
   header=&quot;Margin:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   PrintFormat(&quot;%-*s%-.*f %s&quot;, w, header, digits, check.margin, currency);      
      
//--- imprimimos no log o valor dos fundos pr√≥prios dispon√≠veis que permanecer√£o ap√≥s 
   header=&quot;Margin free:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   PrintFormat(&quot;%-*s%-.*f %s&quot;, w, header, digits, check.margin_free, currency);      
      
//--- imprimimos no log o n√≠vel de margem que ser√° estabelecido ap√≥s a execu√ß√£o da ope
   header=&quot;Margin level:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   PrintFormat(&quot;%-*s%-.2f %%&quot;, w, header, check.margin_level);      
      
//--- imprimimos no log o coment√°rio sobre o c√≥digo de resposta, descri√ß√£o do erro
   header=&quot;Comment:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   PrintFormat(&quot;%-*s%-s&quot;, w, header, check.comment);      
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
OrderSend(), Tipos de opera√ß√µes de negocia√ß√£o, Pedido de Estrutura de Com√©rcio, Estrutura do
Pedido pelos resultados, Estrutura de um Pedido do resultado de negocia√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2297
<h3>OrderSend</h3>
A fun√ß√£o OrderSend() √© usada para a execu√ß√£o de opera√ß√µes de negocia√ß√£o enviando solicita√ß√µes para
um servidor de negocia√ß√£o.
</p>
<pre><code class="language-mql5">
bool¬† OrderSend(
   MqlTradeRequest&amp;¬† request,¬†     // estrutura de pedido
   MqlTradeResult&amp; ¬† result ¬†      // estrutura da resposta
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
request
[in]  Ponteiro para uma estrutura de tipo MqlTradeRequest descrevendo a atividade de negocia√ß√£o
do cliente.
result
[in,out]  Ponteiro para uma estrutura do tipo MqlTradeResult descrevendo o resultado da opera√ß√£o
comercial, no caso de uma realiza√ß√£o bem sucedida (se True √© retornado).
<h3>Valor do Retorno</h3>
Em caso de sucesso na verifica√ß√£o b√°sica de estruturas (verifica√ß√£o do √≠ndice) retorna True. No
entanto, este n√£o √© um sinal de sucesso com execu√ß√£o de uma opera√ß√£o de negocia√ß√£o . Para
uma descri√ß√£o mais detalhada do resultado da execu√ß√£o da fun√ß√£o, analisar os dom√≠nios da
estrutura de resultado.
<h3>Observa√ß√£o</h3>
Os pedidos de negocia√ß√£o passar por v√°rias etapas de verifica√ß√£o de um servidor de negocia√ß√£o.
Primeiro de tudo, ele verifica se todos os campos obrigat√≥rios dos par√¢metros de solicita√ß√£o est√£o
preenchidos corretamente. Se n√£o houver erros nesta guia, voc√™ pode iniciar o programa no
terminal cliente. Se o pedido for aceito com sucesso pelo servidor de negocia√ß√£o, o OrderSend()
retorna True.
Recomenda-se verificar o pedido antes de envi√°-lo para um servidor de negocia√ß√£o. Para verificar
os pedidos, use a fun√ß√£o OrderCheck(). Ele verifica se h√° fundos suficientes para executar a
opera√ß√£o de negocia√ß√£o, e retorna muitos par√¢metros √∫teis nos resultados da verifica√ß√£o do pedido
de negocia√ß√£o:
¬∑ c√≥digo de retorno cont√©m informa√ß√µes sobre erros no pedido verificado;
¬∑ Valor de saldo ap√≥s a execu√ß√£o da opera√ß√£o de negocia√ß√£o;
¬∑ valor de eq√ºidade que ir√° aparecer ap√≥s a opera√ß√£o comercial √© executado;
¬∑ valor de ponto flutuante que ir√° aparecer ap√≥s a opera√ß√£o de negocia√ß√£o for executado;
¬∑ Margem requerida para a opera√ß√£o de negocia√ß√£o;
¬∑ quantidade de capital livre que permanecer√° ap√≥s a execu√ß√£o da opera√ß√£o de negocia√ß√£o;
¬∑ o n√≠vel da margem que ser√° definido ap√≥s a opera√ß√£o de negocia√ß√£o for executado;
¬∑ Coment√°rio sobre o c√≥digo da resposta, descri√ß√£o do erro.
Ao enviar uma ordem a mercado (MqlTradeRequest.action=TRADE_ACTION_DEAL), o resultado bem-
sucedido da fun√ß√£o OrderSend() n√£o significa que a ordem tenha sido executada (executadas as
transa√ß√µes correspondentes): neste caso, true apenas significa que a ordem foi colocada
corretamente no sistema de negocia√ß√£o para execu√ß√£o posterior. Na estrutura do resultado result a</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2298
ser retornada, o servidor de negocia√ß√£o pode preencher os valores dos campos deal ou order, se
esse dados forem conhecidos por ele, no momento da forma√ß√£o da resposta √† chamada da
OrderSend(). Em geral, o(s) evento(s) da execu√ß√£o das transa√ß√µes, da ordem correspondente,
podem ocorrer ap√≥s ter sido enviada a resposta √† chamada da OrderSend(). Por isso, para qualquer
tipo de solicita√ß√£o de negocia√ß√£o, ap√≥s obtido o resultado da execu√ß√£o da OrderSend(), √©
necess√°rio, antes de tudo, verificar o c√≥digo de retorno do servidor de negocia√ß√£o retcode e o
c√≥digo de resposta do sistema de negocia√ß√£o externo retcode_external (se necess√°rio), que est√£o
dispon√≠veis na estrutura do resultado result a ser retornada.
Cada pedido aceito √© armazenado no servidor de negocia√ß√£o esperando o processamento at√© que
ocorre uma das condi√ß√µes para a sua execu√ß√£o:
¬∑ expira√ß√£o,
¬∑ aparecimento de uma solicita√ß√£o oposta,
¬∑ execu√ß√£o da ordem, quando o pre√ßo de execu√ß√£o aparece,
¬∑ uma solicita√ß√£o para cancelar a ordem √© recebido.
No momento do processamento da ordem, o servidor de negocia√ß√£os envia ao terminal uma
mensagem sobre a ocorr√™ncia do evento Trade (evento de negocia√ß√£o), que pode ser processado
pela fun√ß√£o OnTrade().
O resultado da execu√ß√£o do pedido de negocia√ß√£o sobre o servidor enviado pela fun√ß√£o OrderSend()
pode ser controlada pelo handler (Manipulador) OnTradeTransaction. Deve ser observado que o
handler (manipulador) OnTradeTransaction ser√° chamado v√°rias vezes durante a execu√ß√£o de um
pedido de negocia√ß√£o.
Por exemplo, ao enviar uma ordem de compra de mercado, ela √© tratada, uma ordem de compra
apropriada √© criada para a conta, a ordem √© ent√£o executada e removida da lista de ordens em
aberto, e ent√£o ela √© adicionada ao hist√≥rico de ordens, uma apropriada opera√ß√£o (deal) √©
adicionada ao hist√≥rico e uma nova posi√ß√£o √© criada. Fun√ß√£o OnTradeTransaction ser√° chamado
para cada um desses eventos.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//--- valor para ORDER_MAGIC
input long order_magic=55555;
//+------------------------------------------------------------------+
//| Programa Script da fun√ß√£o start (iniciar)¬†                       |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- Ter a certeza que √© uma conta demonstra√ß√£o
   if(AccountInfoInteger(ACCOUNT_TRADE_MODE)==ACCOUNT_TRADE_MODE_REAL)
     {
      Alert(&quot;Opera√ß√£o de script n√£o √© permitido em uma conta real!&quot;);
      return;
     }
//--- Colocar ou deletar uma ordem
   if(GetOrdersTotalByMagic(order_magic)==0) 
     {
      //--- N√£o ordens atuais - colocar uma ordem
      uint res=SendRandomPendingOrder(order_magic);
      Print(&quot;Retorna c√≥digo do servidor de negocia√ß√£o&quot;,res);</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2299
</p>
<pre><code class="language-mql5">
     }
   else // existem ordens - deletar ordens
     {
      DeleteAllOrdersByMagic(order_magic);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Receber o n√∫mero das atuais ordens atuais com especifica√ß√£o¬†     |
//+------------------------------------------------------------------+
int GetOrdersTotalByMagic(long const magic_number)
  {
   ulong order_ticket;
   int total=0;
//--- passar por todas as ordens pendentes
   for(int i=0;i&lt;OrdersTotal();i++)
      if((order_ticket=OrderGetTicket(i))&gt;0)
         if(magic_number==OrderGetInteger(ORDER_MAGIC)) total++;
//---
   return(total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Deletar todas as ordens pendentes com especifica√ß√£o ORDER_MAGIC  |
//+------------------------------------------------------------------+
void DeleteAllOrdersByMagic(long const magic_number)
  {
   ulong order_ticket;
//--- passar por todas as ordens pendentes
   for(int i=OrdersTotal()-1;i&gt;=0;i--)
      if((order_ticket=OrderGetTicket(i))&gt;0)
         //--- ordem com apropriado ORDER_MAGIC
         if(magic_number==OrderGetInteger(ORDER_MAGIC))
           {
            MqlTradeResult result={};
            MqlTradeRequest request={};
            request.order=order_ticket;
            request.action=TRADE_ACTION_REMOVE;
            OrderSend(request,result);
            //--- escrever a resposta do servidor para log
            Print(__FUNCTION__,&quot;: &quot;,result.comment,&quot; reply code &quot;,result.retcode);
           }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Definir uma ordem pendente de maneira aleat√≥ria                  |
//+------------------------------------------------------------------+
</code></pre>
<p>
uint SendRandomPendingOrder(long const magic_number)
</p>
<pre><code class="language-mql5">
  {
//--- preparar um pedido</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2300
</p>
<pre><code class="language-mql5">
   MqlTradeRequest request={};
   request.action=TRADE_ACTION_PENDING;         // defini√ß√£o de uma ordem pendente
   request.magic=magic_number;                  // ORDER_MAGIC
   request.symbol=_Symbol;                      // s√≠mbolo
   request.volume=0.1;                          // volume em 0.1 lotes
   request.sl=0;                                // Stop Loss (Parar Perda) n√£o √© espec
   request.tp=0;                                // Take Profit (Tomar Lucro) n√£o √© esp
//--- formar o tipo de ordem
   request.type=GetRandomType();                // tipo de ordem
//--- formar o pre√ßo para uma ordem pendente
   request.price=GetRandomPrice(request.type);  // pre√ßo de abertura
//--- enviar um pedido de negocia√ß√£o 
   MqlTradeResult result={};
   OrderSend(request,result);
//--- escrever resposta do servido para log  
   Print(__FUNCTION__,&quot;:&quot;,result.comment);
   if(result.retcode==10016) Print(result.bid,result.ask,result.price);
//--- c√≥digo de retorno da resposta do servidor de negocia√ß√£o
   return result.retcode;
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| tipo de retorno de uma ordem pendente de maneira aleat√≥ria       |
//+------------------------------------------------------------------+
</code></pre>
<p>
<h3>ENUM_ORDER_TYPE GetRandomType()</h3>
</p>
<pre><code class="language-mql5">
  {
   int t=MathRand()%4;
//---   0&lt;=t&lt;4
   switch(t)
     {
      case(0):return(ORDER_TYPE_BUY_LIMIT);
      case(1):return(ORDER_TYPE_SELL_LIMIT);
      case(2):return(ORDER_TYPE_BUY_STOP);
      case(3):return(ORDER_TYPE_SELL_STOP);
     }
//--- valor incorreto
   return(WRONG_VALUE);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|  retorno do pre√ßo de forma aleat√≥ria                             |
//+------------------------------------------------------------------+
double GetRandomPrice(ENUM_ORDER_TYPE type)
  {
   int t=(int)type;
//--- n√≠veis de stop (parar) para s√≠mbolo
   int distance=(int)SymbolInfoInteger(_Symbol,SYMBOL_TRADE_STOPS_LEVEL);
//--- receber dados do √∫ltimo tick (ponto)
   MqlTick last_tick={};
   SymbolInfoTick(_Symbol,last_tick);
//--- calcular o pre√ßo de acordo com o tipo</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2301
</p>
<pre><code class="language-mql5">
   double price;
   if(t==2 || t==5) // ORDER_TYPE_BUY_LIMIT ou ORDER_TYPE_SELL_STOP
     {
      price=last_tick.bid; // divergir do pre√ßo de compra
      price=price-(distance+(MathRand()%10)*5)*_Point;
     }
   else             // ORDER_TYPE_SELL_LIMIT ou ORDER_TYPE_BUY_STOP
     {
      price=last_tick.ask; // divergir do pre√ßo de venda
      price=price+(distance+(MathRand()%10)*5)*_Point;
     }
//---
   return(price);
</code></pre>
<p>
  }
<h3>Veja Tamb√©m</h3>
Tipos de Opera√ß√£o de Negocia√ß√£o, Estrutura de Solicita√ß√£o de Negocia√ß√£o,  Estrutura de Solicita√ß√£o
de Verifica√ß√£o de Resultados, Estrutura de uma Solicita√ß√£o de Resultado de Negocia√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2302
<h3>OrderSendAsync</h3>
A fun√ß√£o OrderSendAsync() √© usada para a realiza√ß√£o de opera√ß√µes de neg√≥cio ass√≠ncronos sem
esperar a resposta do servidor de neg√≥cio a um pedido enviado. A fun√ß√£o √© projetado para negocia√ß√£o
de alta freq√º√™ncia, quando, nos termos do algoritmo de negocia√ß√£o √© inaceit√°vel perder tempo √†
espera de uma resposta do servidor.
</p>
<pre><code class="language-mql5">
bool¬† OrderSendAsync(
   MqlTradeRequest&amp;¬† request,¬†     // Estrutura solicitada
   MqlTradeResult&amp; ¬† result ¬†      // Resultado da estrutura
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
request
[in]  Um ponteiro para uma estrutura do tipo MqlTradeRequestque descreve a a√ß√£o comercial do
cliente.
result
[in,out] Ponteiro para uma estrutura do tipo MqlTradeResultdescrevendo o resultado da opera√ß√£o
comercial, no caso de uma realiza√ß√£o bem sucedida (se verdadeiro √© retornado).
<h3>Valor do Retorno</h3>
Retorna verdadeiro se o pedido √© enviado para um servidor de neg√≥cio. No caso de o pedido n√£o for
enviado, ele retorna falsa. No caso de o pedido √© enviado, na vari√°vel resultado o c√≥digo de
resposta cont√©m o valor TRADE_RETCODE_PLACED (c√≥digo 10008) ‚Äì &quot;order placed&quot;. Execu√ß√£o bem
sucedida significa que apenas o fato de enviar, mas n√£o d√° qualquer garantia de que o pedido
chegou ao servidor de com√©rcio e foi aceito para processamento. Ao processar o pedido recebido,
um servidor de de neg√≥cio envia uma resposta a um terminal do cliente notificando a altera√ß√£o no
estado atual de posi√ß√µes, ordens e promo√ß√µes, o que leva √† gera√ß√£o do evento de negocia√ß√£o.
O resultado da execu√ß√£o do pedido de neg√≥cio sobre o servidor enviado pela fun√ß√£o OrderSend()
pode ser controlada pelo handler (Manipulador) OnTradeTransaction. Deve ser observado que o
handler (manipulador) OnTradeTransaction ser√° chamado v√°rias vezes durante a execu√ß√£o de um
pedido de neg√≥cio.
Por exemplo, ao enviar uma ordem de compra de mercado, ela √© tratada, uma ordem de compra
apropriada √© criada para a conta, a ordem √© ent√£o executada e removida da lista de ordens em
aberto, e ent√£o ela √© adicionada ao hist√≥rico de ordens, uma apropriada opera√ß√£o (deal) √©
adicionada ao hist√≥rico e uma nova posi√ß√£o √© criada. Fun√ß√£o OnTradeTransaction ser√° chamado
para cada um desses eventos. Para obter alguns desses dados, os par√¢metros da fun√ß√£o deve ser
analisada:
¬∑ trans - este par√¢metro obt√©m a estrutura MqlTradeTransaction descrevendo uma transa√ß√£o de
negocia√ß√£o aplicada a uma conta de neg√≥cio.
¬∑ request - este par√¢metro recebe estruturaMqlTradeRequest descrevendo o pedido de neg√≥cio
resultou em uma transa√ß√£o comercial.
¬∑ result - este par√¢metro obt√©m a estrutura MqlTradeResult descrevendo o resultado da execu√ß√£o
de uma solicita√ß√£o de negocia√ß√£o.
<h3>Observa√ß√£o</h3></p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2303
Em termos de objetivos e par√¢metros, a fun√ß√£o √© semelhante ao OrderSend(), mas ao contr√°rio, ela
√© ass√≠ncrona, isto √©, n√£o se sustenta o funcionamento do programa enquanto aguarda o resultado da
execu√ß√£o da fun√ß√£o. Voc√™ pode comparar a taxa de opera√ß√µes de com√©rcio destas duas fun√ß√µes,
utilizando a amostra Expert Advisor.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#property description &quot;Expert Advisor for sending trade requests &quot;
                      &quot; using OrderSendAsync() function.\r\n&quot;
#property description &quot;Handling trading events using&quot;
                      &quot; OnTrade() and OnTradeTransaction() handler functions is displa
#property description &quot;Expert Advisor parameters allow setting Magic Number&quot;
                      &quot; (unique ID) &quot;
#property description &quot;and the mode of displaying messages in Experts log. All details
//--- par√¢metros de entrada
input int  MagicNumber=1234567;      // Expert Advisor ID
input bool DescriptionModeFull=true; // Modo de sa√≠da detalhada
//--- chamada de vari√°vel para uso em HistorySelect()
</code></pre>
<p>
datetime history_start;
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do Expert¬†                               |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- verificar se negocia√ß√£o autom√°tica (autotrading) √© permitido
   if(!TerminalInfoInteger(TERMINAL_TRADE_ALLOWED))
     {
      Alert(&quot;Autotrading in the terminal is disabled, Expert Advisor will be removed.&quot;
      ExpertRemove();
      return(-1);
     }
//--- inabilitada a negocia√ß√£o com uma conta real
   if(AccountInfoInteger(ACCOUNT_TRADE_MODE)==ACCOUNT_TRADE_MODE_REAL)
     {
      Alert(&quot;Expert Advisor cannot trade on a real account!&quot;);
      ExpertRemove();
      return(-2);
     }
//--- verificar se √© poss√≠vel negociar com esta conta (por exemplo, a negocia√ß√£o √© imp
   if(!AccountInfoInteger(ACCOUNT_TRADE_ALLOWED))
     {
      Alert(&quot;Trading on this account is disabled&quot;);
      ExpertRemove();
      return(-3);
     }
//--- economizar o tempo do lan√ßamento do Expert Advisor para receber hist√≥rico de neg
   history_start=TimeCurrent();
//---
   CreateBuySellButtons();</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2304
</p>
<pre><code class="language-mql5">
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de Desinicializa√ß√£o do Expert                             |
//+------------------------------------------------------------------+
void OnDeinit(const int reason)
  {
//--- deletar todos os gr√°ficos objetos
   ObjectDelete(0,&quot;Buy&quot;);
   ObjectDelete(0,&quot;Sell&quot;);
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o TradeTransaction¬†                                         |
//+------------------------------------------------------------------+
void OnTradeTransaction(const MqlTradeTransaction &amp;trans,
                        const MqlTradeRequest &amp;request,
                        const MqlTradeResult &amp;result)
  {
//--- t√≠tulo nomeado ap√≥s negocia√ß√£o da fun√ß√£o handler do evento
   Print(&quot;=&gt; &quot;,__FUNCTION__,&quot; at &quot;,TimeToString(TimeCurrent(),TIME_SECONDS));
//--- receber tipo de transa√ß√£o como valor de enumera√ß√£o
   ENUM_TRADE_TRANSACTION_TYPE type=trans.type;
//--- se a transa√ß√£o √© o resultado da solicita√ß√£o de manipula√ß√£o
   if(type==TRADE_TRANSACTION_REQUEST)
     {
      //--- visualizar nome da transa√ß√£o
      Print(EnumToString(type));
      //--- em seguida visualizar a descri√ß√£o do string do pedido tratado
      Print(&quot;------------RequestDescription\r\n&quot;,
            RequestDescription(request,DescriptionModeFull));
      //--- e mostrar descri√ß√£o do resultado requisitado
      Print(&quot;------------ ResultDescription\r\n&quot;,
            TradeResultDescription(result,DescriptionModeFull));
     }
   else // visualizar a descri√ß√£o completa da transa√ß√£o para as transa√ß√µes de outro ti
     {
      Print(&quot;------------ TransactionDescription\r\n&quot;,
            TransactionDescription(trans,DescriptionModeFull));
     }
//---     
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o Trade¬†                                                    |
//+------------------------------------------------------------------+
void OnTrade()
  {
//--- membros est√°ticos para o armazenamento de negocia√ß√£o do status da conta
   static int prev_positions=0,prev_orders=0,prev_deals=0,prev_history_orders=0;</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2305
</p>
<pre><code class="language-mql5">
//--- hist√≥rico de negocia√ß√£o do pedido
   bool update=HistorySelect(history_start,TimeCurrent());
   PrintFormat(&quot;HistorySelect(%s , %s) = %s&quot;,
               TimeToString(history_start),TimeToString(TimeCurrent()),(string)update)
//--- t√≠tulo nomeado ap√≥s negocia√ß√£o da fun√ß√£o handler do evento
   Print(&quot;=&gt; &quot;,__FUNCTION__,&quot; at &quot;,TimeToString(TimeCurrent(),TIME_SECONDS));
//--- exibir o nome do handler (manipulador) e o n√∫mero de ordens no momento da manipu
   int curr_positions=PositionsTotal();
   int curr_orders=OrdersTotal();
   int curr_deals=HistoryOrdersTotal();
   int curr_history_orders=HistoryDealsTotal();
//--- exibir o n√∫mero de ordens, as posi√ß√µes, promo√ß√µes e altera√ß√µes em par√™nteses
   PrintFormat(&quot;PositionsTotal() = %d (%+d)&quot;,
               curr_positions,(curr_positions-prev_positions));
   PrintFormat(&quot;OrdersTotal() = %d (%+d)&quot;,
               curr_orders,curr_orders-prev_orders);
   PrintFormat(&quot;HistoryOrdersTotal() = %d (%+d)&quot;,
               curr_deals,curr_deals-prev_deals);
   PrintFormat(&quot;HistoryDealsTotal() = %d (%+d)&quot;,
               curr_history_orders,curr_history_orders-prev_history_orders);
//--- Inserir uma quebra de string para ver o log mais adequado
   Print(&quot;&quot;);
//--- salvar o status da conta
   prev_positions=curr_positions;
   prev_orders=curr_orders;
   prev_deals=curr_deals;
   prev_history_orders=curr_history_orders;
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o ChartEvent                                                |
//+------------------------------------------------------------------+
void OnChartEvent(const int id,
                  const long &amp;lparam,
                  const double &amp;dparam,
                  const string &amp;sparam)
  {
//--- manipula√ß√£o do evento CHARTEVENT_CLICK (&quot;Clicando no gr√°fico&quot;)
   if(id==CHARTEVENT_OBJECT_CLICK)
     {
      Print(&quot;=&gt; &quot;,__FUNCTION__,&quot;: sparam = &quot;,sparam);
      //--- volume m√≠nimo de um neg√≥cio
      double volume_min=SymbolInfoDouble(_Symbol,SYMBOL_VOLUME_MIN);
      //--- Se o bot√£o &quot;Comprar&quot; √© pressionado, ent√£o comprar
      if(sparam==&quot;Buy&quot;)
        {
         PrintFormat(&quot;Buy %s %G lot&quot;,_Symbol,volume_min);
         BuyAsync(volume_min);
         //--- desfazer pressionando o bot√£o</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2306
</p>
<pre><code class="language-mql5">
         ObjectSetInteger(0,&quot;Buy&quot;,OBJPROP_STATE,false);
        }
      //--- Se o bot√£o &quot;Vender&quot; √© pressionado, ent√£o vender
      if(sparam==&quot;Sell&quot;)
        {
         PrintFormat(&quot;Sell %s %G lot&quot;,_Symbol,volume_min);
         SellAsync(volume_min);
         //--- desfazer pressionando o bot√£o
         ObjectSetInteger(0,&quot;Sell&quot;,OBJPROP_STATE,false);
        }
      ChartRedraw();
     }
//---         
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o texto de descri√ß√£o de uma transa√ß√£o¬†                   |
//+------------------------------------------------------------------+
string TransactionDescription(const MqlTradeTransaction &amp;trans,
                              const bool detailed=true)
  {
//--- preparar uma string para o retorno a partir da fun√ß√£o
   string desc=EnumToString(trans.type)+&quot;\r\n&quot;;
//--- todos os dados poss√≠veis √© adicionado em modo detalhado
   if(detailed)
     {
      desc+=&quot;Ativo: &quot;+trans.symbol+&quot;\r\n&quot;;
      desc+=&quot;Bilhetagem (ticket) da opera√ß√£o: &quot;+(string)trans.deal+&quot;\r\n&quot;;
      desc+=&quot;Tipo de opera√ß√£o: &quot;+EnumToString(trans.deal_type)+&quot;\r\n&quot;;
      desc+=&quot;Bilhetagem (ticket) da ordem: &quot;+(string)trans.order+&quot;\r\n&quot;;
      desc+=&quot;Tipo de ordem: &quot;+EnumToString(trans.order_type)+&quot;\r\n&quot;;
      desc+=&quot;Estado da ordem: &quot;+EnumToString(trans.order_state)+&quot;\r\n&quot;;
      desc+=&quot;Ordem do tipo time: &quot;+EnumToString(trans.time_type)+&quot;\r\n&quot;;
      desc+=&quot;Expira√ß√£o da ordem: &quot;+TimeToString(trans.time_expiration)+&quot;\r\n&quot;;
      desc+=&quot;Pre√ßo: &quot;+StringFormat(&quot;%G&quot;,trans.price)+&quot;\r\n&quot;;
      desc+=&quot;Gatilho do pre√ßo: &quot;+StringFormat(&quot;%G&quot;,trans.price_trigger)+&quot;\r\n&quot;;
      desc+=&quot;Stop Loss: &quot;+StringFormat(&quot;%G&quot;,trans.price_sl)+&quot;\r\n&quot;;
      desc+=&quot;Take Profit: &quot;+StringFormat(&quot;%G&quot;,trans.price_tp)+&quot;\r\n&quot;;
      desc+=&quot;Volume: &quot;+StringFormat(&quot;%G&quot;,trans.volume)+&quot;\r\n&quot;;
     }
//--- retornar a string recebida
   return desc;
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+--------------------------------------------------------------------+
//|¬†Retorne o texto de descri√ß√£o do resultado da manipula√ß√£o de pedido¬†|
//+--------------------------------------------------------------------+
string RequestDescription(const MqlTradeRequest &amp;request,
                          const bool detailed=true)
  {
//--- preparar uma string para o retorno a partir da fun√ß√£o</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2307
</p>
<pre><code class="language-mql5">
   string desc=EnumToString(request.action)+&quot;\r\n&quot;;
//--- adicionar todos os dados dispon√≠veis em modo detalhado
   if(detailed)
     {
      desc+=&quot;Ativo: &quot;+request.symbol+&quot;\r\n&quot;;
      desc+=&quot;N√∫mero m√°gico: &quot;+StringFormat(&quot;%d&quot;,request.magic)+&quot;\r\n&quot;;
      desc+=&quot;Bilhetagem (ticket) da ordem: &quot;+(string)request.order+&quot;\r\n&quot;;
      desc+=&quot;Tipo de ordem: &quot;+EnumToString(request.type)+&quot;\r\n&quot;;
      desc+=&quot;Preenchimento da ordem: &quot;+EnumToString(request.type_filling)+&quot;\r\n&quot;;
      desc+=&quot;Ordem do tipo time: &quot;+EnumToString(request.type_time)+&quot;\r\n&quot;;
      desc+=&quot;Expira√ß√£o da ordem: &quot;+TimeToString(request.expiration)+&quot;\r\n&quot;;
      desc+=&quot;Pre√ßo: &quot;+StringFormat(&quot;%G&quot;,request.price)+&quot;\r\n&quot;;
      desc+=&quot;Pontos de desvio: &quot;+StringFormat(&quot;%G&quot;,request.deviation)+&quot;\r\n&quot;;
      desc+=&quot;Stop Loss: &quot;+StringFormat(&quot;%G&quot;,request.sl)+&quot;\r\n&quot;;
      desc+=&quot;Take Profit: &quot;+StringFormat(&quot;%G&quot;,request.tp)+&quot;\r\n&quot;;
      desc+=&quot;Stop Limit: &quot;+StringFormat(&quot;%G&quot;,request.stoplimit)+&quot;\r\n&quot;;
      desc+=&quot;Volume: &quot;+StringFormat(&quot;%G&quot;,request.volume)+&quot;\r\n&quot;;
      desc+=&quot;Coment√°rio: &quot;+request.comment+&quot;\r\n&quot;;
     }
//--- retornar string recebida
   return desc;
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+--------------------------------------------------------------------+
//|¬†Retorne o texto de descri√ß√£o do resultado da manipula√ß√£o de pedido¬†|
//+--------------------------------------------------------------------+
string TradeResultDescription(const MqlTradeResult &amp;result,
                              const bool detailed=true)
  {
//--- preparar a string para o retorno a partir da fun√ß√£o
   string desc=&quot;Retcode &quot;+(string)result.retcode+&quot;\r\n&quot;;
//--- adicionar todos os dados dispon√≠veis em modo detalhado
   if(detailed)
     {
      desc+=&quot;ID da Solicita√ß√£o: &quot;+StringFormat(&quot;%d&quot;,result.request_id)+&quot;\r\n&quot;;
      desc+=&quot;Bilhetagem (ticket) da ordem: &quot;+(string)result.order+&quot;\r\n&quot;;
      desc+=&quot;Bilhetagem (ticket) da opera√ß√£o: &quot;+(string)result.deal+&quot;\r\n&quot;;
      desc+=&quot;Volume: &quot;+StringFormat(&quot;%G&quot;,result.volume)+&quot;\r\n&quot;;
      desc+=&quot;Pre√ßo: &quot;+StringFormat(&quot;%G&quot;,result.price)+&quot;\r\n&quot;;
      desc+=&quot;Compra (Ask): &quot;+StringFormat(&quot;%G&quot;,result.ask)+&quot;\r\n&quot;;
      desc+=&quot;Venda (Bid): &quot;+StringFormat(&quot;%G&quot;,result.bid)+&quot;\r\n&quot;;
      desc+=&quot;Coment√°rio: &quot;+result.comment+&quot;\r\n&quot;;
     }
//--- retornar string recebida
   return desc;
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Criar dois bot√µes de compra e venda¬†                             |
//+------------------------------------------------------------------+
void CreateBuySellButtons()</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2308
</p>
<pre><code class="language-mql5">
  {
//--- checar a presen√ßa do objeto chamado &quot;Buy&quot; (comprar)
   if(ObjectFind(0,&quot;Buy&quot;)&gt;=0)
     {
       //--- se o objeto encontrado n√£o √© um bot√£o, deletar-lo
      if(ObjectGetInteger(0,&quot;Buy&quot;,OBJPROP_TYPE)!=OBJ_BUTTON)
         ObjectDelete(0,&quot;Buy&quot;);
     }
   else
      ObjectCreate(0,&quot;Buy&quot;,OBJ_BUTTON,0,0,0); // criar bot√£o &quot;Buy&quot; (comprar)
//--- configurar bot√£o &quot;Buy&quot; (comprar)
   ObjectSetInteger(0,&quot;Buy&quot;,OBJPROP_CORNER,CORNER_RIGHT_UPPER);
   ObjectSetInteger(0,&quot;Buy&quot;,OBJPROP_XDISTANCE,100);
   ObjectSetInteger(0,&quot;Buy&quot;,OBJPROP_YDISTANCE,50);
   ObjectSetInteger(0,&quot;Buy&quot;,OBJPROP_XSIZE,70);
   ObjectSetInteger(0,&quot;Buy&quot;,OBJPROP_YSIZE,30);
   ObjectSetString(0,&quot;Buy&quot;,OBJPROP_TEXT,&quot;Buy&quot;);
   ObjectSetInteger(0,&quot;Buy&quot;,OBJPROP_COLOR,clrRed);
//--- checar a presen√ßa do objeto chamado &quot;Sell&quot; (comprar)
   if(ObjectFind(0,&quot;Sell&quot;)&gt;=0)
     {
       //--- se o objeto encontrado n√£o √© um bot√£o, deletar-lo
      if(ObjectGetInteger(0,&quot;Sell&quot;,OBJPROP_TYPE)!=OBJ_BUTTON)
         ObjectDelete(0,&quot;Sell&quot;);
     }
   else
      ObjectCreate(0,&quot;Sell&quot;,OBJ_BUTTON,0,0,0); // criar bot√£o &quot;Sell&quot; (vender)
//--- configurar bot√£o &quot;Sell&quot; (comprar)
   ObjectSetInteger(0,&quot;Sell&quot;,OBJPROP_CORNER,CORNER_RIGHT_UPPER);
   ObjectSetInteger(0,&quot;Sell&quot;,OBJPROP_XDISTANCE,100);
   ObjectSetInteger(0,&quot;Sell&quot;,OBJPROP_YDISTANCE,100);
   ObjectSetInteger(0,&quot;Sell&quot;,OBJPROP_XSIZE,70);
   ObjectSetInteger(0,&quot;Sell&quot;,OBJPROP_YSIZE,30);
   ObjectSetString(0,&quot;Sell&quot;,OBJPROP_TEXT,&quot;Sell&quot;);
   ObjectSetInteger(0,&quot;Sell&quot;,OBJPROP_COLOR,clrBlue);
//--- realizar atualiza√ß√£o for√ßada do gr√°fico para ver imediatamente os bot√µes
   ChartRedraw();
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Comprar usando a fun√ß√£o OrderSendAsync() ass√≠ncrona¬†             |
//+------------------------------------------------------------------+
void BuyAsync(double volume)
  {
//--- preparar o pedido
   MqlTradeRequest req={};
   req.action      =TRADE_ACTION_DEAL;
   req.symbol      =_Symbol;
   req.magic       =MagicNumber;</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2309
</p>
<pre><code class="language-mql5">
   req.volume      =0.1;
   req.type        =ORDER_TYPE_BUY;
   req.price       =SymbolInfoDouble(req.symbol,SYMBOL_ASK);
   req.deviation   =10;
   req.comment     =&quot;Comprar usando OrderSendAsync()&quot;;
   MqlTradeResult  res={};
   if(!OrderSendAsync(req,res))
     {
      Print(__FUNCTION__,&quot;: erro &quot;,GetLastError(),&quot;, retcode = &quot;,res.retcode);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Vender usando a fun√ß√£o OrderSendAsync() ass√≠ncrona¬†              |
//+------------------------------------------------------------------+
void SellAsync(double volume)
  {
//--- preparar o pedido
   MqlTradeRequest req={};
   req.action      =TRADE_ACTION_DEAL;
   req.symbol      =_Symbol;
   req.magic       =MagicNumber;
   req.volume      =0.1;
   req.type        =ORDER_TYPE_SELL;
   req.price       =SymbolInfoDouble(req.symbol,SYMBOL_BID);
   req.deviation   =10;
   req.comment     =&quot;Vende usando OrderSendAsync()&quot;;
   MqlTradeResult  res={};
   if(!OrderSendAsync(req,res))
     {
      Print(__FUNCTION__,&quot;: erro &quot;,GetLastError(),&quot;, retcode = &quot;,res.retcode);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
</code></pre>
<p>
Exemplo de exibi√ß√£o de mensagens em log &quot;Experts&quot;:
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnChartEvent: sparam = Sell
 12:52:52   ExpertAdvisor (EURUSD,H1)   Sell EURUSD 0.01 lot
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTradeTransaction at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   TRADE_TRANSACTION_REQUEST
 12:52:52   ExpertAdvisor (EURUSD,H1)   ------------RequestDescription
 12:52:52   ExpertAdvisor (EURUSD,H1)   TRADE_ACTION_DEAL
 12:52:52   ExpertAdvisor (EURUSD,H1)   Symbol: EURUSD
 12:52:52   ExpertAdvisor (EURUSD,H1)   Magic Number: 1234567
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order ticket: 16361998
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order type: ORDER_TYPE_SELL
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order filling: ORDER_FILLING_FOK</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2310
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order time type: ORDER_TIME_GTC
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order expiration: 1970.01.01 00:00
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price: 1.29313
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deviation points: 10
 12:52:52   ExpertAdvisor (EURUSD,H1)   Stop Loss: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Take Profit: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Stop Limit: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Volume: 0.1
 12:52:52   ExpertAdvisor (EURUSD,H1)   Comment: Sell using OrderSendAsync()
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   ------------ ResultDescription
 12:52:52   ExpertAdvisor (EURUSD,H1)   Retcode 10009
 12:52:52   ExpertAdvisor (EURUSD,H1)   Request ID: 2
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order ticket: 16361998
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal ticket: 15048668
 12:52:52   ExpertAdvisor (EURUSD,H1)   Volume: 0.1
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price: 1.29313
 12:52:52   ExpertAdvisor (EURUSD,H1)   Ask: 1.29319
 12:52:52   ExpertAdvisor (EURUSD,H1)   Bid: 1.29313
 12:52:52   ExpertAdvisor (EURUSD,H1)   Comment: 
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistorySelect( 09:34 , 09:52) = true
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTrade at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   PositionsTotal() = 1 (+1)
 12:52:52   ExpertAdvisor (EURUSD,H1)   OrdersTotal() = 0 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistoryOrdersTotal() = 2 (+2)
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistoryDealsTotal() = 2 (+2)
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTradeTransaction at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   ------------ TransactionDescription
 12:52:52   ExpertAdvisor (EURUSD,H1)   TRADE_TRANSACTION_ORDER_ADD
 12:52:52   ExpertAdvisor (EURUSD,H1)   Symbol: EURUSD
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal ticket: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal type: DEAL_TYPE_BUY
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order ticket: 16361998
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order type: ORDER_TYPE_SELL
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order state: ORDER_STATE_STARTED
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order time type: ORDER_TIME_GTC
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order expiration: 1970.01.01 00:00
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price: 1.29313
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price trigger: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Stop Loss: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Take Profit: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Volume: 0.1
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTradeTransaction at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   ------------ TransactionDescription
 12:52:52   ExpertAdvisor (EURUSD,H1)   TRADE_TRANSACTION_ORDER_DELETE
 12:52:52   ExpertAdvisor (EURUSD,H1)   Symbol: EURUSD</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2311
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal ticket: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal type: DEAL_TYPE_BUY
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order ticket: 16361998
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order type: ORDER_TYPE_SELL
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order state: ORDER_STATE_STARTED
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order time type: ORDER_TIME_GTC
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order expiration: 1970.01.01 00:00
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price: 1.29313
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price trigger: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Stop Loss: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Take Profit: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Volume: 0.1
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistorySelect( 09:34 , 09:52) = true
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTrade at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   PositionsTotal() = 1 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   OrdersTotal() = 0 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistoryOrdersTotal() = 2 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistoryDealsTotal() = 2 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTradeTransaction at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   ------------ TransactionDescription
 12:52:52   ExpertAdvisor (EURUSD,H1)   TRADE_TRANSACTION_HISTORY_ADD
 12:52:52   ExpertAdvisor (EURUSD,H1)   Symbol: EURUSD
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal ticket: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal type: DEAL_TYPE_BUY
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order ticket: 16361998
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order type: ORDER_TYPE_SELL
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order state: ORDER_STATE_FILLED
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order time type: ORDER_TIME_GTC
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order expiration: 1970.01.01 00:00
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price: 1.29313
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price trigger: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Stop Loss: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Take Profit: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Volume: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistorySelect( 09:34 , 09:52) = true
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTrade at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   PositionsTotal() = 1 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   OrdersTotal() = 0 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistoryOrdersTotal() = 2 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistoryDealsTotal() = 2 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTradeTransaction at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   ------------ TransactionDescription
 12:52:52   ExpertAdvisor (EURUSD,H1)   TRADE_TRANSACTION_DEAL_ADD
 12:52:52   ExpertAdvisor (EURUSD,H1)   Symbol: EURUSD
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal ticket: 15048668</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2312
 12:52:52   ExpertAdvisor (EURUSD,H1)   Deal type: DEAL_TYPE_SELL
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order ticket: 16361998
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order type: ORDER_TYPE_BUY
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order state: ORDER_STATE_STARTED
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order time type: ORDER_TIME_GTC
 12:52:52   ExpertAdvisor (EURUSD,H1)   Order expiration: 1970.01.01 00:00
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price: 1.29313
 12:52:52   ExpertAdvisor (EURUSD,H1)   Price trigger: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Stop Loss: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Take Profit: 0
 12:52:52   ExpertAdvisor (EURUSD,H1)   Volume: 0.1
 12:52:52   ExpertAdvisor (EURUSD,H1)   
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistorySelect( 09:34 , 09:52) = true
 12:52:52   ExpertAdvisor (EURUSD,H1)   =&gt; OnTrade at 09:52:53
 12:52:52   ExpertAdvisor (EURUSD,H1)   PositionsTotal() = 1 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   OrdersTotal() = 0 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistoryOrdersTotal() = 2 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   HistoryDealsTotal() = 2 (+0)
 12:52:52   ExpertAdvisor (EURUSD,H1)   </p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2313
<h3>PositionsTotal</h3>
Retorna o n√∫mero de posi√ß√µes em aberto.
</p>
<pre><code class="language-mql5">
int¬† PositionsTotal();
</code></pre>
<p>
<h3>Valor retornado</h3>
Valor do tipo int.
<h3>Observa√ß√£o</h3>
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- obtemos e imprimimos no log a quantidade de posi√ß√µes abertas na conta
   int total=PositionsTotal();
   Print(&quot;Number of open positions on account: &quot;, total);
   /*
¬†  Resultado:
   Number of open positions on account: 2
   */
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
PositionGetSymbol(), PositionSelect(), Propriedades de uma Posi√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2314
<h3>PositionGetSymbol</h3>
Retorna o s√≠mbolo correspondente √† posi√ß√£o aberta e seleciona automaticamente essa posi√ß√£o para
que possa ser trabalhada usando as fun√ß√µes PositionGetDouble, PositionGetInteger, PositionGetString.
</p>
<pre><code class="language-mql5">
string¬† PositionGetSymbol(
   int¬† index¬†     // N√∫mero na lista de posi√ß√µes
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
index
[in]  N√∫mero de posi√ß√£o na lista de posi√ß√µes abertas.
<h3>Valor retornado</h3>
Valor do tipo string. Se a posi√ß√£o n√£o foi encontrada, uma string vazia ser√° retornada. Para obter
um c√≥digo de erro, chamar a fun√ß√£o GetLastError().
<h3>Observa√ß√£o</h3>
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- obtemos a quantidade de posi√ß√µes abertas na conta
   int total=PositionsTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos o s√≠mbolo da posi√ß√£o pelo √≠ndice do loop i
      ResetLastError();
      string symbol=PositionGetSymbol(i);
      
      //--- se o s√≠mbolo da posi√ß√£o for obtido com sucesso, a posi√ß√£o pelo √≠ndice i se
      //--- e ser√° poss√≠vel acessar suas propriedades com PositionGetDouble, PositionG
      if(symbol!=&quot;&quot;)
        {
         ENUM_POSITION_TYPE type=(ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE)
         PrintFormat(&quot;Position symbol at index %d: %s, position type: %s&quot;, i, symbol, 
        }
      else</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2315
</p>
<pre><code class="language-mql5">
        {
         PrintFormat(&quot;PositionGetSymbol(%d) failed. Error %d&quot;, i, GetLastError());
         continue;
        }
     }
   /*
¬†  Resultado:
   Position symbol at index 0: GBPUSD, position type: SELL
   Position symbol at index 1: EURUSD, position type: BUY
   */
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
PositionsTotal(), PositionSelect(), Propriedades de uma Posi√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2316
<h3>PositionSelect</h3>
Escolhe uma posi√ß√£o aberta para posteriormente trabalhar com ela. Retorna true se a fun√ß√£o for
conclu√≠da com √™xito. Retorna false em caso de falha. Para obter informa√ß√µes sobre o erro, chame
GetLastError().
</p>
<pre><code class="language-mql5">
bool¬† PositionSelect(
   string¬† symbol¬†     // Nome do s√≠mbolo
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
symbol
[in]  Nome do ativo.
<h3>Valor retornado</h3>
Valor do tipo bool.
<h3>Observa√ß√£o</h3>
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo. Neste caso, a PositionSelect
escolhe a posi√ß√£o com o menor ticket.
A fun√ß√£o PositionSelect() copia os dados da posi√ß√£o para o ambiente do programa, e chamadas
subsequentes de PositionGetDouble(), PositionGetInteger() e PositionGetString() retornam esses
dados copiados anteriormente. Isso significa que a posi√ß√£o em si pode j√° n√£o existir (ou seu
volume, dire√ß√£o, etc. pode ter mudado), mas ainda assim os dados dessa posi√ß√£o podem ser
obtidos. Para garantir que os dados da posi√ß√£o estejam atualizados, √© recomendado chamar
PositionSelect() logo antes de acess√°-los.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#define   SYMBOL_NAME   &quot;EURUSD&quot;
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- selecionamos a posi√ß√£o no s√≠mbolo especificado
   if(!PositionSelect(SYMBOL_NAME))
     {
      PrintFormat(&quot;PositionSelect(%s) failed. Error %d&quot;,SYMBOL_NAME, GetLastError());
      return;
     }</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2317
</p>
<pre><code class="language-mql5">
//--- se a posi√ß√£o for selecionada, √© poss√≠vel acessar seus dados com PositionGetDoubl
//--- obtemos o ticket da posi√ß√£o selecionada
   ResetLastError();
   long ticket=PositionGetInteger(POSITION_TICKET);
   if(ticket==0)
     {
      PrintFormat(&quot;Failed to get %s position ticket. Error %d&quot;, SYMBOL_NAME, GetLastEr
      return;
     }
     
//--- ao obter o ticket com sucesso, imprimimos no log o s√≠mbolo e o ticket da posi√ß√£o
   PrintFormat(&quot;The position that is selected on the %s symbol has ticket %I64d&quot;, SYMB
   /*
   Resultado:
   The position that is selected on the EURUSD symbol has ticket 2810846623
   */
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
PositionGetSymbol(), PositionsTotal(), Propriedades de uma Posi√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2318
<h3>PositionSelectByTicket</h3>
Seleciona uma posi√ß√£o aberta para trabalhar no futuro com ela segundo o ticket indicado. Retorna true
se a fun√ß√£o for bem-sucedida. Retorna false se a fun√ß√£o falhar. Para mais informa√ß√µes sobre o erro,
chame a fun√ß√£o GetLastError().
</p>
<pre><code class="language-mql5">
bool¬† PositionSelectByTicket(
   ulong¬†  ticket     // ticket da posi√ß√£o
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket
[in]  Bilhete da posi√ß√£o.
valor de retorno
Valor do tipo bool.
<h3>Observa√ß√£o</h3>
A fun√ß√£o PositionSelectByTicket() copia os dados da posi√ß√£o para o ambiente do software, e
chamadas subsequentes de PositionGetDouble(), PositionGetInteger() e PositionGetString()
retornam esses dados copiados anteriormente. Isso significa que a posi√ß√£o em si pode j√° n√£o existir
(ou ter alterado o volume, a dire√ß√£o, etc.), mas ainda assim os dados dessa posi√ß√£o podem ser
obtidos. Para garantir que os dados das posi√ß√µes estejam atualizados, √© recomend√°vel chamar a
fun√ß√£o PositionSelectByTicket() logo antes de acess√°-los.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#define   EXPERT_MAGIC  123456   // MagicNumber
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- declaramos e inicializamos as estruturas de solicita√ß√£o e resultado
   MqlTradeRequest request={};
   MqlTradeResult  result ={};
   
//--- preenchemos os par√¢metros da solicita√ß√£o de negocia√ß√£o para abrir uma posi√ß√£o lo
   request.action    = TRADE_ACTION_DEAL; // tipo de opera√ß√£o de negocia√ß√£o
   request.symbol    = symbol;            // s√≠mbolo
   request.volume    = 0.1;                                    // volume de 0.1 lote
   request.type      = ORDER_TYPE_BUY;                         // tipo de ordem
   request.price     = SymbolInfoDouble(Symbol(), SYMBOL_ASK); // pre√ßo para abertura
   request.deviation = 5;                                      // desvio admiss√≠vel em
   request.magic     = EXPERT_MAGIC;      // MagicNumber da ordem
   
//--- enviamos a solicita√ß√£o, se o envio falhar, imprimimos o c√≥digo de erro e encerra
   if(!OrderSend(request, result))</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2319
</p>
<pre><code class="language-mql5">
     {
      PrintFormat(&quot;OrderSend error &quot;, GetLastError());
      return;
     }
      
//--- imprimimos informa√ß√µes sobre a opera√ß√£o
   PrintFormat(&quot;Trade request result: retcode: %u, deal: %I64u, order: %I64u&quot;, result.
   
//--- obtemos o ticket da posi√ß√£o a partir do resultado da opera√ß√£o de negocia√ß√£o e se
//--- o ticket da posi√ß√£o rec√©m-aberta corresponde ao ticket da ordem que gerou a oper
   ulong ticket=result.order;
   ResetLastError();
   if(!PositionSelectByTicket(ticket))
     {
      PrintFormat(&quot;PositionSelectByTicket(%I64u) failed. Error %d&quot;, ticket, GetLastErr
      return;
     }
//--- imprimimos no log os dados da posi√ß√£o selecionada pelo ticket
   ENUM_POSITION_TYPE type  = (ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE);
   long               time  = PositionGetInteger(POSITION_TIME_MSC);
   double             price = PositionGetDouble(POSITION_PRICE_OPEN);
   double             volume= PositionGetDouble(POSITION_VOLUME);
   string             symbol= PositionGetString(POSITION_SYMBOL);
   int                digits= (int)SymbolInfoInteger(symbol, SYMBOL_DIGITS);
   PrintFormat(&quot;Current selected position: %s %.2f %s #%I64u at %.*f, %s&quot;,
               symbol, volume, (type==POSITION_TYPE_BUY ? &quot;Buy&quot; : &quot;Sell&quot;), ticket, dig
   /*
¬†  Resultado:
   Trade request result: retcode: 10009, deal: 2778100901, order: 2803905975
   Current selected position: EURUSD 0.10 Buy #2803905975 at 1.10672, 2024.09.02 12:09
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o tempo em milissegundos                                 |
//+------------------------------------------------------------------+
string TimeMscToString(const long time_msc, int flags=TIME_DATE|TIME_MINUTES|TIME_SECO
  {
   return(TimeToString(time_msc/1000, flags) + &quot;.&quot; + IntegerToString(time_msc %1000, 3
</code></pre>
<p>
  }
<h3>Veja tamb√©m</h3>
PositionGetSymbol(), PositionsTotal(), Propriedades das posi√ß√µes</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2320
<h3>PositionGetDouble</h3>
A fun√ß√£o retorna a propriedade solicitada de uma posi√ß√£o aberta, pr√©-selecionado usando
PositionGetSymbol ou PositionSelect. A propriedade da opera√ß√£o deve ser do tipo double. Existem 2
variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
</p>
<pre><code class="language-mql5">
double¬† PositionGetDouble(
   ENUM_POSITION_PROPERTY_DOUBLE¬† property_id¬†     // Identificador de propriedade
   );
</code></pre>
<p>
2. Retorna true ou false dependendo do sucesso da execu√ß√£o da fun√ß√£o. Se for bem sucedido, o valor
da propriedade √© colocada em uma vari√°vel de recebimento passada por refer√™ncia no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† PositionGetDouble(
   ENUM_POSITION_PROPERTY_DOUBLE¬† property_id,     // Identificador de propriedade
   double&amp;¬†                    double_var¬†        // valor da propriedade
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
property_id
[in]  Identificador da propriedade da opera√ß√£o. O valor pode ser um dos valores da enumera√ß√£o
ENUM_POSITION_PROPERTY_DOUBLE.
double_var
[out]  Vari√°vel de tipo double, que aceita o valor da propriedade requerida.
<h3>Valor retornado</h3>
Valor do tipo double. Se a fun√ß√£o falhar, ser√° retornado 0.
<h3>Observa√ß√£o</h3>
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo.
Para garantir o recebimento de novos dados sobre a posi√ß√£o, √© recomendado chamar
PositionSelect() logo antes referindo-se a eles.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2321
</p>
<pre><code class="language-mql5">
//--- no loop por todas as posi√ß√µes na conta
   int total=PositionsTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos o ticket da pr√≥xima posi√ß√£o, selecionando automaticamente a posi√ß√£
      ulong ticket=PositionGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo da posi√ß√£o e imprimimos o cabe√ßalho para a lista de proprie
      string type=(PositionGetInteger(POSITION_TYPE)==POSITION_TYPE ? &quot;Buy&quot; : &quot;Sell&quot;);
      PrintFormat(&quot;Double properties of an open position %s #%I64u:&quot;, type, ticket);
      
      //--- imprimimos sob o cabe√ßalho todas as propriedades reais da posi√ß√£o selecion
      PositionPropertiesDoublePrint(15);
     }
   /*
¬†  Resultado:
   Double properties of an open position Buy #2807075208:
   Volume:        1.00
   Price open:    1.10516
   StopLoss:      0.00000
   TakeProfit:    0.00000
   Price current: 1.10518
   Swap:          0.00
   Profit:        2.00 USD
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log as propriedades reais da posi√ß√£o selecionada      |
//+------------------------------------------------------------------+
void PositionPropertiesDoublePrint(const uint header_width=0)
  {
   uint   w=0;
   string header=&quot;&quot;;
   double value=0;
   
//--- obtemos a moeda da conta, o s√≠mbolo da posi√ß√£o e o n√∫mero de d√≠gitos ap√≥s a v√≠rg
   string currency=AccountInfoString(ACCOUNT_CURRENCY);
   string symbol  =PositionGetString(POSITION_SYMBOL);
   int    digits  =(int)SymbolInfoInteger(symbol, SYMBOL_DIGITS);
   
//--- definimos o texto do cabe√ßalho e a largura do campo de cabe√ßalho
//--- se a largura do cabe√ßalho for passada para a fun√ß√£o igual a zero, a largura ser√°
   header=&quot;Volume:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
//--- obtemos e imprimimos no log o volume da posi√ß√£o com um cabe√ßalho de largura defi
   if(!PositionGetDouble(POSITION_VOLUME, value))
      return;</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2322
</p>
<pre><code class="language-mql5">
   PrintFormat(&quot;%-*s%-.2f&quot;, w, header, value);
   
//--- imprimimos no log o valor do pre√ßo da posi√ß√£o
   header=&quot;Price open:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!PositionGetDouble(POSITION_PRICE_OPEN, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
   
//--- imprimimos no log o valor do StopLoss
   header=&quot;StopLoss:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!PositionGetDouble(POSITION_SL, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
   
//--- imprimimos no log o valor do TakeProfit
   header=&quot;TakeProfit:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!PositionGetDouble(POSITION_TP, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
//--- imprimimos no log o valor do Pre√ßo Atua
   header=&quot;Price current:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!PositionGetDouble(POSITION_PRICE_CURRENT, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
</code></pre>
<p>
l//--- imprimimos no log o valor do swap acumulado
</p>
<pre><code class="language-mql5">
   header=&quot;Swap:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!PositionGetDouble(POSITION_SWAP, value))
      return;
   PrintFormat(&quot;%-*s%-.2f&quot;, w, header, value);
//--- imprimimos no log o valor do lucro atual
   header=&quot;Profit:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!PositionGetDouble(POSITION_PROFIT, value))
      return;
   PrintFormat(&quot;%-*s%-.2f %s&quot;, w, header, value, currency);
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
PositionGetSymbol(), PositionSelect(), Propriedades de uma Posi√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2323
<h3>PositionGetInteger</h3>
A fun√ß√£o retorna a propriedade solicitada de uma posi√ß√£o aberta, pr√©-selecionado usando
PositionGetSymbol ou PositionSelect. A propriedade de opera√ß√£o deve ser de tipo datetime, int.
Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
long¬† PositionGetInteger(
</p>
<pre><code class="language-mql5">
   ENUM_POSITION_PROPERTY_INTEGER¬† property_id¬†     // Identificador de propriedade
   );
</code></pre>
<p>
2. Retorna true ou false dependendo do sucesso da execu√ß√£o da fun√ß√£o. Se for bem sucedido, o valor
da propriedade √© colocada em uma vari√°vel de recebimento passada por refer√™ncia no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† PositionGetInteger(
   ENUM_POSITION_PROPERTY_INTEGER¬† property_id,     // Identificador de propriedade
   long&amp;¬†                          long_var¬†        // Aqui n√≥s aceitamos o valor da p
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
property_id
[in]  Identificador de uma propriedade de opera√ß√£o. O valor pode ser um dos valores de
enumera√ß√£o ENUM_POSITION_PROPERTY_INTEGER.
long_var
[out]  Vari√°vel de tipo double, que aceita o valor da propriedade requerida.
<h3>Valor do Retorno</h3>
Valor do tipo long. Se a fun√ß√£o falhar, ser√° retornado 0.
<h3>Observa√ß√£o</h3>
For the &quot;netting&quot; interpretation of positions (ACCOUNT_MARGIN_MODE_RETAIL_NETTING and
ACCOUNT_MARGIN_MODE_EXCHANGE), only one position can exist for a symbol at any moment of
time. This position is a result of one or more deals. Do not confuse positions with valid pending
orders, which are also displayed on the Trading tab of the Toolbox window.
If individual positions are allowed (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), multiple positions
can be open for one symbol. 
Para garantir o recebimento de novos dados sobre a posi√ß√£o, √© recomendado chamar
PositionSelect() logo antes referindo-se a eles.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o Trade¬†                                                    |
//+------------------------------------------------------------------+
void OnTrade()
  {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2324
</p>
<pre><code class="language-mql5">
//--- verificar se a posi√ß√£o est√° presente e exibir a hora de sua mudan√ßa
   if(PositionSelect(_Symbol))
     {     
</code></pre>
<p>
receber ID posi√ß√£o para trabalhos futuros
</p>
<pre><code class="language-mql5">
      ulong position_ID=PositionGetInteger(POSITION_IDENTIFIER);
      Print(_Symbol,&quot; posi√ß√£o #&quot;,position_ID);
//--- receber o tempo de posi√ß√£o formando em milissegundos desde 01.01.1970
      long create_time_msc=PositionGetInteger(POSITION_TIME_MSC);
      PrintFormat(&quot;Posi√ß√£o #%d  POSITION_TIME_MSC = %i64 milissegundos =&gt; %s&quot;,position
                  create_time_msc,TimeToString(create_time_msc/1000));
//--- receber o tempo da √∫ltima altera√ß√£o da posi√ß√£o em segundos desde 01.01.1970
      long update_time_sec=PositionGetInteger(POSITION_TIME_UPDATE);
      PrintFormat(&quot;Posi√ß√£o #%d  POSITION_TIME_UPDATE = %i64 segundos =&gt; %s&quot;,
                  position_ID,update_time_sec,TimeToString(update_time_sec));
//--- receber o tempo da √∫ltima altera√ß√£o da posi√ß√£o em milissegundos desde 01.01.1970
      long update_time_msc=PositionGetInteger(POSITION_TIME_UPDATE_MSC);
      PrintFormat(&quot;Posi√ß√£o #%d  POSITION_TIME_UPDATE_MSC = %i64 milissegundos =&gt; %s&quot;,
                  position_ID,update_time_msc,TimeToString(update_time_msc/1000));
     }
//---
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
PositionGetSymbol(), PositionSelect(), Propriedades de uma Posi√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2325
<h3>PositionGetString</h3>
A fun√ß√£o retorna a propriedade solicitada de uma posi√ß√£o aberta, pr√©-selecionado usando
PositionGetSymbol ou PositionSelect. A propriedade da opera√ß√£o deve ser do tipo string. Existem 2
variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
</p>
<pre><code class="language-mql5">
string¬† PositionGetString(
   ENUM_POSITION_PROPERTY_STRING¬† property_id¬†     // Identificador de propriedade
   );
</code></pre>
<p>
2. Retorna true ou false dependendo do sucesso da execu√ß√£o da fun√ß√£o. Se for bem sucedido, o valor
da propriedade √© colocada em uma vari√°vel de recebimento passada por refer√™ncia no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† PositionGetString(
   ENUM_POSITION_PROPERTY_STRING¬† property_id,     // Identificador de propriedade
   string&amp;¬†                   string_var¬†        // Aqui recebemos o valor da propried
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
property_id
[in]  Identificador da propriedade da opera√ß√£o. O valor pode ser um dos valores da enumera√ß√£o
ENUM_POSITION_PROPERTY_STRING.
string_var
[out]  Vari√°vel de tipo string, que aceita o valor da propriedade requerida.
<h3>Valor retornado</h3>
Valor do tipo string. Se a fun√ß√£o falhar, uma string vazia √© retornada.
<h3>Observa√ß√£o</h3>
For the &quot;netting&quot; interpretation of positions (ACCOUNT_MARGIN_MODE_RETAIL_NETTING and
ACCOUNT_MARGIN_MODE_EXCHANGE), only one position can exist for a symbol at any moment of
time. This position is a result of one or more deals. Do not confuse positions with valid pending
orders, which are also displayed on the Trading tab of the Toolbox window.
If individual positions are allowed (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), multiple positions
can be open for one symbol. 
Para garantir o recebimento de novos dados sobre a posi√ß√£o, √© recomendado chamar
PositionSelect() logo antes referindo-se a eles.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2326
</p>
<pre><code class="language-mql5">
//--- no loop por todas as posi√ß√µes na conta
   int total=PositionsTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos o ticket da pr√≥xima posi√ß√£o, selecionando automaticamente a posi√ß√£
      ulong ticket=PositionGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo da posi√ß√£o e imprimimos o cabe√ßalho para a lista de proprie
      string type=(PositionGetInteger(POSITION_TYPE)==POSITION_TYPE ? &quot;Buy&quot; : &quot;Sell&quot;);
      PrintFormat(&quot;String properties of an open position %s #%I64u:&quot;, type, ticket);
      
      //--- imprimimos sob o cabe√ßalho todas as propriedades de string da posi√ß√£o sele
      PositionPropertiesStringPrint(15);
     }
   /*
¬†  Resultado:
   String properties of an open position Buy #2810798881:
   Symbol:        EURUSD
   Comment:       Test PositionGetString
   External ID:   
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log as propriedades de string da posi√ß√£o selecionada  |
//+------------------------------------------------------------------+
void PositionPropertiesStringPrint(const uint header_width=0)
  {
   uint   w=0;
   string header=&quot;&quot;;
   string value=&quot;&quot;;
   
//--- definimos o texto do cabe√ßalho e a largura do campo de cabe√ßalho
//--- se a largura do cabe√ßalho for passada para a fun√ß√£o igual a zero, a largura ser√°
   header=&quot;Symbol:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
//--- obtemos e imprimimos no log o s√≠mbolo da posi√ß√£o com um cabe√ßalho de largura def
   if(!PositionGetString(POSITION_SYMBOL, value))
      return;
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
   
//--- imprimimos no log o valor do coment√°rio da posi√ß√£o
   header=&quot;Comment:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!PositionGetString(POSITION_COMMENT, value))
      return;
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
   </p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2327
</p>
<pre><code class="language-mql5">
//--- imprimimos no log o valor do identificador da posi√ß√£o no sistema externo
   header=&quot;External ID:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!PositionGetString(POSITION_EXTERNAL_ID, value))
      return;
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
PositionGetSymbol(), PositionSelect(), Propriedades de uma Posi√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2328
<h3>PositionGetTicket</h3>
A fun√ß√£o retorna o ticket da posi√ß√£o com base no √≠ndice na lista de posi√ß√µes abertas e seleciona
automaticamente essa posi√ß√£o para que possa ser trabalhada no futuro usando as fun√ß√µes
PositionGetDouble, PositionGetInteger, PositionGetString.
ulong¬† PositionGetTicket(
</p>
<pre><code class="language-mql5">
   int¬† index¬†     // n√∫mero na lista de posi√ß√µes
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
index
[Em] √çndice da posi√ß√£o na lista de posi√ß√µes abertas, come√ßando com 0.
valor de retorno
Bilhete da posi√ß√£o. No caso de uma execu√ß√£o sem √™xito retorna 0.
<h3>Observa√ß√£o</h3>
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo.
Para garantir a recep√ß√£o de novos dados sobre as posi√ß√µes, √© recomend√°vel chamar a fun√ß√£o
PositionSelect() imediatamente antes de se dirigir a elas.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- no loop por todas as posi√ß√µes na conta
   int total=PositionsTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos o ticket da pr√≥xima posi√ß√£o, selecionando automaticamente a posi√ß√£
      ulong ticket=PositionGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo da posi√ß√£o e imprimimos a descri√ß√£o da posi√ß√£o selecionada 
      string type=(PositionGetInteger(POSITION_TYPE)==POSITION_TYPE ? &quot;Buy&quot; : &quot;Sell&quot;);
      PrintFormat(&quot;[%d] Selected position %s #%I64u&quot;, i, type, ticket);
     }
   /*</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2329
</p>
<pre><code class="language-mql5">
¬†  Resultado:
   [0] Selected position Sell #2810802718
   [1] Selected position Buy #2810802919
   */
</code></pre>
<p>
  }
<h3>Veja tamb√©m</h3>
PositionGetSymbol(), PositionSelect(), Propriedades das posi√ß√µes</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2330
<h3>OrdersTotal</h3>
Retorna o n√∫mero de ordens.
</p>
<pre><code class="language-mql5">
int¬† OrdersTotal();
</code></pre>
<p>
<h3>Valor retornado</h3>
Valor do tipo double.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens pendentes com posi√ß√µes, que tamb√©m s√£o exibidos na aba &quot;neg√≥cios&quot; da &quot;caixa
de ferramentas&quot; do terminal do cliente. Uma ordem √© um pedido para conduzir a transa√ß√£o,
enquanto que uma posi√ß√£o √© um resultado de um ou mais neg√≥cios.
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo. 
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- obtemos e imprimimos no log a quantidade de ordens pendentes ativas na conta
   int total=OrdersTotal();
   Print(&quot;Number of active pending orders on the account: &quot;, total);
   /*
¬†  Resultado:
   Number of active pending orders on the account: 2
   */
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
<h3>OrderSelect(), OrderGetTicket(), Propriedades de uma Ordem</h3></p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2331
<h3>OrderGetTicket</h3>
Retorna o ticket de uma ordem correspondente, selecionando automaticamente a ordem para
trabalhos posteriores usando fun√ß√µes.
ulong¬† OrderGetTicket(
</p>
<pre><code class="language-mql5">
   int¬† index¬†     // N√∫mero na lista de posi√ß√µes
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
index
[in]  N√∫mero de ordem na lista de ordens atuais.
<h3>Valor do Retorno</h3>
Valor do tipo ulong. Se a fun√ß√£o falhar, ser√° retornado 0.
<h3>Observa√ß√£o</h3>
N√£o confunda atuais ordens pendentes com posi√ß√µes, que tamb√©m s√£o exibidos na aba &quot;neg√≥cios&quot; da
&quot;caixa de ferramentas&quot; do terminal do cliente. Uma ordem √© um pedido para conduzir a transa√ß√£o,
enquanto que uma posi√ß√£o √© um resultado de um ou mais neg√≥cios.
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE) segundo cada s√≠mbolo, a qualquer momento, pode estar
aberta apenas a posi√ß√£o que seja o resultado de uma o mais transa√ß√µes. N√£o confunda as posi√ß√µes e
as ordens pendentes ativas que s√£o exibidas na guia &quot;Negocia√ß√£o&quot; na janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes, (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)
segundo cada s√≠mbolo, podem ao mesmo tempo existir v√°rias posi√ß√µes.
OrderGetTicket() fun√ß√£o copia os dados sobre uma ordem para o ambiente do programa, e
posteriormente chamadas de OrderGetDouble(), OrderGetInteger(), OrderGetString() retornar os
dados copiados anteriormente. Isto significa que a pr√≥pria ordem pode j√° n√£o existir (ou seu pre√ßo
de abertura, Stop Loss/Take Profit, n√≠veis de lucro ou expira√ß√£o mudou), mas ainda podem ser
obtidos dados dessa ordem. Para garantir o recebimento de novos dados sobre a posi√ß√£o, √©
recomendado chamar PositionSelect() logo antes referindo-se a eles.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
void OnStart()
  {
//--- vari√°veis ‚Äãpara retornar valores das propriedades de ordem
   ulong    ticket;
   double   open_price;
   double   initial_volume;
   datetime time_setup;
   string   symbol;
   string   type;
   long     order_magic;
   long     positionID;
//--- Numero de ordens atuais pendentes
   uint     total=OrdersTotal();</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2332
</p>
<pre><code class="language-mql5">
//--- passar por ordens em um loop
   for(uint i=0;i&lt;total;i++)
     {
      //--- voltar ticket ordem por sua posi√ß√£o na lista
      if((ticket=OrderGetTicket(i))&gt;0)
        {
         //--- retorna propriedades de uma Ordem
         open_price    =OrderGetDouble(ORDER_PRICE_OPEN);
         time_setup    =(datetime)OrderGetInteger(ORDER_TIME_SETUP);
         symbol        =OrderGetString(ORDER_SYMBOL);
         order_magic   =OrderGetInteger(ORDER_MAGIC);
         positionID    =OrderGetInteger(ORDER_POSITION_ID);
         initial_volume=OrderGetDouble(ORDER_VOLUME_INITIAL);
         type          =EnumToString(ENUM_ORDER_TYPE(OrderGetInteger(ORDER_TYPE)));
         //--- preparar e apresentar informa√ß√µes sobre a ordem
         printf(&quot;#ticket %d %s %G %s em %G foi criado em %s&quot;,
                ticket,                 // ticket de ordem
                type,                   // tipo
                initial_volume,         // volume colocado
                symbol,                 // simbolo
                open_price,             // pre√ßo de abertura especificada
                TimeToString(time_setup)// tempo de colocar a ordem
                );
        }
     }
//---
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
<h3>OrdersTotal(), OrderSelect(), OrderGetInteger()</h3></p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2333
<h3>OrderSelect</h3>
Seleciona uma ordem para trabalhar. Retorna true se a fun√ß√£o for conclu√≠da com sucesso. Retorna
false se a execu√ß√£o da fun√ß√£o falhar. Para mais detalhes sobre o erro, chame GetLastError().
</p>
<pre><code class="language-mql5">
bool¬† OrderSelect(
   ulong¬†  ticket¬†     // Ticket de ordem
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket
[in]  Ticket da ordem.
<h3>Valor retornado</h3>
Valor do tipo bool.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens pendentes com posi√ß√µes, que tamb√©m s√£o exibidos na aba &quot;neg√≥cios&quot; da &quot;caixa
de ferramentas&quot; do terminal do cliente.
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo. 
A fun√ß√£o OrderGetTicket() copia os dados de uma ordem para o ambiente do programa, e chamadas
subsequentes de OrderGetDouble(), OrderGetInteger(), OrderGetString() retornam esses dados
copiados anteriormente. Isso significa que a ordem em si pode j√° n√£o existir (ou seu pre√ßo de
abertura, Stop Loss/Take Profit, n√≠veis de lucro ou expira√ß√£o podem ter mudado), mas ainda assim
√© poss√≠vel obter os dados dessa ordem. Para garantir que os dados da posi√ß√£o estejam atualizados,
√© recomend√°vel chamar OrderSelect() logo antes de acess√°-los.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#define   EXPERT_MAGIC  123456
#define   OFFSET        50                      // desvio da ordem em rela√ß√£o ao pre√ßo
#define   DIRECTION     ORDER_TYPE_BUY_LIMIT    // tipo de ordem
#define   VOLUME        1.0                     // volume
#define   DEVIATION     2              // desvio permitido do pre√ßo
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//-- declara√ß√£o e inicializa√ß√£o da solicita√ß√£o, resultado e vari√°veis
   MqlTradeRequest request={};</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2334
</p>
<pre><code class="language-mql5">
   MqlTradeResult  result ={};
   double          order_price=0;
   
//--- par√¢metros para a coloca√ß√£o de uma ordem pendente
   request.action    = TRADE_ACTION_PENDING;                               //--- tipo 
   request.symbol    = _Symbol;                                            // s√≠mbolo
   request.volume    = volume;            // volume
   request.deviation = DEVIATION;         // desvio permitido em rela√ß√£o ao pre√ßo
   request.magic     = EXPERT_MAGIC;      // MagicNumber da ordem
   
//--- verifica√ß√£o do tipo de opera√ß√£o
   switch(DIRECTION)
     {
      case ORDER_TYPE_BUY_LIMIT :
        request.type = ORDER_TYPE_BUY_LIMIT;                               // tipo de 
        order_price  = SymbolInfoDouble(_Symbol, SYMBOL_ASK)-OFFSET*_Point;// pre√ßo pa
        request.price= NormalizeDouble(order_price, _Digits);              // pre√ßo de
        break;
      case ORDER_TYPE_SELL_LIMIT :
        request.type = ORDER_TYPE_SELL_LIMIT;                              // tipo de 
        order_price  = SymbolInfoDouble(_Symbol, SYMBOL_BID)+OFFSET*_Point;// pre√ßo de
        request.price= NormalizeDouble(order_price, _Digits);              // pre√ßo de
        break;
      case ORDER_TYPE_BUY_STOP :
        request.type = ORDER_TYPE_BUY_STOP;                                // tipo de 
        order_price  = SymbolInfoDouble(_Symbol, SYMBOL_ASK)-OFFSET*_Point;// pre√ßo pa
        request.price= NormalizeDouble(order_price, _Digits);              // pre√ßo de
        break;
      case ORDER_TYPE_SELL_STOP :
        request.type = ORDER_TYPE_SELL_STOP;                               // tipo de 
        order_price  = SymbolInfoDouble(_Symbol, SYMBOL_BID)+OFFSET*_Point;// pre√ßo de
        request.price= NormalizeDouble(order_price, _Digits);              // pre√ßo de
        break;
      default: // se a ordem selecionada n√£o for pendente ou do tipo StopLimit
        Alert(&quot;This example is only for placing pending orders BuyLimit, SellLimit, Bu
        break;
     }
//--- enviamos a solicita√ß√£o, se o envio falhar, imprimimos o c√≥digo de erro e encerra
   if(!OrderSend(request, result))
     {
      Print(&quot;OrderSend error &quot;, GetLastError());
      return;
     }
     
//--- imprimimos informa√ß√µes sobre a opera√ß√£o
   PrintFormat(&quot;Trade request result: retcode=%u, order=%I64u&quot;, result.retcode, result
   
//--- obtemos o ticket da ordem do resultado da opera√ß√£o de negocia√ß√£o e selecionamos </p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2335
</p>
<pre><code class="language-mql5">
   ulong ticket=result.order;
   ResetLastError();
   if(!OrderSelect(ticket))
     {
      PrintFormat(&quot;OrderSelect(%I64u) failed. Error %d&quot;, ticket, GetLastError());
      return;
     }
//--- imprimimos no log os dados da ordem selecionada pelo ticket
   ENUM_ORDER_TYPE   type  = (ENUM_ORDER_TYPE)OrderGetInteger(ORDER_TYPE);
   long              time  = OrderGetInteger(ORDER_TIME_SETUP_MSC);
   double            price = OrderGetDouble(ORDER_PRICE_OPEN);
   double            volume= OrderGetDouble(ORDER_VOLUME_CURRENT);
   string            symbol= OrderGetString(ORDER_SYMBOL);
   int               digits= (int)SymbolInfoInteger(symbol, SYMBOL_DIGITS);
   PrintFormat(&quot;Current selected order: %s %.2f %s #%I64u at %.*f, %s&quot;,
               symbol, volume, OrderTypeDescription(type), ticket, digits, price, Time
   /*
¬†  Resultado:
   Trade request result: retcode=10009, order=2811006719
   Current selected order: EURUSD 1.00 Buy Limit #2811006719 at 1.10550, 2024.09.04 10
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o tempo em milissegundos                                 |
//+------------------------------------------------------------------+
string TimeMscToString(const long time_msc, int flags=TIME_DATE|TIME_MINUTES|TIME_SECO
  {
   return(TimeToString(time_msc/1000, flags) + &quot;.&quot; + IntegerToString(time_msc %1000, 3
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE type)
  {
   switch(type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      default                          :  return(&quot;Unknown order type&quot;);
     }
</code></pre>
<p>
  }</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2336
<h3>Tamb√©m Veja</h3>
OrderGetInteger(), OrderGetDouble(), OrderGetString(), OrderCalcProfit(), OrderGetTicket(),
<h3>Propriedades de uma Ordem</h3></p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2337
<h3>OrderGetDouble</h3>
Retorna a propriedade solicitada de uma ordem, previamente selecionada usando OrderGetTicket ou
OrderSelect. A propriedade da ordem deve ser do tipo double. Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
</p>
<pre><code class="language-mql5">
double¬† OrderGetDouble(
   ENUM_ORDER_PROPERTY_DOUBLE¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. A fun√ß√£o retorna true ou false, dependendo se a execu√ß√£o foi bem-sucedida. Se for bem-sucedida,
o valor da propriedade √© armazenado em uma vari√°vel passada por refer√™ncia como o √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† OrderGetDouble(
   ENUM_ORDER_PROPERTY_DOUBLE¬† property_id,       // Identificador de propriedade
   double&amp;¬†                    double_var¬†        // valor da propriedade
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
property_id
[in]  Identificador da propriedade da ordem. O valor pode ser um dos valores da enumera√ß√£o
ENUM_ORDER_PROPERTY_DOUBLE.
double_var
[out]  Vari√°vel de tipo double, que aceita o valor da propriedade requerida.
<h3>Valor retornado</h3>
Valor do tipo double. Se a fun√ß√£o falhar, ser√° retornado 0.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens pendentes com posi√ß√µes, que tamb√©m s√£o exibidos na aba &quot;neg√≥cios&quot; da &quot;caixa
de ferramentas&quot; do terminal do cliente.
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo.
Para garantir que os dados da posi√ß√£o estejam atualizados, √© recomend√°vel chamar OrderSelect()
logo antes de acess√°-los.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2338
</p>
<pre><code class="language-mql5">
  {
//--- no loop pela lista de todas as ordens na conta
   int total=OrdersTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos a ordem dos tickets na lista por √≠ndice de loop
      ulong ticket=OrderGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo de ordem e gerar o cabe√ßalho da lista de propriedades reais
      string type=OrderTypeDescription((ENUM_ORDER_TYPE)OrderGetInteger(ORDER_TYPE));
      PrintFormat(&quot;Double properties of an active pending order %s #%I64u:&quot;, type, tic
      
      //--- imprimimoa todas as propriedades reais da ordem selecionada sob o cabe√ßalh
      OrderPropertiesDoublePrint(16);
     }
   /*
   Resultado:
   Double properties of an active pending order Sell Limit #2812000714:
   Volume initial: 1.00
   Volume current: 1.00
   Price open:     145.282
   StopLoss:       0.000
   TakeProfit:     0.000
   Price current:  145.044
   StopLimit:      0.000
   Double properties of an active pending order Buy Limit #2812001112:
   Volume initial: 1.00
   Volume current: 1.00
   Price open:     144.836
   StopLoss:       0.000
   TakeProfit:     0.000
   Price current:  145.051
   StopLimit:      0.000
   Double properties of an active pending order Buy Stop #2812001488:
   Volume initial: 0.50
   Volume current: 0.50
   Price open:     1.10642
   StopLoss:       0.00000
   TakeProfit:     0.00000
   Price current:  1.10530
   StopLimit:      0.00000
   Double properties of an active pending order Sell Stop #2812001712:
   Volume initial: 0.50
   Volume current: 0.50
   Price open:     1.10374
   StopLoss:       0.00000
   TakeProfit:     0.00000</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2339
</p>
<pre><code class="language-mql5">
   Price current:  1.10525
   StopLimit:      0.00000
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE type)
  {
   switch(type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      default                          :  return(&quot;Unknown order type&quot;);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log as propriedades reais da ordem selecionada        |
//+------------------------------------------------------------------+
void OrderPropertiesDoublePrint(const uint header_width=0)
  {
//--- obtemos o s√≠mbolo de ordem e o n√∫mero de casas decimais do s√≠mbolo
   string symbol = OrderGetString(ORDER_SYMBOL);
   int    digits = (int)SymbolInfoInteger(symbol, SYMBOL_DIGITS);
   
//--- imprimimos no log o volume inicial ao configurar a ordem com um cabe√ßalho de lar
   OrderPropertyPrint(&quot;Volume initial:&quot;,header_width,2,ORDER_VOLUME_INITIAL);
   
//--- imprimimos no log o valor do volume de pedidos n√£o atendidos
   OrderPropertyPrint(&quot;Volume current:&quot;,header_width,2,ORDER_VOLUME_CURRENT);
   
//--- imprimimos no log o valor do pre√ßo especificado na ordem
   OrderPropertyPrint(&quot;Price open:&quot;,header_width,digits,ORDER_PRICE_OPEN);
   
//--- imprimimos no log o valor do n√≠vel StopLoss
   OrderPropertyPrint(&quot;StopLoss:&quot;,header_width,digits,ORDER_SL);
//--- imprimimos no log o valor do n√≠vel TakeProfit
   OrderPropertyPrint(&quot;TakeProfit:&quot;,header_width,digits,ORDER_TP);
//--- imprimimos no log o valor do pre√ßo atual por s√≠mbolo da ordem
   OrderPropertyPrint(&quot;Price current:&quot;,header_width,digits,ORDER_PRICE_CURRENT);</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2340
</p>
<pre><code class="language-mql5">
//--- imprimimos no log o valor do pre√ßo de defini√ß√£o da ordem Limit quando a ordem St
   OrderPropertyPrint(&quot;StopLimit:&quot;,header_width,digits,ORDER_PRICE_STOPLIMIT);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log o valor da propriedade real da ordem              |
//+------------------------------------------------------------------+
void OrderPropertyPrint(const string header, uint header_width, int digits, ENUM_ORDER
  {
   double value=0;
   if(!OrderGetDouble(property, value))
      PrintFormat(&quot;Cannot get property %s, error=%d&quot;, EnumToString(property), GetLastE
   else
     {
      //--- se a largura do cabe√ßalho passada para a fun√ß√£o for zero, a largura ser√° o
      uint w=(header_width==0 ? header.Length()+1 : header_width);
      PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
     }
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
<h3>OrdersTotal(), OrderGetTicket(), Propriedades de uma Ordem</h3></p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2341
<h3>OrderGetInteger</h3>
Retorna a propriedade solicitada de uma ordem, previamente selecionada usando OrderGetTicket ou
OrderSelect. A propriedade da ordem deve ser do tipo datetime, int. Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
long¬† OrderGetInteger(
</p>
<pre><code class="language-mql5">
   ENUM_ORDER_PROPERTY_INTEGER¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. A fun√ß√£o vai retornar &quot;true&quot; ou &quot;false&quot;, dependendo se deu certo ou n√£o. Se der certo, o valor da
propriedade ser√° passado por refer√™ncia para uma vari√°vel de destino, que voc√™ define no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† OrderGetInteger(
   ENUM_ORDER_PROPERTY_INTEGER¬† property_id,       // Identificador de propriedade
   long&amp;¬†                       long_var¬†          // Aqui n√≥s aceitamos o valor da pr
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
property_id
[in]  Identificador da propriedade da ordem. O valor pode ser um dos valores da enumera√ß√£o
ENUM_ORDER_PROPERTY_INTEGER.
long_var
[out]  Vari√°vel do tipo long que aceita o valor da propriedade requerida.
<h3>Valor retornado</h3>
Valor do tipo long. Se a fun√ß√£o falhar, ser√° retornado 0.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens pendentes com posi√ß√µes, que tamb√©m s√£o exibidos na aba &quot;neg√≥cios&quot; da &quot;caixa
de ferramentas&quot; do terminal do cliente.
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo.
Para garantir que os dados da posi√ß√£o estejam atualizados, √© recomend√°vel chamar OrderSelect()
logo antes de acess√°-los.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2342
</p>
<pre><code class="language-mql5">
  {
//--- no loop pela lista de todas as ordens na conta
   int total=OrdersTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos a ordem dos tickets na lista por √≠ndice de loop
      ulong ticket=OrderGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo de ordem e gerar o cabe√ßalho da lista de propriedades reais
      string type=OrderTypeDescription((ENUM_ORDER_TYPE)OrderGetInteger(ORDER_TYPE));
      PrintFormat(&quot;Integer properties of an active pending order %s #%I64u:&quot;, type, ti
      
      //--- imprimimos sob o cabe√ßalho todas as propriedades inteiras da ordem selecio
      OrderPropertiesIntegerPrint(17);
     }
   /*
   Resultado:
   Integer properties of an active pending order Buy Limit #2812945317:
   Ticket:          2812945317
   Time setup:      2024.09.04 19:17:16
   Type:            Buy Limit
   State:           Placed
   Time expiration: 0
   Time done:       0
   Time setup msc:  2024.09.04 19:17:16.686
   Time done msc:   0
   Type filling:    Return
   Type time:       Time GTC
   Magic:           0
   Reason:          Client
   Position ID:     0
   Position By ID:  0
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log as propriedades inteiras da ordem selecionada     |
//+------------------------------------------------------------------+
void OrderPropertiesIntegerPrint(const uint header_width=0)
  {
   uint   w=0;
   string header=&quot;&quot;;
   long   value=0;
   
//--- imprimimos no log o ticket da ordem
   OrderPropertyPrint(&quot;Ticket:&quot;, header_width, ORDER_TICKET);
   
//--- imprimimos no log o valor do tempo de coloca√ß√£o da ordem</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2343
</p>
<pre><code class="language-mql5">
   OrderPropertyPrint(&quot;Time setup:&quot;, header_width, ORDER_TIME_SETUP);
   
//--- imprimimos no log o tipo de ordem
   OrderPropertyPrint(&quot;Type:&quot;, header_width, ORDER_TYPE);
   
//--- imprimimos no log o status da ordem
   OrderPropertyPrint(&quot;State:&quot;, header_width, ORDER_STATE);
   
//--- imprimimos no log o tempo de expira√ß√£o da ordem
   OrderPropertyPrint(&quot;Time expiration:&quot;, header_width, ORDER_TIME_EXPIRATION);
   
//--- imprimimos no log o tempo de execu√ß√£o ou remo√ß√£o da ordem
   OrderPropertyPrint(&quot;Time done:&quot;, header_width, ORDER_TIME_DONE);
   
//--- imprimimos no log o tempo de coloca√ß√£o da ordem para execu√ß√£o em milissegundos d
   OrderPropertyPrint(&quot;Time setup msc:&quot;, header_width, ORDER_TIME_SETUP_MSC);
   
//--- imprimimos no log o tempo de execu√ß√£o ou remo√ß√£o da ordem em milissegundos desde
   OrderPropertyPrint(&quot;Time done msc:&quot;, header_width, ORDER_TIME_DONE_MSC);
   
//--- imprimimos no log o tipo de execu√ß√£o pelo saldo
   OrderPropertyPrint(&quot;Type filling:&quot;, header_width, ORDER_TYPE_FILLING);
   
//--- imprimimos no log o tempo de vida da ordem
   OrderPropertyPrint(&quot;Type time:&quot;, header_width, ORDER_TYPE_TIME);
   
//--- imprimimos no log o identificador do expert que colocou a ordem
   OrderPropertyPrint(&quot;Magic:&quot;, header_width, ORDER_MAGIC);
   
//--- imprimimos no log o motivo ou fonte da coloca√ß√£o da ordem
   OrderPropertyPrint(&quot;Reason:&quot;, header_width, ORDER_REASON);
   
//--- imprimimos no log o identificador da posi√ß√£o atribu√≠do √† ordem na sua execu√ß√£o
   OrderPropertyPrint(&quot;Position ID:&quot;, header_width, ORDER_POSITION_ID);
   
//--- imprimimos no log o identificador da posi√ß√£o contr√°ria para ordens do tipo ORDER
   OrderPropertyPrint(&quot;Position By ID:&quot;, header_width, ORDER_POSITION_BY_ID);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log o valor da propriedade inteira da ordem           |
//+------------------------------------------------------------------+
void OrderPropertyPrint(const string header, uint header_width, ENUM_ORDER_PROPERTY_IN
  {
   string svalue=&quot;&quot;;
   long   lvalue=0;
   if(!OrderGetInteger(property, lvalue))
      PrintFormat(&quot;Cannot get property %s, error=%d&quot;, EnumToString(property), GetLastE
   else
     {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2344
</p>
<pre><code class="language-mql5">
      switch(property)
        {
         case ORDER_TICKET          :
         case ORDER_MAGIC           :
         case ORDER_POSITION_ID     :
         case ORDER_POSITION_BY_ID  :
           svalue=(string)lvalue;
           break;
           
         case ORDER_TIME_SETUP      :
         case ORDER_TIME_EXPIRATION :
         case ORDER_TIME_DONE       :
           svalue=(lvalue!=0 ? TimeToString((datetime)lvalue, TIME_DATE|TIME_MINUTES|T
           break;
           
         case ORDER_TIME_SETUP_MSC  :
         case ORDER_TIME_DONE_MSC   :
           svalue=(lvalue!=0 ? TimeMscToString(lvalue) : &quot;0&quot;);
           break;
           
         case ORDER_TYPE            :
           svalue=OrderTypeDescription((ENUM_ORDER_TYPE)lvalue);
           break;
         case ORDER_STATE           :
           svalue=OrderStateDescription((ENUM_ORDER_STATE)lvalue);
           break;
         case ORDER_TYPE_FILLING    :
           svalue=OrderTypeFillingDescription((ENUM_ORDER_TYPE_FILLING)lvalue);
           break;
         case ORDER_TYPE_TIME       :
           svalue=OrderTypeTimeDescription((ENUM_ORDER_TYPE_TIME)lvalue);
           break;
         case ORDER_REASON          :
           svalue=OrderReasonDescription((ENUM_ORDER_REASON)lvalue);
           break;
         
         default                    :
           svalue=&quot;Unknown property&quot;;
           break;
        }
      
      //--- se a largura do cabe√ßalho passada para a fun√ß√£o for zero, a largura ser√° o
      uint w=(header_width==0 ? header.Length()+1 : header_width);
      PrintFormat(&quot;%-*s%-s&quot;, w, header, svalue);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2345
</p>
<pre><code class="language-mql5">
string OrderTypeDescription(const ENUM_ORDER_TYPE type)
  {
   switch(type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      default                          :  return(&quot;Unknown order type: &quot;+(string)type);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o do status da ordem                         |
//+------------------------------------------------------------------+
string OrderStateDescription(ENUM_ORDER_STATE state)
  {
   switch(state)
     {
      case ORDER_STATE_STARTED         :  return(&quot;Started&quot;);
      case ORDER_STATE_PLACED          :  return(&quot;Placed&quot;);
      case ORDER_STATE_CANCELED        :  return(&quot;Canceled&quot;);
      case ORDER_STATE_PARTIAL         :  return(&quot;Partial&quot;);
      case ORDER_STATE_FILLED          :  return(&quot;Filled&quot;);
      case ORDER_STATE_REJECTED        :  return(&quot;Rejected&quot;);
      case ORDER_STATE_EXPIRED         :  return(&quot;Expired&quot;);
      case ORDER_STATE_REQUEST_ADD     :  return(&quot;Request Add&quot;);
      case ORDER_STATE_REQUEST_MODIFY  :  return(&quot;Request Modify&quot;);
      case ORDER_STATE_REQUEST_CANCEL  :  return(&quot;Request Cancel&quot;);
      default                          :  return(&quot;Unknown state: &quot;+(string)state);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o da pol√≠tica de preenchimento do vol da ordem |
//+------------------------------------------------------------------+
string OrderTypeFillingDescription(const ENUM_ORDER_TYPE_FILLING type)
  {
   switch(type)
     {
      case ORDER_FILLING_FOK     :  return(&quot;Fill or Kill&quot;);
      case ORDER_FILLING_IOC     :  return(&quot;Immediate or Cancel&quot;);
      case ORDER_FILLING_BOC     :  return(&quot;Book or Cancel&quot;);
      case ORDER_FILLING_RETURN  :  return(&quot;Return&quot;);
      default                    :  return(&quot;Unknown type filling: &quot;+(string)type);
     }
</code></pre>
<p>
  }</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2346
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do prazo de validade da ordem                |
//+------------------------------------------------------------------+
string OrderTypeTimeDescription(const ENUM_ORDER_TYPE_TIME type)
  {
   switch(type)
     {
      case ORDER_TIME_GTC           :   return(&quot;Time GTC&quot;);
      case ORDER_TIME_DAY           :   return(&quot;Time Day&quot;);
      case ORDER_TIME_SPECIFIED     :   return(&quot;Time Specified&quot;);
      case ORDER_TIME_SPECIFIED_DAY :   return(&quot;Time Specified Day&quot;);
      default                       :  return(&quot;Unknown type time: &quot;+(string)type);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o do motivo pelo qual a ordem foi feita¬†     |
//+------------------------------------------------------------------+
string OrderReasonDescription(const ENUM_ORDER_REASON reason)
  {
   switch(reason)
     {
      case ORDER_REASON_CLIENT   :  return(&quot;Client&quot;);
      case ORDER_REASON_MOBILE   :  return(&quot;Mobile&quot;);
      case ORDER_REASON_WEB      :  return(&quot;Web&quot;);
      case ORDER_REASON_EXPERT   :  return(&quot;Expert&quot;);
      case ORDER_REASON_SL       :  return(&quot;Stop Loss&quot;);
      case ORDER_REASON_TP       :  return(&quot;Take Profit&quot;);
      case ORDER_REASON_SO       :  return(&quot;Stop Out&quot;);
      default                    :  return(&quot;Unknown reason: &quot;+(string)reason);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o tempo em milissegundos                                 |
//+------------------------------------------------------------------+
string TimeMscToString(const long time_msc, int flags=TIME_DATE|TIME_MINUTES|TIME_SECO
  {
   return(TimeToString(time_msc/1000, flags) + &quot;.&quot; + IntegerToString(time_msc %1000, 3
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
<h3>OrdersTotal(), OrderGetTicket(), Propriedades de uma Ordem</h3></p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2347
<h3>OrderGetString</h3>
Retorna a propriedade solicitada de uma ordem, previamente selecionada usando OrderGetTicket ou
OrderSelect. A propriedade da ordem deve ser do tipo string. Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
</p>
<pre><code class="language-mql5">
string¬† OrderGetString(
   ENUM_ORDER_PROPERTY_STRING¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. A fun√ß√£o vai retornar &quot;true&quot; ou &quot;false&quot;, dependendo se deu certo ou n√£o. Se der certo, o valor da
propriedade ser√° passado por refer√™ncia para uma vari√°vel de destino, que voc√™ define no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† OrderGetString(
   ENUM_ORDER_PROPERTY_STRING¬† property_id,       // Identificador de propriedade
   string&amp;¬†                    string_var¬†        // Aqui n√≥s aceitamos o valor de pro
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
property_id
[in]  Identificador da propriedade da ordem. O valor pode ser um dos valores da enumera√ß√£o
ENUM_ORDER_PROPERTY_STRING.
string_var
[out]  Vari√°vel de tipo string que aceita o valor da propriedade requerida...
<h3>Valor retornado</h3>
Valor do tipo string.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens pendentes com posi√ß√µes, que tamb√©m s√£o exibidos na aba &quot;neg√≥cios&quot; da &quot;caixa
de ferramentas&quot; do terminal do cliente.
Ao usar o registro de posi√ß√µes com &quot;cobertura&quot; (ACCOUNT_MARGIN_MODE_RETAIL_NETTING e
ACCOUNT_MARGIN_MODE_EXCHANGE), para cada s√≠mbolo, em qualquer momento, pode estar
aberta apenas a posi√ß√£o que resulte de uma ou mais opera√ß√µes. N√£o confunda as posi√ß√µes com as
ordens pendentes ativas que aparecem na aba &quot;Negocia√ß√£o&quot; da janela &quot;Caixa de ferramentas&quot;.
Ao usar a exibi√ß√£o independente de posi√ß√µes (ACCOUNT_MARGIN_MODE_RETAIL_HEDGING), pode
haver v√°rias posi√ß√µes abertas ao mesmo tempo para cada s√≠mbolo. 
Para garantir que os dados da posi√ß√£o estejam atualizados, √© recomend√°vel chamar OrderSelect()
logo antes de acess√°-los.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2348
</p>
<pre><code class="language-mql5">
  {
//--- no loop pela lista de todas as ordens na conta
   int total=OrdersTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos a ordem dos tickets na lista por √≠ndice de loop
      ulong ticket=OrderGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo de ordem e geramos o cabe√ßalho da lista de propriedades de 
      string type=OrderTypeDescription((ENUM_ORDER_TYPE)OrderGetInteger(ORDER_TYPE));
      PrintFormat(&quot;String properties of an active pending order %s #%I64u:&quot;, type, tic
      
      //--- imprimimos todas as propriedades de string da ordem selecionada sob o cabe
      OrderPropertiesStringPrint(13);
     }
   /*
¬†  Resultado:
   String properties of an active pending order Sell Limit #2813781342:
   Comment:     Test OrderGetString
   Symbol:      EURUSD
   External ID: 
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log as propriedades de string da ordem selecionada    |
//+------------------------------------------------------------------+
void OrderPropertiesStringPrint(const uint header_width=0)
  {
//--- imprimimos no log o coment√°rio
   OrderPropertyPrint(&quot;Comment:&quot;, header_width, ORDER_COMMENT);
   
//--- imprimimos no log o s√≠mbolo com o qual a ordem foi colocada
   OrderPropertyPrint(&quot;Symbol:&quot;, header_width, ORDER_SYMBOL);
   
//--- imprimimos no log o identificador da ordem no sistema externo
   OrderPropertyPrint(&quot;External ID:&quot;, header_width, ORDER_EXTERNAL_ID);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log o valor da propriedade de string da ordem         |
//+------------------------------------------------------------------+
void OrderPropertyPrint(const string header, uint header_width, ENUM_ORDER_PROPERTY_ST
  {
   string value=&quot;&quot;;
   if(!OrderGetString(property, value))
      PrintFormat(&quot;Cannot get property %s, error=%d&quot;, EnumToString(property), GetLastE
   else
     {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2349
</p>
<pre><code class="language-mql5">
      //--- se a largura do cabe√ßalho passada para a fun√ß√£o for zero, a largura ser√° o
      uint w=(header_width==0 ? header.Length()+1 : header_width);
      PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE type)
  {
   switch(type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      default                          :  return(&quot;Unknown order type: &quot;+(string)type);
     }
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
<h3>OrdersTotal(), OrderGetTicket(), Propriedades de uma Ordem</h3></p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2350
<h3>HistorySelect</h3>
Recupera o hist√≥rico de transa√ß√µes e ordens para o per√≠odo do tempo de servidor especificado.
</p>
<pre><code class="language-mql5">
bool¬† HistorySelect(
   datetime¬† from_date,¬†    // a partir da data
   datetime¬† to_date¬†       // at√© √† data
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
from_date
[in]  Data de inicio do pedido.
to_date
[in]  Data de t√©rmino do pedido.
<h3>Valor do Retorno</h3>
Retorna verdadeiro true se bem sucedido, caso contr√°rio false.
<h3>Observa√ß√£o</h3>
HistorySelect() cria uma lista de pedidos e uma lista de com√©rcios em um programa de MQL5, para
posterior referindo-se aos elementos da lista usando as fun√ß√µes correspondentes. O tamanho da
lista de neg√≥cios pode ser devolvido atrav√©s da fun√ß√£o HistoryDealsTotal() o tamanho da lista de
encomendas na hist√≥ria pode ser obtida usando HistoryOrdersTotal(). Sele√ß√£o na lista de pedidos
deve ser melhor realizado por HistoryOrderGetTicket(), para itens na lista de neg√≥cios
HistoryDealGetTicket() se encaixarem melhor.
Depois de usar HistoryOrderSelect(), a lista de pedidos de hist√≥ria dispon√≠veis para o programa
MQL5 √© reposto e completada novamente pela ordem encontrada, se a busca de uma ordem do
ticket foi conclu√≠da com sucesso. O mesmo aplica-se √† lista de ofertas dispon√≠veis para o programa
MQL5 - √© reiniciado pelo HistoryDealSelect() e preenchido novamente no caso de uma recep√ß√£o bem
sucedida de um neg√≥cio pelo n√∫mero do ticket.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
void OnStart()
  {
   color BuyColor =clrBlue;
   color SellColor=clrRed;
//--- hist√≥ria do neg√≥cio pedido
   HistorySelect(0,TimeCurrent());
//--- cria objetos
   string   name;
   uint     total=HistoryDealsTotal();
   ulong    ticket=0;
   double   price;
   double   profit;
   datetime time;
   string   symbol;
   long     type;</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2351
</p>
<pre><code class="language-mql5">
   long     entry;
//--- para todos os neg√≥cios
   for(uint i=0;i&lt;total;i++)
     {
      //--- tentar obter ticket neg√≥cios
      if((ticket=HistoryDealGetTicket(i))&gt;0)
        {
         //--- obter as propriedades neg√≥cios
         price =HistoryDealGetDouble(ticket,DEAL_PRICE);
         time  =(datetime)HistoryDealGetInteger(ticket,DEAL_TIME);
         symbol=HistoryDealGetString(ticket,DEAL_SYMBOL);
         type  =HistoryDealGetInteger(ticket,DEAL_TYPE);
         entry =HistoryDealGetInteger(ticket,DEAL_ENTRY);
         profit=HistoryDealGetDouble(ticket,DEAL_PROFIT);
         //--- apenas para o s√≠mbolo atual
         if(price &amp;&amp; time &amp;&amp; symbol==Symbol())
           {
            //--- cria o pre√ßo do objeto
            name=&quot;TradeHistory_Deal_&quot;+string(ticket);
            if(entry) ObjectCreate(0,name,OBJ_ARROW_RIGHT_PRICE,0,time,price,0,0);
            else      ObjectCreate(0,name,OBJ_ARROW_LEFT_PRICE,0,time,price,0,0);
            //--- definir propriedades do objeto
            ObjectSetInteger(0,name,OBJPROP_SELECTABLE,0);
            ObjectSetInteger(0,name,OBJPROP_BACK,0);
            ObjectSetInteger(0,name,OBJPROP_COLOR,type?BuyColor:SellColor);
            if(profit!=0) ObjectSetString(0,name,OBJPROP_TEXT,&quot;Profit: &quot;+string(profit
           }
        }
     }
//--- aplicar no gr√°fico
   ChartRedraw();
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
<h3>HistoryOrderSelect(), HistoryDealSelect()</h3></p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2352
<h3>HistorySelectByPosition</h3>
Recupera o hist√≥rico de opera√ß√µes e ordens no per√≠odo e servidor especificados.
</p>
<pre><code class="language-mql5">
bool¬† HistorySelectByPosition(
   ulong ¬† position_id¬†    // identificar posi√ß√£o - POSITION_IDENTIFIER
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
position_id
[in]  Identificador de posi√ß√£o que est√° definido para cada ordem executada e cada opera√ß√£o.
<h3>Valor retornado</h3>
Retorna verdadeiro true se bem sucedido, caso contr√°rio false.
<h3>Observa√ß√£o</h3>
N√£o confunda as ordens do hist√≥rico de negocia√ß√£o com as ordens pendentes que aparecem no
separador &quot;Com√©rcio (Trade) da barra de &quot;caixa de ferramentas&quot; (Toolbox). A lista de ordens que
foram cancelados ou levaram a uma transa√ß√£o, pode ser visto na aba &quot;Hist√≥rico&quot; da &quot;caixa de
ferramentas&quot; do terminal do cliente.
HistorySelectByPosition() cria em um programa MQL5 uma lista de pedidos e uma lista de ofertas
com um identificador de posi√ß√£o especificada para refer√™ncia futura para os elementos da lista,
utilizando as fun√ß√µes apropriadas. Para conhecer o tamanho da lista de opera√ß√µes, utilizar a fun√ß√£o
HistoryDealsTotal(), o tamanho da lista de ordens hist√≥rica pode ser obtida usando
HistoryOrdersTotal(). 
<h3>Para</h3>
percorrer 
os 
elementos 
da 
lista 
de 
ordens, 
utilize
<h3>HistoryOrderGetTicket(),</h3>
para 
iterar 
os 
elementos 
da 
lista 
de 
opera√ß√µes, 
use
HistoryDealGetTicket().
Depois de usar a fun√ß√£o HistoryOrderSelect(), a lista de ordens do hist√≥rico dispon√≠vel no programa
MQL5 √© atualizada e a ordem correspondente √© adicionada, caso a busca pelo ticket da ordem tenha
sido bem-sucedida. O mesmo acontece com a lista de opera√ß√µes dispon√≠veis no programa MQL5; ela
√© atualizada pela fun√ß√£o HistoryDealSelect() e preenchida novamente caso um neg√≥cio seja
encontrado com sucesso pelo n√∫mero do ticket.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
   long  pos_id_array[];         // array para armazenar os identificadores de posi√ß√µe
//--- consultamos todo o hist√≥rico
   if(!HistorySelect(0, TimeCurrent()))
     {
      Print(&quot;HistorySelect() failed. Error &quot;, GetLastError());
      return;
     }</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2353
</p>
<pre><code class="language-mql5">
     
//--- coletamos em um array todos os IDs de posi√ß√£o que surgem apenas a partir de orde
   int total=HistoryOrdersTotal();
   for(int i=0; i&lt;total; i++)
     {
      ulong ticket=HistoryOrderGetTicket(i);
      if(ticket==0)
         continue;
      ENUM_ORDER_TYPE type=(ENUM_ORDER_TYPE)HistoryOrderGetInteger(ticket, ORDER_TYPE)
      long pos_id=HistoryOrderGetInteger(ticket, ORDER_POSITION_ID);
      if(type&lt;=ORDER_TYPE_SELL || pos_id==0)
         continue;
      
      int size=ArraySize(pos_id_array);
      if(ArrayResize(pos_id_array, size+1)==size+1)
         pos_id_array[size]=pos_id;
     }
   
//--- de acordo com a lista de identificadores de posi√ß√£o no array
   total=ArraySize(pos_id_array);
   for(int i=0; i&lt;total; i++)
     {
      //--- imprimimos no log o cabe√ßalho, bem como a lista de ordens e opera√ß√µes da p
      long position_id=pos_id_array[i];
      Print(&quot;List of orders and deals for position with ID: &quot;, position_id);
      HistorySelectByPositionProcess(position_id);
     }
   /*
¬†  Resultado:
   List of orders and deals for position with ID: 1819629924
     [0] Order Sell Limit #1819629924
     [1] Order Buy #1819633194
     [0] Entry In Deal Sell #1794972472
     [1] Entry Out Deal Buy #1794975589
   List of orders and deals for position with ID: 1841753970
     [0] Order Sell Stop #1841753970
     [1] Order Buy #1842322160
     [0] Entry In Deal Sell #1817242142
     [1] Entry Out Deal Buy #1817765341
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Seleciona o hist√≥rico de ordens e opera√ß√µes pelo ID da posi√ß√£o e¬†|
//| imprime no log a lista de ordens e opera√ß√µes dessa posi√ß√£o       |
//+------------------------------------------------------------------+
bool HistorySelectByPositionProcess(const long position_id)
  {
//--- solicitamos o hist√≥rico de opera√ß√µes e ordens que possuem o identificador de pos
   if(!HistorySelectByPosition(position_id))</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2354
</p>
<pre><code class="language-mql5">
     {
      PrintFormat(&quot;HistorySelectByPosition(%I64d) failed. Error %d&quot;, position_id, GetL
      return(false);
     }
     
//--- imprimimos no log a lista de ordens da posi√ß√£o
   int orders_total=HistoryOrdersTotal();
   for(int i=0; i&lt;orders_total; i++)
     {
      ulong ticket=HistoryOrderGetTicket(i);
      if(ticket==0)
         continue;
      ENUM_ORDER_TYPE order_type=(ENUM_ORDER_TYPE)HistoryOrderGetInteger(ticket, ORDER
      PrintFormat(&quot;  [%d] Order %s #%I64u&quot;, i, OrderTypeDescription(order_type), ticke
     }
     
//--- imprimimos no log a lista de opera√ß√µes da posi√ß√£o
   int deals_total =HistoryDealsTotal();
   for(int i=0; i&lt;deals_total; i++)
     {
      ulong ticket=HistoryDealGetTicket(i);
      if(ticket==0)
         continue;
      ENUM_DEAL_ENTRY deal_entry=(ENUM_DEAL_ENTRY)HistoryDealGetInteger(ticket, DEAL_E
      ENUM_DEAL_TYPE  deal_type= (ENUM_DEAL_TYPE)HistoryDealGetInteger(ticket, DEAL_TY
      if(deal_type!=DEAL_TYPE_BUY &amp;&amp; deal_type!=DEAL_TYPE_SELL)
         continue;
      PrintFormat(&quot;  [%d] Entry %s Deal %s #%I64u&quot;, i, DealEntryDescription(deal_entry
     }
   return(true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE type)
  {
   switch(type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      default                          :  return(&quot;Unknown order type: &quot;+(string)type);
     }
</code></pre>
<p>
  }</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2355
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de opera√ß√£o da posi√ß√£o               | 
//+------------------------------------------------------------------+
string DealTypeDescription(const ENUM_DEAL_TYPE type)
  {
   switch(type)
     {
      //--- retornamos a descri√ß√£o dos tipos de opera√ß√£o para Buy e Sell apenas,
      //--- j√° que todos os outros tipos n√£o pertencem √† posi√ß√£o
      case DEAL_TYPE_BUY   :  return(&quot;Buy&quot;);
      case DEAL_TYPE_SELL  :  return(&quot;Sell&quot;);
      default              :  return(&quot;Unknown deal type: &quot;+(string)type);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o de como a posi√ß√£o foi alterada¬†            |
//+------------------------------------------------------------------+
string DealEntryDescription(const ENUM_DEAL_ENTRY entry)
  {
   switch(entry)
     {
      case DEAL_ENTRY_IN      :  return(&quot;In&quot;);
      case DEAL_ENTRY_OUT     :  return(&quot;Out&quot;);
      case DEAL_ENTRY_INOUT   :  return(&quot;InOut&quot;);
      case DEAL_ENTRY_OUT_BY  :  return(&quot;Out by&quot;);
      case DEAL_ENTRY_STATE   :  return(&quot;Status record&quot;);
      default                 :  return(&quot;Unknown deal entry: &quot;+(string)entry);
     }
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryOrderGetTicket(), Propriedades de uma Ordem</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2356
<h3>HistoryOrderSelect</h3>
Seleciona uma ordem a partir do hist√≥rico para posterior chamada usando as fun√ß√µes correspondentes.
Retorna true se a fun√ß√£o foi bem sucedida. Retorna false se a fun√ß√£o n√£o foi bem sucedida. Para mais
detalhes sobre o erro, chame GetLastError().
</p>
<pre><code class="language-mql5">
bool¬† HistoryOrderSelect(
   ulong¬† ticket¬†     // Ticket de ordem
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket
[in]  Ticket da ordem.
<h3>Valor retornado</h3>
Retorna true se bem sucedido, caso contr√°rio false.
<h3>Observa√ß√£o</h3>
N√£o confunda as ordens do hist√≥rico de negocia√ß√£o com as ordens pendentes que aparecem no
separador &quot;Com√©rcio (Trade) da barra de &quot;caixa de ferramentas&quot; (Toolbox). A lista de ordens que
foram cancelados ou levaram a uma transa√ß√£o, pode ser visto na aba &quot;Hist√≥rico&quot; da &quot;caixa de
ferramentas&quot; do terminal do cliente.
HistoryOrderSelect() limpa a lista de ordens dispon√≠veis para consulta em um programa MQL5 a
partir do hist√≥rico, e copia os dados para uma √∫nica ordem, caso a execu√ß√£o de HistoryOrderSelect()
seja conclu√≠da com sucesso. Se for preciso iterar todas as opera√ß√µes selecionas mediante
HistorySelect() , use HistoryOrderGetTicket().
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#define   TICKET    1819621374   // ticket de qualquer ordem conhecida, por exemplo, d
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- selecionamos a ordem hist√≥rica pelo ticket especificado em TICKET
   if(!HistoryOrderSelect(TICKET))
     {
      PrintFormat(&quot;HistoryOrderSelect(%I64u) failed. Error %d&quot;, TICKET, GetLastError()
      return;
     }
//--- se a ordem for selecionada com sucesso, obtemos seus dados e imprimimos a descri
   ENUM_ORDER_TYPE   order_type  = (ENUM_ORDER_TYPE)HistoryOrderGetInteger(TICKET, ORD
   ENUM_ORDER_STATE  order_state = (ENUM_ORDER_STATE)HistoryOrderGetInteger(TICKET, OR
   ENUM_ORDER_REASON order_reason= (ENUM_ORDER_REASON)HistoryOrderGetInteger(TICKET, O
   long              order_time  = HistoryOrderGetInteger(TICKET, ORDER_TIME_SETUP_MSC
   string            order_symbol=HistoryOrderGetString(TICKET, ORDER_SYMBOL);</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2357
</p>
<pre><code class="language-mql5">
   double            order_vol_init=HistoryOrderGetDouble(TICKET, ORDER_VOLUME_INITIAL
   double            order_vol_curr=HistoryOrderGetDouble(TICKET, ORDER_VOLUME_CURRENT
   PrintFormat(&quot;%s Order %.2f/%s %s #%I64u %s by %s at %s&quot;,
               order_symbol, order_vol_init, (order_vol_curr&gt;0 ? DoubleToString(order_
               OrderTypeDescription(order_type), TICKET, OrderStateDescription(order_s
               OrderReasonDescription(order_reason), TimeMscToString(order_time));
   /*
¬†  resultado para os v√°rios tickets especificados:
   EURUSD Order 0.50/0.50 Buy Limit #2812894647 Canceled by Client at 2024.09.04 19:02
   EURUSD Order 0.10/0 Sell #1753011743 Filled by Take Profit at 2023.06.12 17:04:20.3
   GBPUSD Order 0.10/0 Buy #1819621374 Filled by Client at 2023.07.24 06:16:25.746
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE type)
  {
   switch(type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      default                          :  return(&quot;Unknown order type: &quot;+(string)type);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o do status da ordem                         |
//+------------------------------------------------------------------+
string OrderStateDescription(ENUM_ORDER_STATE state)
  {
   switch(state)
     {
      case ORDER_STATE_STARTED         :  return(&quot;Started&quot;);
      case ORDER_STATE_PLACED          :  return(&quot;Placed&quot;);
      case ORDER_STATE_CANCELED        :  return(&quot;Canceled&quot;);
      case ORDER_STATE_PARTIAL         :  return(&quot;Partial&quot;);
      case ORDER_STATE_FILLED          :  return(&quot;Filled&quot;);
      case ORDER_STATE_REJECTED        :  return(&quot;Rejected&quot;);
      case ORDER_STATE_EXPIRED         :  return(&quot;Expired&quot;);
      case ORDER_STATE_REQUEST_ADD     :  return(&quot;Request Add&quot;);
      case ORDER_STATE_REQUEST_MODIFY  :  return(&quot;Request Modify&quot;);
      case ORDER_STATE_REQUEST_CANCEL  :  return(&quot;Request Cancel&quot;);
      default                          :  return(&quot;Unknown state: &quot;+(string)state);</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2358
</p>
<pre><code class="language-mql5">
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o do motivo pelo qual a ordem foi feita¬†     |
//+------------------------------------------------------------------+
string OrderReasonDescription(const ENUM_ORDER_REASON reason)
  {
   switch(reason)
     {
      case ORDER_REASON_CLIENT   :  return(&quot;Client&quot;);
      case ORDER_REASON_MOBILE   :  return(&quot;Mobile&quot;);
      case ORDER_REASON_WEB      :  return(&quot;Web&quot;);
      case ORDER_REASON_EXPERT   :  return(&quot;Expert&quot;);
      case ORDER_REASON_SL       :  return(&quot;Stop Loss&quot;);
      case ORDER_REASON_TP       :  return(&quot;Take Profit&quot;);
      case ORDER_REASON_SO       :  return(&quot;Stop Out&quot;);
      default                    :  return(&quot;Unknown reason: &quot;+(string)reason);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o tempo em milissegundos                                 |
//+------------------------------------------------------------------+
string TimeMscToString(const long time_msc, int flags=TIME_DATE|TIME_MINUTES|TIME_SECO
  {
   return(TimeToString(time_msc/1000, flags) + &quot;.&quot; + IntegerToString(time_msc %1000, 3
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryOrderGetTicket(), Propriedades de uma Ordem</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2359
<h3>HistoryOrdersTotal</h3>
Retorna o n√∫mero de ordens no hist√≥rico. Antes de chamar HistoryOrdersTotal(), primeiro √©
necess√°rio receber o hist√≥rico de opera√ß√µes e ordens usando quer seja a fun√ß√£o HistorySelect() ou
HistorySelectByPosition(). 
</p>
<pre><code class="language-mql5">
int¬† HistoryOrdersTotal();
</code></pre>
<p>
<h3>Valor retornado</h3>
Valor do tipo double.
<h3>Observa√ß√£o</h3>
N√£o confunda as ordens do hist√≥rico de negocia√ß√£o com as ordens pendentes que aparecem no
separador &quot;Com√©rcio (Trade) da barra de &quot;caixa de ferramentas&quot; (Toolbox). A lista de ordens que
foram cancelados ou levaram a uma transa√ß√£o, pode ser visto na aba &quot;Hist√≥rico&quot; da &quot;caixa de
ferramentas&quot; do terminal do cliente.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- solicitamos todo o hist√≥rico dispon√≠vel na conta
   if(!HistorySelect(0, TimeCurrent()))
     {
      Print(&quot;HistorySelect() failed. Error &quot;, GetLastError());
      return;
     }
//--- obtemos o n√∫mero de ordens na lista e imprimimos o valor no log
   int total=HistoryOrdersTotal();
   Print(&quot;Number of historical orders on the account: &quot;, total);
   /*
   Resultado:
   Number of historical orders on the account: 496
   */
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryOrderSelect(), HistoryOrderGetTicket(), Propriedades de uma Ordem</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2360
<h3>HistoryOrderGetTicket</h3>
Retornar o ticket de uma ordem correspondente no hist√≥rico. Antes de chamar HistoryDealGetTicket(),
primeiro √© necess√°rio receber o hist√≥rico de neg√≥cios e ordens utilizando a fun√ß√£o HistorySelect() ou a
fun√ß√£o HistorySelectByPosition().
ulong¬† HistoryOrderGetTicket(
</p>
<pre><code class="language-mql5">
   int¬† index¬†     // N√∫mero na lista de posi√ß√µes
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
index
[in]  N√∫mero de ordens em uma lista de ordens.
<h3>Valor do Retorno</h3>
Valor do tipo ulong. Se a fun√ß√£o falhar, ser√° retornado 0.
<h3>Observa√ß√£o</h3>
N√£o confundir ordens de um hist√≥rico de negocia√ß√£o com as ordens pendentes que aparecem no
separador &quot;Com√©rcio (Trade) da barra de &quot;caixa de ferramentas&quot; (Toolbox). A lista de ordens que
foram cancelados ou levaram a uma transa√ß√£o, pode ser visto na aba &quot;Hist√≥rico&quot; da &quot;caixa de
ferramentas&quot; do terminal do cliente.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
void OnStart()
  {
   datetime from=0;
   datetime to=TimeCurrent();
//--- solicitar todo o hist√≥rico
   HistorySelect(from,to);
//--- vari√°veis ‚Äãpara retornar valores das propriedades de ordem
   ulong    ticket;
   double   open_price;
   double   initial_volume;
   datetime time_setup;
   datetime time_done;
   string   symbol;
   string   type;
   long     order_magic;
   long     positionID;
//--- Numero de ordens atuais pendentes
   uint     total=HistoryOrdersTotal();
//--- passar por ordens em um loop
   for(uint i=0;i&lt;total;i++)
     {
      //--- voltar ticket ordem por sua posi√ß√£o na lista
      if((ticket=HistoryOrderGetTicket(i))&gt;0)
        {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2361
</p>
<pre><code class="language-mql5">
         //--- retorna propriedades de uma Ordem
         open_price=       HistoryOrderGetDouble(ticket,ORDER_PRICE_OPEN);
         time_setup=       (datetime)HistoryOrderGetInteger(ticket,ORDER_TIME_SETUP);
         time_done=        (datetime)HistoryOrderGetInteger(ticket,ORDER_TIME_DONE);
         symbol=           HistoryOrderGetString(ticket,ORDER_SYMBOL);
         order_magic=      HistoryOrderGetInteger(ticket,ORDER_MAGIC);
         positionID =      HistoryOrderGetInteger(ticket,ORDER_POSITION_ID);
         initial_volume=   HistoryOrderGetDouble(ticket,ORDER_VOLUME_INITIAL);
         type=GetOrderType(HistoryOrderGetInteger(ticket,ORDER_TYPE));
         //--- preparar e apresentar informa√ß√µes sobre a ordem
         printf(&quot;#ticket %d %s %G %s at %G foi criado em %s =&gt; feito em %s, pos ID=%d&quot;
                ticket,                  // ticket de ordem
                type,                    // tipo
                initial_volume,          // volume colocado
                symbol,                  // simbolo
                open_price,              // pre√ßo de abertura especificado
                TimeToString(time_setup),// tempo de colocar ordem
                TimeToString(time_done), // tempo de deletar ou executar a ordem
                positionID               // ID de uma posi√ß√£o, ao qual a quantidade de
                );
        }
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o nome string do tipo de ordem                           |
//+------------------------------------------------------------------+
string GetOrderType(long type)
  {
   string str_type=&quot;unknown operation&quot;;
   switch(type)
     {
      case (ORDER_TYPE_BUY):            return(&quot;compra&quot;);
      case (ORDER_TYPE_SELL):           return(&quot;vender&quot;);
      case (ORDER_TYPE_BUY_LIMIT):      return(&quot;buy limit&quot;);
      case (ORDER_TYPE_SELL_LIMIT):     return(&quot;sell limit&quot;);
      case (ORDER_TYPE_BUY_STOP):       return(&quot;buy stop&quot;);
      case (ORDER_TYPE_SELL_STOP):      return(&quot;sell stop&quot;);
      case (ORDER_TYPE_BUY_STOP_LIMIT): return(&quot;buy stop limit&quot;);
      case (ORDER_TYPE_SELL_STOP_LIMIT):return(&quot;sell stop limit&quot;);
     }
   return(str_type);
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryOrdersTotal(), HistoryOrderSelect(), Propriedades de uma Ordem</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2362
<h3>HistoryOrderGetDouble</h3>
Retorna a propriedade da ordem. A propriedade da ordem deve ser do tipo double. Existem 2
variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
</p>
<pre><code class="language-mql5">
double¬† HistoryOrderGetDouble(
   ulong¬†                      ticket_number,¬†    // Ticket (bilhete)
   ENUM_ORDER_PROPERTY_DOUBLE¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. A fun√ß√£o vai retornar &quot;true&quot; ou &quot;false&quot;, dependendo se deu certo ou n√£o. Se der certo, o valor da
propriedade ser√° passado por refer√™ncia para uma vari√°vel de destino, que voc√™ define no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† HistoryOrderGetDouble(
   ulong¬†                      ticket_number,¬†    // Ticket (bilhete)
   ENUM_ORDER_PROPERTY_DOUBLE¬† property_id,       // Identificador da propriedade
   double&amp;¬†                    double_var¬†        // valor da propriedade
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket_number
[in]  Ticket da ordem.
property_id
[in]  Identificador da propriedade da ordem. O valor pode ser um dos valores da enumera√ß√£o
ENUM_ORDER_PROPERTY_DOUBLE.
double_var
[out]  Vari√°vel de tipo double, que aceita o valor da propriedade requerida.
<h3>Valor retornado</h3>
Valor do tipo double.
<h3>Observa√ß√£o</h3>
N√£o confunda as ordens do hist√≥rico de negocia√ß√£o com as ordens pendentes que aparecem no
separador &quot;Com√©rcio (Trade) da barra de &quot;caixa de ferramentas&quot; (Toolbox). A lista de ordens que
foram cancelados ou levaram a uma transa√ß√£o, pode ser visto na aba &quot;Hist√≥rico&quot; da &quot;caixa de
ferramentas&quot; do terminal do cliente.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- solicitamos o hist√≥rico de opera√ß√µes e ordens
   if(!HistorySelect(0, TimeCurrent()))</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2363
</p>
<pre><code class="language-mql5">
     {
      Print(&quot;HistorySelect() failed. Error &quot;, GetLastError());
      return;
     }
     
//--- em um loop pela lista de todos os pedidos hist√≥ricos da conta
   int total=HistoryOrdersTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos a ordem dos tickets na lista por √≠ndice de loop
      ulong ticket=HistoryOrderGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo de ordem e gerar o cabe√ßalho da lista de propriedades reais
      string type=OrderTypeDescription((ENUM_ORDER_TYPE)HistoryOrderGetInteger(ticket,
      PrintFormat(&quot;Double properties of an history order %s #%I64u:&quot;, type, ticket);
      
      //--- imprimimoa todas as propriedades reais da ordem selecionada sob o cabe√ßalh
      HistoryOrderPropertiesDoublePrint(ticket, 16);
     }
   /*
¬†  Resultado:
   Double properties of an history order Sell #2810847541:
   Volume initial: 0.50
   Volume current: 0.00
   Price open:     1.10491
   StopLoss:       0.00000
   TakeProfit:     0.00000
   Price current:  1.10491
   StopLimit:      0.00000
   Double properties of an history order Buy Limit #2811003507:
   Volume initial: 1.00
   Volume current: 1.00
   Price open:     1.10547
   StopLoss:       0.00000
   TakeProfit:     0.00000
   Price current:  1.10591
   StopLimit:      0.00000
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprimimos no log as propriedades reais¬†                         |
//| da ordem hist√≥rica escolhida                                     |
//+------------------------------------------------------------------+
void HistoryOrderPropertiesDoublePrint(const long ticket, const uint header_width=0)
  {
   uint   w=0;
   string header=&quot;&quot;;</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2364
</p>
<pre><code class="language-mql5">
   double value=0;
   
//--- obtemos o s√≠mbolo de ordem e o n√∫mero de casas decimais do s√≠mbolo
   string symbol = HistoryOrderGetString(ticket, ORDER_SYMBOL);
   int    digits = (int)SymbolInfoInteger(symbol, SYMBOL_DIGITS);
   
//--- definimos o texto do cabe√ßalho e a largura do campo de cabe√ßalho
//--- se a largura do cabe√ßalho for passada para a fun√ß√£o igual a zero, a largura ser√°
   header=&quot;Volume initial:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
//--- obtemos e imprimimos no log o volume inicial ao colocar uma ordem com o cabe√ßalh
   if(!HistoryOrderGetDouble(ticket, ORDER_VOLUME_INITIAL, value))
      return;
   PrintFormat(&quot;%-*s%-.2f&quot;, w, header, value);
   
//--- imprimimos no log o valor do volume de pedidos n√£o atendidos
   header=&quot;Volume current:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryOrderGetDouble(ticket, ORDER_VOLUME_CURRENT, value))
      return;
   PrintFormat(&quot;%-*s%-.2f&quot;, w, header, value);
   
//--- imprimimos no log o valor do pre√ßo especificado na ordem
   header=&quot;Price open:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryOrderGetDouble(ticket, ORDER_PRICE_OPEN, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
   
//--- imprimimos no log o valor do n√≠vel StopLoss
   header=&quot;StopLoss:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryOrderGetDouble(ticket, ORDER_SL, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
//--- imprimimos no log o valor do n√≠vel TakeProfit
   header=&quot;TakeProfit:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryOrderGetDouble(ticket, ORDER_TP, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
//--- imprimimos no log o valor do pre√ßo atual por s√≠mbolo da ordem
   header=&quot;Price current:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryOrderGetDouble(ticket, ORDER_PRICE_CURRENT, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2365
</p>
<pre><code class="language-mql5">
//--- imprimimos no log o valor do pre√ßo de defini√ß√£o da ordem Limit quando a ordem St
   header=&quot;StopLimit:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryOrderGetDouble(ticket, ORDER_PRICE_STOPLIMIT, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE type)
  {
   switch(type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      default                          :  return(&quot;Unknown order type&quot;);
     }
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryOrdersTotal(), HistoryOrderSelect(), Propriedades de uma Ordem</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2366
<h3>HistoryOrderGetInteger</h3>
Retorna a propriedade solicitada de uma ordem. A propriedade de opera√ß√£o deve ser de tipo datetime,
int. Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
long¬† HistoryOrderGetInteger(
</p>
<pre><code class="language-mql5">
   ulong¬†                       ticket_number,¬†    // Ticket (bilhete)
   ENUM_ORDER_PROPERTY_INTEGER¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. Retorna true ou false dependendo do sucesso da fun√ß√£o. Se for bem sucedido, o valor da
propriedade est√° situada dentro de uma vari√°vel de destino passado por refer√™ncia pelo √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† HistoryOrderGetInteger(
   ulong¬†                       ticket_number,¬†    // Ticket (bilhete)
   ENUM_ORDER_PROPERTY_INTEGER¬† property_id,       // Identificador de propriedade
   long&amp;¬†                       long_var¬†          // Aqui n√≥s aceitamos o valor da pr
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket_number
[in]  Ticket de ordem.
property_id
[in]  Identificador da propriedade ordem. O valor pode ser um dos valores da enumera√ß√£o
ENUM_ORDER_PROPERTY_INTEGER.
long_var
[out]  Vari√°vel do tipo long que aceita o valor da propriedade requerida.
<h3>Valor do Retorno</h3>
Valor do tipo long.
<h3>Observa√ß√£o</h3>
N√£o confundir ordens de um hist√≥rico de negocia√ß√£o com as ordens pendentes que aparecem no
separador &quot;Com√©rcio (Trade) da barra de &quot;caixa de ferramentas&quot; (Toolbox). A lista de ordens que
foram cancelados ou levaram a uma transa√ß√£o, pode ser visto na aba &quot;Hist√≥rico&quot; da &quot;caixa de
ferramentas&quot; do terminal do cliente.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o Trade¬†                                                    |
//+------------------------------------------------------------------+
void OnTrade()
  {
//--- receber ticket da √∫ltima ordem do hist√≥rico comercial da semana
   ulong last_order=GetLastOrderTicket();</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2367
</p>
<pre><code class="language-mql5">
   if(HistoryOrderSelect(last_order))
     {
      //--- tempo de colocar um ordem em milissegundos desde 01.01.1970
      long time_setup_msc=HistoryOrderGetInteger(last_order,ORDER_TIME_SETUP_MSC);
      PrintFormat(&quot;Ordem #%d ORDER_TIME_SETUP_MSC=%i64 =&gt; %s&quot;,
                  last_order,time_setup_msc,TimeToString(time_setup_msc/1000));
      //--- execu√ß√£o/cancelamento de ordens em milissegundos desde 01.01.1970
      long  time_done_msc=HistoryOrderGetInteger(last_order,ORDER_TIME_DONE_MSC);
      PrintFormat(&quot;Ordem #%d ORDER_TIME_DONE_MSC=%i64 =&gt; %s&quot;,
                  last_order,time_done_msc,TimeToString(time_done_msc/1000));
     }
   else // notifica√ß√£o sobre falha
      PrintFormat(&quot;HistoryOrderSelect() falhou por #%d. C√≥digo de erro=%d&quot;,
                  last_order,GetLastError());
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o √∫ltimo ticket de ordem em hist√≥rico ou -1¬†             |
//+------------------------------------------------------------------+
</code></pre>
<p>
ulong GetLastOrderTicket()
</p>
<pre><code class="language-mql5">
  {
</code></pre>
<p>
requisita o hist√≥rico para os √∫ltimos 7 dias
</p>
<pre><code class="language-mql5">
   if(!GetTradeHistory(7))
     {
      //--- notificar sobre chamada sem sucesso e retorno -1
      Print(__FUNCTION__,&quot; HistorySelect() retornou false&quot;);
      return -1;
     }
//--- 
   ulong first_order,last_order,orders=HistoryOrdersTotal();
//--- trabalhar com ordens se houver alguma
   if(orders&gt;0)
     {
      Print(&quot;Ordens = &quot;,orders);
      first_order=HistoryOrderGetTicket(0);
      PrintFormat(&quot;first_order = %d&quot;,first_order);
      if(orders&gt;1)
        {
         last_order=HistoryOrderGetTicket((int)orders-1);
         PrintFormat(&quot;last_order = %d&quot;,last_order);
         return last_order;
        }
      return first_order;
     }
//--- nenhuma ordem encontrada, retornar -1
   return -1;
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+---------------------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2368
</p>
<pre><code class="language-mql5">
//| Solicita√ß√µes de hist√≥rico para os √∫ltimos dias e retorna false em caso de falha¬†|
//+---------------------------------------------------------------------------------+
bool GetTradeHistory(int days)
  {
//--- define um per√≠odo da semana para solicitar hist√≥rico da opera√ß√£o
   datetime to=TimeCurrent();
   datetime from=to-days*PeriodSeconds(PERIOD_D1);
   ResetLastError();
//--- fazer um pedido e verificar o resultado
   if(!HistorySelect(from,to))
     {
      Print(__FUNCTION__,&quot; HistorySelect=false. C√≥digo de erro=&quot;,GetLastError());
      return false;
     }
//--- hist√≥rico recebido com sucesso
   return true;
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryOrdersTotal(), HistoryOrderSelect(), Propriedades de uma Ordem</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2369
<h3>HistoryOrderGetString</h3>
Retorna a propriedade solicitada de uma ordem. A propriedade da ordem deve ser do tipo string.
Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
</p>
<pre><code class="language-mql5">
string¬† HistoryOrderGetString(
   ulong¬†                      ticket_number,¬†    // Ticket (bilhete)
   ENUM_ORDER_PROPERTY_STRING¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. A fun√ß√£o vai retornar &quot;true&quot; ou &quot;false&quot;, dependendo se deu certo ou n√£o. Se der certo, o valor da
propriedade ser√° passado por refer√™ncia para uma vari√°vel de destino, que voc√™ define no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† HistoryOrderGetString(
   ulong¬†                      ticket_number,¬†    // Ticket (bilhete)
   ENUM_ORDER_PROPERTY_STRING¬† property_id,       // Identificador de propriedade
   string&amp;¬†                    string_var¬†        // Aqui n√≥s aceitamos o valor de pro
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket_number
[in]  Ticket da ordem.
property_id
[in]  Identificador da propriedade da ordem. O valor pode ser um dos valores da enumera√ß√£o
ENUM_ORDER_PROPERTY_STRING.
string_var
[out]  Vari√°vel do tipo string.
<h3>Valor retornado</h3>
Valor do tipo string.
<h3>Observa√ß√£o</h3>
N√£o confunda as ordens do hist√≥rico de negocia√ß√£o com as ordens pendentes que aparecem no
separador &quot;Com√©rcio (Trade) da barra de &quot;caixa de ferramentas&quot; (Toolbox). A lista de ordens que
foram cancelados ou levaram a uma transa√ß√£o, pode ser visto na aba &quot;Hist√≥rico&quot; da &quot;caixa de
ferramentas&quot; do terminal do cliente.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- solicitamos o hist√≥rico de opera√ß√µes e ordens
   if(!HistorySelect(0, TimeCurrent()))</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2370
</p>
<pre><code class="language-mql5">
     {
      Print(&quot;HistorySelect() failed. Error &quot;, GetLastError());
      return;
     }
     
//--- em um loop pela lista de todos os pedidos hist√≥ricos da conta
   int total=HistoryOrdersTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos a ordem dos tickets na lista por √≠ndice de loop
      ulong ticket=HistoryOrderGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo de ordem e geramos o cabe√ßalho da lista de propriedades de 
      string type=OrderTypeDescription((ENUM_ORDER_TYPE)HistoryOrderGetInteger(ticket,
      PrintFormat(&quot;String properties of an history order %s #%I64u:&quot;, type, ticket);
      
      //--- imprimimos todas as propriedades de string da ordem selecionada sob o cabe
      HistoryOrderPropertiesStringPrint(ticket, 16);
     }
   /*
¬†  Resultado:
   String properties of an history order Buy #2646074112:
   Comment:        [tp 1.09137]
   Symbol:         EURUSD
   External ID:    
   String properties of an history order Buy #2646131906:
   Comment:        
   Symbol:         EURUSD
   External ID:    
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log as propriedades de string¬†                        |
//| da ordem hist√≥rica escolhida                                     |
//+------------------------------------------------------------------+
void HistoryOrderPropertiesStringPrint(const long ticket, const uint header_width=0)
  {
   uint   w=0;
   string header=&quot;&quot;;
   string value=&quot;&quot;;
   
//--- definimos o texto do cabe√ßalho e a largura do campo de cabe√ßalho
//--- se a largura do cabe√ßalho for passada para a fun√ß√£o igual a zero, a largura ser√°
   header=&quot;Comment:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
//--- recebemos e imprimimos no log um coment√°rio com um cabe√ßalho da largura definida
   if(!HistoryOrderGetString(ticket, ORDER_COMMENT, value))</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2371
</p>
<pre><code class="language-mql5">
      return;
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
   
//--- imprimimos no log o s√≠mbolo com o qual a ordem foi colocada
   header=&quot;Symbol:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryOrderGetString(ticket, ORDER_SYMBOL, value))
      return;
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
   
//--- imprimimos no log o identificador da ordem no sistema externo
   header=&quot;External ID:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryOrderGetString(ticket, ORDER_EXTERNAL_ID, value))
      return;
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o do tipo de ordem¬†                            |
//+------------------------------------------------------------------+
string OrderTypeDescription(const ENUM_ORDER_TYPE type)
  {
   switch(type)
     {
      case ORDER_TYPE_BUY              :  return(&quot;Buy&quot;);
      case ORDER_TYPE_SELL             :  return(&quot;Sell&quot;);
      case ORDER_TYPE_BUY_LIMIT        :  return(&quot;Buy Limit&quot;);
      case ORDER_TYPE_SELL_LIMIT       :  return(&quot;Sell Limit&quot;);
      case ORDER_TYPE_BUY_STOP         :  return(&quot;Buy Stop&quot;);
      case ORDER_TYPE_SELL_STOP        :  return(&quot;Sell Stop&quot;);
      case ORDER_TYPE_BUY_STOP_LIMIT   :  return(&quot;Buy Stop Limit&quot;);
      case ORDER_TYPE_SELL_STOP_LIMIT  :  return(&quot;Sell Stop Limit&quot;);
      default                          :  return(&quot;Unknown order type: &quot;+(string)type);
     }
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryOrdersTotal(), HistoryOrderSelect(), Propriedades de uma Ordem</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2372
<h3>HistoryDealSelect</h3>
Seleciona uma opera√ß√£o no hist√≥rico para ser usada em chamadas futuras atrav√©s das fun√ß√µes
apropriadas. Retorna true se a fun√ß√£o foi bem sucedida. Retorna false se a fun√ß√£o n√£o foi bem
sucedida. Para mais detalhes sobre o erro, chame GetLastError().
</p>
<pre><code class="language-mql5">
bool¬† HistoryDealSelect(
   ulong¬† ticket¬†     // Ticket da opera√ß√£o
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket
[in]  Ticket de opera√ß√£o.
<h3>Valor retornado</h3>
Retorna true se bem sucedido, caso contr√°rio false.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens,  opera√ß√µes e posi√ß√µes. Cada opera√ß√£o √© o resultado da execu√ß√£o de uma
ordem, cada posi√ß√£o √© a soma de uma ou mais opera√ß√µes.
HistoryDealSelect() limpa a lista de opera√ß√µes dispon√≠veis para consulta em um programa MQL5, e
copia uma √∫nica opera√ß√£o se a execu√ß√£o de HistoryDealSelect() for bem-sucedida.. Para iterar todas
as opera√ß√µes selecionadas pela fun√ß√£o HistorySelect(), use HistoryDealGetTicket().
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
#define   TICKET    2620919264   // ticket de qualquer opera√ß√£o conhecida, por exemplo
</code></pre>
<p>
long      ExtTicket=TICKET;      // armazenamos o ticket fornecido em uma vari√°vel a p
</p>
<pre><code class="language-mql5">
                                 // ou processamos as opera√ß√µes no manipulador OnTrade
//+------------------------------------------------------------------+
//| Expert TradeTransaction handler                                  |
//+------------------------------------------------------------------+
void OnTradeTransaction(const MqlTradeTransaction&amp; trans,
                        const MqlTradeRequest&amp; request,
                        const MqlTradeResult&amp; result)
  {
   //--- se for uma transa√ß√£o, adicionamos ressa transa√ß√£o ao hist√≥rico
   if(trans.type==TRADE_TRANSACTION_DEAL_ADD)
     {
      //--- selecionamos uma opera√ß√£o por ticket, obtemos seus dados e imprimimos a de
      HistoryDealSelectProcess(trans.deal);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2373
</p>
<pre><code class="language-mql5">
void OnStart()
  {
//--- selecionamos uma opera√ß√£o por ticket, obtemos seus dados e imprimimos a descri√ß√£
   HistoryDealSelectProcess(ExtTicket);
   /*
</code></pre>
<p>
<h3>Resultado:</h3>
</p>
<pre><code class="language-mql5">
   (Position ID #2645974677) EURUSD Deal Out 0.10 Buy #2620919264 by order #2646028969
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Seleciona a opera√ß√£o do ticket e imprime os dados da mesma no log|
//+------------------------------------------------------------------+
void HistoryDealSelectProcess(const ulong deal_ticket)
  {
//--- selecionamos a opera√ß√£o hist√≥rica do bilhete especificado em deal_ticket
   ResetLastError();
   if(!HistoryDealSelect(deal_ticket))
     {
      PrintFormat(&quot;HistoryDealSelect(%I64u) failed. Error %d&quot;, deal_ticket, GetLastErr
      return;
     }
//--- se a opera√ß√£o for selecionada com sucesso, obtemos seus dados e imprimimos a des
   ENUM_DEAL_TYPE    deal_type  = (ENUM_DEAL_TYPE)HistoryDealGetInteger(ExtTicket, DEA
   ENUM_DEAL_ENTRY   deal_entry = (ENUM_DEAL_ENTRY)HistoryDealGetInteger(ExtTicket, DE
   ENUM_DEAL_REASON  deal_reason= (ENUM_DEAL_REASON)HistoryDealGetInteger(ExtTicket, D
   long              deal_time  = HistoryDealGetInteger(ExtTicket, DEAL_TIME_MSC);
   long              deal_order = HistoryDealGetInteger(ExtTicket, DEAL_ORDER);
   long              deal_pos_id= HistoryDealGetInteger(ExtTicket, DEAL_POSITION_ID);
   string            deal_symbol= HistoryDealGetString(ExtTicket, DEAL_SYMBOL);
   double            deal_volume= HistoryDealGetDouble(ExtTicket, DEAL_VOLUME);
   double            deal_price = HistoryDealGetDouble(ExtTicket, DEAL_PRICE);
   int               digits     = (int)SymbolInfoInteger(deal_symbol, SYMBOL_DIGITS);
   
   PrintFormat(&quot;(Position ID #%I64d) %s Deal %s %.2f %s #%I64u by order #%I64d at %.*f
               deal_pos_id, deal_symbol, DealEntryDescription(deal_entry), deal_volume
               DealTypeDescription(deal_type), ExtTicket, deal_order, digits, deal_pri
               TimeMscToString(deal_time));
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o do tipo de opera√ß√£o                        |
//+------------------------------------------------------------------+
string DealTypeDescription(const ENUM_DEAL_TYPE type)
  {
   switch(type)
     {
      case DEAL_TYPE_BUY                     :  return(&quot;Buy&quot;);
      case DEAL_TYPE_SELL                    :  return(&quot;Sell&quot;);
      case DEAL_TYPE_BALANCE                 :  return(&quot;Balance&quot;);</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2374
</p>
<pre><code class="language-mql5">
      case DEAL_TYPE_CREDIT                  :  return(&quot;Credit&quot;);
      case DEAL_TYPE_CHARGE                  :  return(&quot;Additional charge&quot;);
      case DEAL_TYPE_CORRECTION              :  return(&quot;Correction&quot;);
      case DEAL_TYPE_BONUS                   :  return(&quot;Bonus&quot;);
      case DEAL_TYPE_COMMISSION              :  return(&quot;Additional commission&quot;);
      case DEAL_TYPE_COMMISSION_DAILY        :  return(&quot;Daily commission&quot;);
      case DEAL_TYPE_COMMISSION_MONTHLY      :  return(&quot;Monthly commission&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_DAILY  :  return(&quot;Daily agent commission&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_MONTHLY:  return(&quot;Monthly agent commission&quot;);
      case DEAL_TYPE_INTEREST                :  return(&quot;Interest rate&quot;);
      case DEAL_TYPE_BUY_CANCELED            :  return(&quot;Canceled buy deal&quot;);
      case DEAL_TYPE_SELL_CANCELED           :  return(&quot;Canceled sell deal&quot;);
      case DEAL_DIVIDEND                     :  return(&quot;Dividend operations&quot;);
      case DEAL_DIVIDEND_FRANKED             :  return(&quot;Franked (non-taxable) dividend
      case DEAL_TAX                          :  return(&quot;Tax charges&quot;);
      default                                :  return(&quot;Unknown deal type: &quot;+(string)t
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o de como a posi√ß√£o foi alterada¬†            |
//+------------------------------------------------------------------+
string DealEntryDescription(const ENUM_DEAL_ENTRY entry)
  {
   switch(entry)
     {
      case DEAL_ENTRY_IN      :  return(&quot;In&quot;);
      case DEAL_ENTRY_OUT     :  return(&quot;Out&quot;);
      case DEAL_ENTRY_INOUT   :  return(&quot;Reverce&quot;);
      case DEAL_ENTRY_OUT_BY  :  return(&quot;Out by&quot;);
      case DEAL_ENTRY_STATE   :  return(&quot;Status record&quot;);
      default                 :  return(&quot;Unknown deal entry: &quot;+(string)entry);
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o tempo em milissegundos                                 |
//+------------------------------------------------------------------+
string TimeMscToString(const long time_msc, int flags=TIME_DATE|TIME_MINUTES|TIME_SECO
  {
   return(TimeToString(time_msc/1000, flags) + &quot;.&quot; + IntegerToString(time_msc %1000, 3
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryDealGetTicket(), Propriedades de Neg√≥cio</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2375
<h3>HistoryDealsTotal</h3>
Retorna o n√∫mero de ordens no hist√≥rico. Retorna o n√∫mero de opera√ß√µes no hist√≥rico. Antes de
chamar HistoryDealsTotal(), primeiro √© necess√°rio receber o hist√≥rico de opera√ß√µes e ordens utilizando
a fun√ß√£o HistorySelect() ou HistorySelectByPosition().
</p>
<pre><code class="language-mql5">
int¬† HistoryDealsTotal();
</code></pre>
<p>
<h3>Valor retornado</h3>
Valor do tipo double.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens,  opera√ß√µes e posi√ß√µes. Cada opera√ß√£o √© o resultado da execu√ß√£o de uma
ordem, cada posi√ß√£o √© a soma de uma ou mais opera√ß√µes.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
void OnStart()
  {
   ulong deal_ticket;            // ticket da opera√ß√£o
   ulong order_ticket;           // ticket da ordem com a qual a opera√ß√£o foi feita
   datetime transaction_time;    // hora da opera√ß√£o 
   long deal_type ;              // tipo de opera√ß√£o de negocia√ß√£o
   long position_ID;             // identificador da posi√ß√£o
   string deal_description;      // descri√ß√£o da opera√ß√£o
   double volume;                // volume de opera√ß√£o
   string symbol;                // s√≠mbolo da opera√ß√£o
//--- definimos a data de in√≠cio e de t√©rmino para solicitar o hist√≥rico de opera√ß√µes
   datetime from_date=0;          // desde o in√≠cio
   datetime to_date=TimeCurrent();// at√© o momento
//--- solicitamos o hist√≥rico de opera√ß√µes no intervalo especificado
   HistorySelect(from_date,to_date);
//--- n√∫mero total na lista de opera√ß√µes
   int deals=HistoryDealsTotal();
//--- agora vamos processar cada opera√ß√£o
   for(int i=0;i&lt;deals;i++)
     {
      deal_ticket=               HistoryDealGetTicket(i);
      volume=                    HistoryDealGetDouble(deal_ticket,DEAL_VOLUME);
      transaction_time=(datetime)HistoryDealGetInteger(deal_ticket,DEAL_TIME);
      order_ticket=              HistoryDealGetInteger(deal_ticket,DEAL_ORDER);
      deal_type=                 HistoryDealGetInteger(deal_ticket,DEAL_TYPE);
      symbol=                    HistoryDealGetString(deal_ticket,DEAL_SYMBOL);
      position_ID=               HistoryDealGetInteger(deal_ticket,DEAL_POSITION_ID);
      deal_description=          GetDealDescription(deal_type,volume,symbol,order_tick
      //--- criamos uma formata√ß√£o agrad√°vel para o n√∫mero da opera√ß√£o
      string print_index=StringFormat(&quot;% 3d&quot;,i);
      //--- exibimos informa√ß√µes sobre a opera√ß√£o
      Print(print_index+&quot;: deal #&quot;,deal_ticket,&quot; at &quot;,transaction_time,deal_descriptio</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2376
</p>
<pre><code class="language-mql5">
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o de string da opera√ß√£o¬†                     |
//+------------------------------------------------------------------+
string GetDealDescription(long deal_type,double volume,string symbol,long ticket,long 
  {
   string descr;
//---
   switch(deal_type)
     {
      case DEAL_TYPE_BALANCE:                  return (&quot;balance&quot;);
      case DEAL_TYPE_CREDIT:                   return (&quot;credit&quot;);
      case DEAL_TYPE_CHARGE:                   return (&quot;charge&quot;);
      case DEAL_TYPE_CORRECTION:               return (&quot;correction&quot;);
      case DEAL_TYPE_BUY:                      descr=&quot;buy&quot;; break;
      case DEAL_TYPE_SELL:                     descr=&quot;sell&quot;; break;
      case DEAL_TYPE_BONUS:                    return (&quot;bonus&quot;);
      case DEAL_TYPE_COMMISSION:               return (&quot;additional commission&quot;);
      case DEAL_TYPE_COMMISSION_DAILY:         return (&quot;daily commission&quot;);
      case DEAL_TYPE_COMMISSION_MONTHLY:       return (&quot;monthly commission&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_DAILY:   return (&quot;daily agent commission&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_MONTHLY: return (&quot;monthly agent commission&quot;);
      case DEAL_TYPE_INTEREST:                 return (&quot;interest rate&quot;);
      case DEAL_TYPE_BUY_CANCELED:             descr=&quot;cancelled buy deal&quot;; break;
      case DEAL_TYPE_SELL_CANCELED:            descr=&quot;cancelled sell deal&quot;; break;
     }
   descr=StringFormat(&quot;%s %G %s (order #%d, position ID %d)&quot;,
                      descr,  // descri√ß√£o atual
                      volume, // volume da opera√ß√£o
                      symbol, // instrumento da opera√ß√£o
                      ticket, // ticket da ordem que acionou a opera√ß√£o
                      pos_ID  // ID da posi√ß√£o na qual a opera√ß√£o estava envolvida
                      );
   return(descr);
//---
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryDealGetTicket(), Propriedades de Neg√≥cio</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2377
<h3>HistoryDealGetTicket</h3>
A fun√ß√£o seleciona um neg√≥cio para processamento posterior e retorna o ticket de neg√≥cio na hist√≥ria.
Antes de chamar HistoryDealGetTicket (), primeiro √© necess√°rio receber o hist√≥rico de neg√≥cios e
ordens utilizando a fun√ß√£o HistorySelect() ou a fun√ß√£o HistorySelectByPosition().
ulong¬† HistoryDealGetTicket(
</p>
<pre><code class="language-mql5">
   int¬† index¬†     // ticket de neg√≥cio
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
index
[in]  N√∫mero de um neg√≥cio na lista de negocia√ß√µes
<h3>Valor do Retorno</h3>
Valor do tipo ulong. Se a fun√ß√£o falhar, ser√° retornado 0.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens,  opera√ß√µes e posi√ß√µes. Cada opera√ß√£o √© o resultado da execu√ß√£o de uma
ordem, cada posi√ß√£o √© o resumo de um ou mais opera√ß√µes.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
void OnStart()
  {
   ulong deal_ticket;            // bilhetagem da opera√ß√£o (deal)
   ulong order_ticket;           // ticket da ordem que o neg√≥cio foi executado em
   datetime transaction_time;    // tempo de execu√ß√£o de um neg√≥cio
   long deal_type ;              // tipo de opera√ß√£o comercial
   long position_ID;             // ID posi√ß√£o
   string deal_description;      // descri√ß√£o da opera√ß√£o
   double volume;                // volume da opera√ß√£o
   string symbol;                // ativo da negocia√ß√£o
//--- definir a data inicial e final para solicitar o hist√≥rico dos neg√≥cios
   datetime from_date=0;         // desde o princ√≠pio
   datetime to_date=TimeCurrent();//at√© o momento atual
//--- solicita o hist√≥rico das negocia√ß√µes no per√≠odo especificado
   HistorySelect(from_date,to_date);
//--- n√∫mero total na lista das neg√≥cios
   int deals=HistoryDealsTotal();
//--- agora processar cada trade (neg√≥cio)
   for(int i=0;i&lt;deals;i++)
     {
      deal_ticket=               HistoryDealGetTicket(i);
      volume=                    HistoryDealGetDouble(deal_ticket,DEAL_VOLUME);
      transaction_time=(datetime)HistoryDealGetInteger(deal_ticket,DEAL_TIME);
      order_ticket=              HistoryDealGetInteger(deal_ticket,DEAL_ORDER);
      deal_type=                 HistoryDealGetInteger(deal_ticket,DEAL_TYPE);
      symbol=                    HistoryDealGetString(deal_ticket,DEAL_SYMBOL);</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2378
</p>
<pre><code class="language-mql5">
      position_ID=               HistoryDealGetInteger(deal_ticket,DEAL_POSITION_ID);
      deal_description=          GetDealDescription(deal_type,volume,symbol,order_tick
      //--- realizar uma boa formata√ß√£o para o n√∫mero de neg√≥cio
      string print_index=StringFormat(&quot;% 3d&quot;,i);
      //--- mostrar informa√ß√µes sobre o neg√≥cio
      Print(print_index+&quot;: deal #&quot;,deal_ticket,&quot; em &quot;,transaction_time,deal_descriptio
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna a descri√ß√£o string da opera√ß√£o¬†                          |
//+------------------------------------------------------------------+
string GetDealDescription(long deal_type,double volume,string symbol,long ticket,long 
  {
   string descr;
//---
   switch(deal_type)
     {
      case DEAL_TYPE_BALANCE:                  return (&quot;balance&quot;);
      case DEAL_TYPE_CREDIT:                   return (&quot;credit&quot;);
      case DEAL_TYPE_CHARGE:                   return (&quot;charge&quot;);
      case DEAL_TYPE_CORRECTION:               return (&quot;corre√ß√£o&quot;);
      case DEAL_TYPE_BUY:                      descr=&quot;compra&quot;; break;
      case DEAL_TYPE_SELL:                     descr=&quot;vender&quot;; break;
      case DEAL_TYPE_BONUS:                    return (&quot;bonus&quot;);
      case DEAL_TYPE_COMMISSION:               return (&quot;comiss√£o adicional&quot;);
      case DEAL_TYPE_COMMISSION_DAILY:         return (&quot;comiss√£o di√°ria&quot;);
      case DEAL_TYPE_COMMISSION_MONTHLY:       return (&quot;comiss√£o mensal&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_DAILY:   return (&quot;comiss√£o de agente di√°rio&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_MONTHLY: return (&quot;comiss√£o de agente mensal&quot;);
      case DEAL_TYPE_INTEREST:                 return (&quot;taxa de juros&quot;);
      case DEAL_TYPE_BUY_CANCELED:             descr=&quot;cancelado comprar neg√≥cio&quot;; brea
      case DEAL_TYPE_SELL_CANCELED:            descr=&quot;cancelado vender neg√≥cio&quot;; break
     }
   descr=StringFormat(&quot;%s %G %s (ordem #%d, a posi√ß√£o ID %d)&quot;,
                      descr,  // descri√ß√£o atual
                      volume, // volume de neg√≥cio
                      symbol, // ativo de neg√≥cio
                      ticket, // ticket da ordem que provocou o neg√≥cio
                      pos_ID  // ID de uma posi√ß√£o, na qual a neg√≥cio √© inclu√≠do
                      );
   return(descr);
//---
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryDealsTotal(), HistoryDealSelect(), Propriedades de uma Opera√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2379
<h3>HistoryDealGetDouble</h3>
Retorna a propriedade solicitada de uma opera√ß√£o. A propriedade da opera√ß√£o deve ser do tipo
double. Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
</p>
<pre><code class="language-mql5">
double¬† HistoryDealGetDouble(
   ulong¬†                     ticket_number,¬†    // Ticket (bilhete)
   ENUM_DEAL_PROPERTY_DOUBLE¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. A fun√ß√£o vai retornar &quot;true&quot; ou &quot;false&quot;, dependendo se deu certo ou n√£o. Se der certo, o valor da
propriedade ser√° passado por refer√™ncia para uma vari√°vel de destino, que voc√™ define no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† HistoryDealGetDouble(
   ulong¬†                     ticket_number,¬†    // Ticket (bilhete)
   ENUM_DEAL_PROPERTY_DOUBLE¬† property_id,       // Identificador de propriedade
   double&amp;¬†                   double_var¬†        // Aqui n√≥s aceitamos o valor da prop
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket_number
[in]  Ticket de opera√ß√£o.
property_id
[in]  Identificador da propriedade da opera√ß√£o. O valor pode ser um dos valores da enumera√ß√£o
ENUM_DEAL_PROPERTY_DOUBLE.
double_var
[out]  Vari√°vel de tipo double, que aceita o valor da propriedade requerida.
<h3>Valor retornado</h3>
Valor do tipo double.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens,  opera√ß√µes e posi√ß√µes. Cada opera√ß√£o √© o resultado da execu√ß√£o de uma
ordem, cada posi√ß√£o √© a soma de uma ou mais opera√ß√µes.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- solicitamos o hist√≥rico de opera√ß√µes e ordens
   if(!HistorySelect(0, TimeCurrent()))
     {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2380
</p>
<pre><code class="language-mql5">
      Print(&quot;HistorySelect() failed. Error &quot;, GetLastError());
      return;
     }
//--- em um loop pela lista de opera√ß√µes no hist√≥rico da conta
   int total=HistoryDealsTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos o ticket da pr√≥xima opera√ß√£o (a opera√ß√£o √© automaticamente selecio
      ulong ticket=HistoryDealGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo e a dire√ß√£o da opera√ß√£o e geramos o cabe√ßalho da lista de p
      string type=DealTypeDescription((ENUM_DEAL_TYPE)HistoryDealGetInteger(ticket, DE
      string entry=DealEntryDescription((ENUM_DEAL_ENTRY)HistoryDealGetInteger(ticket,
      PrintFormat(&quot;Double properties of an deal %s entry %s #%I64u:&quot;, type, entry, tic
      
      //--- imprimimos todas as propriedades reais da opera√ß√£o selecionada sob o cabe√ß
      HistoryDealPropertiesDoublePrint(ticket, 12);
     }
   /*
¬†  Resultado:
   Double properties of an deal Buy entry In #2785070622:
   Volume:     0.50
   Price:      1.10480
   Commission: 0.00
   Swap:       0.00
   Profit:     0.00 USD
   Fee:        0.00
   StopLoss:   0.00000
   TakeProfit: 0.00000
   Double properties of an deal Sell entry Out #2785071538:
   Volume:     0.50
   Price:      1.10491
   Commission: 0.00
   Swap:       0.00
   Profit:     5.50 USD
   Fee:        0.00
   StopLoss:   0.00000
   TakeProfit: 0.00000
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Registra no log as propriedades reais da opera√ß√£o selecionada¬†   |
//+------------------------------------------------------------------+
void HistoryDealPropertiesDoublePrint(const ulong ticket, const uint header_width=0)
  {
   uint   w=0;</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2381
</p>
<pre><code class="language-mql5">
   string header=&quot;&quot;;
   double value=0;
   
//--- obtemos o s√≠mbolo da opera√ß√£o, a moeda do lucro e o n√∫mero de casas decimais do 
   string symbol  = HistoryDealGetString(ticket, DEAL_SYMBOL);
   string currency= SymbolInfoString(symbol, SYMBOL_CURRENCY_PROFIT);
   int    digits  = (int)SymbolInfoInteger(symbol, SYMBOL_DIGITS);
   
//--- definimos o texto do cabe√ßalho e a largura do campo de cabe√ßalho
//--- se a largura do cabe√ßalho for passada para a fun√ß√£o igual a zero, a largura ser√°
   header=&quot;Volume:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
//--- recebemos e imprimimos no log o volume da opera√ß√£o com um cabe√ßalho de largura d
   if(!HistoryDealGetDouble(ticket, DEAL_VOLUME, value))
      return;
   PrintFormat(&quot;%-*s%-.2f&quot;, w, header, value);
   
//--- imprimimos no log o pre√ßo da opera√ß√£o
   header=&quot;Price:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetDouble(ticket, DEAL_PRICE, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
   
//--- imprimimos no log a comiss√£o da opera√ß√£o
   header=&quot;Commission:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetDouble(ticket, DEAL_COMMISSION, value))
      return;
   PrintFormat(&quot;%-*s%-.2f&quot;, w, header, value);
   
//--- imprimimos no logo swap acumulado no fechamento
   header=&quot;Swap:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetDouble(ticket, DEAL_SWAP, value))
      return;
   PrintFormat(&quot;%-*s%-.2f&quot;, w, header, value);
   
//--- imprimimos no log o resultado financeiro da opera√ß√£o
   header=&quot;Profit:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetDouble(ticket, DEAL_PROFIT, value))
      return;
   PrintFormat(&quot;%-*s%-.2f %s&quot;, w, header, value, currency);
   
//--- imprimimos no log o pagamento da opera√ß√£o realizada
   header=&quot;Fee:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetDouble(ticket, DEAL_FEE, value))</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2382
</p>
<pre><code class="language-mql5">
      return;
   PrintFormat(&quot;%-*s%-.2f&quot;, w, header, value);
   
//--- imprimimos no log o valor do n√≠vel StopLoss
   header=&quot;StopLoss:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetDouble(ticket, DEAL_SL, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
//--- imprimimos no log o valor do n√≠vel TakeProfit
   header=&quot;TakeProfit:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetDouble(ticket, DEAL_TP, value))
      return;
   PrintFormat(&quot;%-*s%-.*f&quot;, w, header, digits, value);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o do tipo de opera√ß√£o                        |
//+------------------------------------------------------------------+
string DealTypeDescription(const ENUM_DEAL_TYPE type)
  {
   switch(type)
     {
      case DEAL_TYPE_BUY                     :  return(&quot;Buy&quot;);
      case DEAL_TYPE_SELL                    :  return(&quot;Sell&quot;);
      case DEAL_TYPE_BALANCE                 :  return(&quot;Balance&quot;);
      case DEAL_TYPE_CREDIT                  :  return(&quot;Credit&quot;);
      case DEAL_TYPE_CHARGE                  :  return(&quot;Additional charge&quot;);
      case DEAL_TYPE_CORRECTION              :  return(&quot;Correction&quot;);
      case DEAL_TYPE_BONUS                   :  return(&quot;Bonus&quot;);
      case DEAL_TYPE_COMMISSION              :  return(&quot;Additional commission&quot;);
      case DEAL_TYPE_COMMISSION_DAILY        :  return(&quot;Daily commission&quot;);
      case DEAL_TYPE_COMMISSION_MONTHLY      :  return(&quot;Monthly commission&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_DAILY  :  return(&quot;Daily agent commission&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_MONTHLY:  return(&quot;Monthly agent commission&quot;);
      case DEAL_TYPE_INTEREST                :  return(&quot;Interest rate&quot;);
      case DEAL_TYPE_BUY_CANCELED            :  return(&quot;Canceled buy deal&quot;);
      case DEAL_TYPE_SELL_CANCELED           :  return(&quot;Canceled sell deal&quot;);
      case DEAL_DIVIDEND                     :  return(&quot;Dividend operations&quot;);
      case DEAL_DIVIDEND_FRANKED             :  return(&quot;Franked (non-taxable) dividend
      case DEAL_TAX                          :  return(&quot;Tax charges&quot;);
      default                                :  return(&quot;Unknown deal type: &quot;+(string)t
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o de como a posi√ß√£o foi alterada¬†            |
//+------------------------------------------------------------------+
string DealEntryDescription(const ENUM_DEAL_ENTRY entry)</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2383
</p>
<pre><code class="language-mql5">
  {
   switch(entry)
     {
      case DEAL_ENTRY_IN      :  return(&quot;In&quot;);
      case DEAL_ENTRY_OUT     :  return(&quot;Out&quot;);
      case DEAL_ENTRY_INOUT   :  return(&quot;Reverce&quot;);
      case DEAL_ENTRY_OUT_BY  :  return(&quot;Out by&quot;);
      case DEAL_ENTRY_STATE   :  return(&quot;Status record&quot;);
      default                 :  return(&quot;Unknown deal entry: &quot;+(string)entry);
     }
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryDealsTotal(), HistoryDealSelect(), Propriedades de uma Opera√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2384
<h3>HistoryDealGetInteger</h3>
Retorna a propriedade solicitada de uma opera√ß√£o. A propriedade de opera√ß√£o deve ser de tipo
datetime, int. Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
long¬† HistoryDealGetInteger(
</p>
<pre><code class="language-mql5">
   ulong¬†                      ticket_number,¬†    // Ticket (bilhete)
   ENUM_DEAL_PROPERTY_INTEGER¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. Retorna true ou false dependendo do sucesso da fun√ß√£o. Se for bem sucedido, o valor da
propriedade est√° situada dentro de uma vari√°vel de destino passado por refer√™ncia pelo √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† HistoryDealGetInteger(
   ulong¬†                      ticket_number,¬†    // Ticket (bilhete)
   ENUM_DEAL_PROPERTY_INTEGER¬† property_id,       // Identificador de propriedade
   long&amp;¬†                      long_var¬†          // Aqui n√≥s aceitamos o valor da pro
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket_number
[in]  Ticket (bilhete) de neg√≥cio.
property_id
[in]  Identificador da propriedade de opera√ß√£o. O valor pode ser um dos valores da enumera√ß√£o
ENUM_DEAL_PROPERTY_INTEGER.
long_var
[out]  Vari√°vel do tipo long que aceita o valor da propriedade requerida.
<h3>Valor do Retorno</h3>
Valor do tipo long.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens,  opera√ß√µes e posi√ß√µes. Cada opera√ß√£o √© o resultado da execu√ß√£o de uma
ordem, cada posi√ß√£o √© o resumo de um ou mais opera√ß√µes.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o Trade¬†                                                    |
//+------------------------------------------------------------------+
void OnTrade()
  {
//--- receber ticket da √∫ltima opera√ß√£o do hist√≥rico comercial da semana
   ulong last_deal=GetLastDealTicket();
   if(HistoryDealSelect(last_deal))</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2385
</p>
<pre><code class="language-mql5">
     {
      //--- tempo de opera√ß√µes executadas em milissegundos desde 01.01.1970
      long deal_time_msc=HistoryDealGetInteger(last_deal,DEAL_TIME_MSC);
      PrintFormat(&quot;Deal #%d DEAL_TIME_MSC=%i64 =&gt; %s&quot;,
                  last_deal,deal_time_msc,TimeToString(deal_time_msc/1000));
     }
   else
      PrintFormat(&quot;HistoryDealSelect() falhou por #%d. C√≥digo de erro=%d&quot;,
                  last_deal,GetLastError());
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna o √∫ltimo bilhete de opera√ß√£o no hist√≥rico ou -1¬†         |
//+------------------------------------------------------------------+
</code></pre>
<p>
ulong GetLastDealTicket()
</p>
<pre><code class="language-mql5">
  {
</code></pre>
<p>
requisita o hist√≥rico para os √∫ltimos 7 dias
</p>
<pre><code class="language-mql5">
   if(!GetTradeHistory(7))
     {
      //--- notificar sobre chamada sem sucesso e retorno -1
      Print(__FUNCTION__,&quot; HistorySelect() retornou false&quot;);
      return -1;
     }
//--- 
   ulong first_deal,last_deal,deals=HistoryDealsTotal();
//--- trabalhar com ordens se houver alguma
   if(deals&gt;0)
     {
      Print(&quot;Deals = &quot;,deals);
      first_deal=HistoryDealGetTicket(0);
      PrintFormat(&quot;first_deal = %d&quot;,first_deal);
      if(deals&gt;1)
        {
         last_deal=HistoryDealGetTicket((int)deals-1);
         PrintFormat(&quot;last_deal = %d&quot;,last_deal);
         return last_deal;
        }
      return first_deal;
     }
//--- nenhuma opera√ß√£o encontrada, retornar -1
   return -1;
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+---------------------------------------------------------------------------------+
//| Solicita√ß√µes de hist√≥rico para os √∫ltimos dias e retorna false em caso de falha¬†|
//+---------------------------------------------------------------------------------+
bool GetTradeHistory(int days)
  {
//--- define um per√≠odo da semana para solicitar hist√≥rico da opera√ß√£o
   datetime to=TimeCurrent();</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2386
</p>
<pre><code class="language-mql5">
   datetime from=to-days*PeriodSeconds(PERIOD_D1);
   ResetLastError();
//--- fazer um pedido e verificar o resultado
   if(!HistorySelect(from,to))
     {
      Print(__FUNCTION__,&quot; HistorySelect=false. C√≥digo de erro=&quot;,GetLastError());
      return false;
     }
//--- hist√≥rico recebido com sucesso
   return true;
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryDealsTotal(), HistoryDealSelect(), Propriedades de uma Opera√ß√£o</p>
<p><h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2387
<h3>HistoryDealGetString</h3>
Retorna a propriedade solicitada de uma opera√ß√£o. A propriedade da opera√ß√£o deve ser do tipo string.
Existem 2 variantes da fun√ß√£o.
1. Imediatamente retorna o valor da propriedade.
</p>
<pre><code class="language-mql5">
string¬† HistoryDealGetString(
   ulong¬†                     ticket_number,¬†    // Ticket (bilhete)
   ENUM_DEAL_PROPERTY_STRING¬† property_id¬†       // Identificador de propriedade
   );
</code></pre>
<p>
2. A fun√ß√£o vai retornar &quot;true&quot; ou &quot;false&quot;, dependendo se deu certo ou n√£o. Se der certo, o valor da
propriedade ser√° passado por refer√™ncia para uma vari√°vel de destino, que voc√™ define no √∫ltimo
par√¢metro.
</p>
<pre><code class="language-mql5">
bool¬† HistoryDealGetString(
   ulong¬†                     ticket_number,¬†    // Ticket (bilhete)
   ENUM_DEAL_PROPERTY_STRING¬† property_id,       // Identificador de propriedade
   string&amp;¬†                   string_var¬†        // Aqui recebemos o valor da propried
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
ticket_number
[in]  Ticket de opera√ß√£o.
property_id
[in]  Identificador da propriedade da opera√ß√£o. O valor pode ser um dos valores da enumera√ß√£o
ENUM_DEAL_PROPERTY_STRING.
string_var
[out]  Vari√°vel de tipo string que aceita o valor da propriedade requerida...
<h3>Valor retornado</h3>
Valor do tipo string.
<h3>Observa√ß√£o</h3>
N√£o confunda ordens,  opera√ß√µes e posi√ß√µes. Cada opera√ß√£o √© o resultado da execu√ß√£o de uma
ordem, cada posi√ß√£o √© a soma de uma ou mais opera√ß√µes.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Script program start function                                    |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- solicitamos o hist√≥rico de opera√ß√µes e ordens
   if(!HistorySelect(0, TimeCurrent()))
     {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2388
</p>
<pre><code class="language-mql5">
      Print(&quot;HistorySelect() failed. Error &quot;, GetLastError());
      return;
     }
//--- em um loop pela lista de opera√ß√µes no hist√≥rico da conta
   int total=HistoryDealsTotal();
   for(int i=0; i&lt;total; i++)
     {
      //--- obtemos o ticket da pr√≥xima opera√ß√£o (a opera√ß√£o √© automaticamente selecio
      ulong ticket=HistoryDealGetTicket(i);
      if(ticket==0)
         continue;
      
      //--- obtemos o tipo e a dire√ß√£o da opera√ß√£o e geramos o cabe√ßalho da lista de p
      string type=DealTypeDescription((ENUM_DEAL_TYPE)HistoryDealGetInteger(ticket, DE
      string entry=DealEntryDescription((ENUM_DEAL_ENTRY)HistoryDealGetInteger(ticket,
      PrintFormat(&quot;String properties of an deal %s entry %s #%I64u:&quot;, type, entry, tic
      
      //--- imprimimos todas as propriedades reais da opera√ß√£o selecionada sob o cabe√ß
      HistoryDealPropertiesStringPrint(ticket, 13);
     }
   /*
¬†  Resultado:
   String properties of an deal Buy entry In #2785021084:
   Symbol:      EURUSD
   Comment:     Test PositionGetString
   Extarnal ID:
   String properties of an deal Buy entry Out #2497993663:
   Symbol:      EURUSD
   Comment:     [tp 1.08639]
   Extarnal ID: 
   */
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Imprime no log as propriedades de string da opera√ß√£o selecionada¬†|
//+------------------------------------------------------------------+
void HistoryDealPropertiesStringPrint(const ulong ticket, const uint header_width=0)
  {
   uint   w=0;
   string header=&quot;&quot;;
   string value =&quot;&quot;;
   
//--- definimos o texto do cabe√ßalho e a largura do campo de cabe√ßalho
//--- se a largura do cabe√ßalho for passada para a fun√ß√£o igual a zero, a largura ser√°
   header=&quot;Symbol:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
//--- recebemos e imprimimos no log o s√≠mbolo da opera√ß√£o com um cabe√ßalho de largura 
   if(!HistoryDealGetString(ticket, DEAL_SYMBOL, value))
      return;</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2389
</p>
<pre><code class="language-mql5">
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
   
//--- imprimimos no log o coment√°rio da opera√ß√£o
   header=&quot;Comment:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetString(ticket, DEAL_COMMENT, value))
      return;
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
   
//--- imprimimos no log o identificador da opera√ß√£o no sistema de negocia√ß√£o externo
   header=&quot;Extarnal ID:&quot;;
   w=(header_width==0 ? header.Length()+1 : header_width);
   if(!HistoryDealGetString(ticket, DEAL_EXTERNAL_ID, value))
      return;
   PrintFormat(&quot;%-*s%-s&quot;, w, header, value);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o do tipo de opera√ß√£o                        |
//+------------------------------------------------------------------+
string DealTypeDescription(const ENUM_DEAL_TYPE type)
  {
   switch(type)
     {
      case DEAL_TYPE_BUY                     :  return(&quot;Buy&quot;);
      case DEAL_TYPE_SELL                    :  return(&quot;Sell&quot;);
      case DEAL_TYPE_BALANCE                 :  return(&quot;Balance&quot;);
      case DEAL_TYPE_CREDIT                  :  return(&quot;Credit&quot;);
      case DEAL_TYPE_CHARGE                  :  return(&quot;Additional charge&quot;);
      case DEAL_TYPE_CORRECTION              :  return(&quot;Correction&quot;);
      case DEAL_TYPE_BONUS                   :  return(&quot;Bonus&quot;);
      case DEAL_TYPE_COMMISSION              :  return(&quot;Additional commission&quot;);
      case DEAL_TYPE_COMMISSION_DAILY        :  return(&quot;Daily commission&quot;);
      case DEAL_TYPE_COMMISSION_MONTHLY      :  return(&quot;Monthly commission&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_DAILY  :  return(&quot;Daily agent commission&quot;);
      case DEAL_TYPE_COMMISSION_AGENT_MONTHLY:  return(&quot;Monthly agent commission&quot;);
      case DEAL_TYPE_INTEREST                :  return(&quot;Interest rate&quot;);
      case DEAL_TYPE_BUY_CANCELED            :  return(&quot;Canceled buy deal&quot;);
      case DEAL_TYPE_SELL_CANCELED           :  return(&quot;Canceled sell deal&quot;);
      case DEAL_DIVIDEND                     :  return(&quot;Dividend operations&quot;);
      case DEAL_DIVIDEND_FRANKED             :  return(&quot;Franked (non-taxable) dividend
      case DEAL_TAX                          :  return(&quot;Tax charges&quot;);
      default                                :  return(&quot;Unknown deal type: &quot;+(string)t
     }
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Retorna uma descri√ß√£o de como a posi√ß√£o foi alterada¬†            |
//+------------------------------------------------------------------+
string DealEntryDescription(const ENUM_DEAL_ENTRY entry)
  {</p>
<p></code></pre>
<p>
<h3>Fun√ß√µes de Negocia√ß√£o</h3>
¬© 2000-2025, MetaQuotes Ltd.
2390
</p>
<pre><code class="language-mql5">
   switch(entry)
     {
      case DEAL_ENTRY_IN      :  return(&quot;In&quot;);
      case DEAL_ENTRY_OUT     :  return(&quot;Out&quot;);
      case DEAL_ENTRY_INOUT   :  return(&quot;Reverce&quot;);
      case DEAL_ENTRY_OUT_BY  :  return(&quot;Out by&quot;);
      case DEAL_ENTRY_STATE   :  return(&quot;Status record&quot;);
      default                 :  return(&quot;Unknown deal entry: &quot;+(string)entry);
     }
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
HistorySelect(), HistoryDealsTotal(), HistoryDealSelect(), Propriedades de uma Opera√ß√£o
</p>
        </article>
        
        <footer>
            <p>Documenta√ß√£o MQL5 - Fonte: MetaQuotes Ltd.</p>
        </footer>
    </main>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
        
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('open');
        }
        
        function filterNav() {
            const filter = document.getElementById('search').value.toLowerCase();
            const items = document.querySelectorAll('.nav-list li');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(filter) ? '' : 'none';
            });
        }
    </script>
</body>
</html>