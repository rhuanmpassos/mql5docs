<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicadores Customizados - MQL5 Docs</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
</head>
<body>
    <nav class="sidebar">
        <div class="logo">
            <h1>MQL5 Docs</h1>
            <p>Documenta√ß√£o Completa</p>
        </div>
        <div class="search-box">
            <input type="text" id="search" placeholder="Buscar..." onkeyup="filterNav()">
        </div>
        <ul class="nav-list" id="nav-list">
            <li class=""><a href="index.html">üìö √çndice</a></li>
            <li class=""><a href="introducao.html">Introducao</a></li>
<li class=""><a href="refer√™ncia_mql5.html">Refer√™ncia MQL5</a></li>
<li class=""><a href="elementos_b√°sicos_da_linguagem.html">Elementos B√°sicos da Linguagem</a></li>
<li class=""><a href="constantes,_enumeradores_e_estruturas.html">Constantes, Enumeradores e Estruturas</a></li>
<li class=""><a href="programas_mql5.html">Programas MQL5</a></li>
<li class=""><a href="vari√°veis_predefinidas.html">Vari√°veis Predefinidas</a></li>
<li class=""><a href="fun√ß√µes_comuns.html">Fun√ß√µes Comuns</a></li>
<li class=""><a href="fun√ß√µes_para_array.html">Fun√ß√µes para Array</a></li>
<li class=""><a href="m√©todos_matriciais_e_vetoriais.html">M√©todos matriciais e vetoriais</a></li>
<li class=""><a href="fun√ß√µes_de_convers√£o.html">Fun√ß√µes de Convers√£o</a></li>
<li class=""><a href="fun√ß√µes_matem√°ticas.html">Fun√ß√µes Matem√°ticas</a></li>
<li class=""><a href="fun√ß√µes_de_string.html">Fun√ß√µes de String</a></li>
<li class=""><a href="data_e_hora.html">Data e Hora</a></li>
<li class=""><a href="informa√ß√µes_de_conta.html">Informa√ß√µes de Conta</a></li>
<li class=""><a href="verificando_estado.html">Verificando Estado</a></li>
<li class=""><a href="manipula√ß√£o_de_eventos.html">Manipula√ß√£o de eventos</a></li>
<li class=""><a href="informa√ß√µes_de_mercado.html">Informa√ß√µes de Mercado</a></li>
<li class=""><a href="calend√°rio_econ√¥mico.html">Calend√°rio econ√¥mico</a></li>
<li class=""><a href="s√©ries_temporais_e_acesso_a_indicadores.html">S√©ries Temporais e Acesso a Indicadores</a></li>
<li class=""><a href="s√≠mbolos_personalizados.html">S√≠mbolos personalizados</a></li>
<li class=""><a href="opera√ß√µes_de_gr√°ficos.html">Opera√ß√µes de Gr√°ficos</a></li>
<li class=""><a href="fun√ß√µes_de_negocia√ß√£o.html">Fun√ß√µes de Negocia√ß√£o</a></li>
<li class=""><a href="gerenciamento_de_sinais.html">Gerenciamento de sinais</a></li>
<li class=""><a href="fun√ß√µes_de_rede.html">Fun√ß√µes de rede</a></li>
<li class=""><a href="vari√°veis_globais_do_terminal.html">Vari√°veis Globais do Terminal</a></li>
<li class=""><a href="fun√ß√µes_de_arquivo.html">Fun√ß√µes de Arquivo</a></li>
<li class="active"><a href="indicadores_customizados.html">Indicadores Customizados</a></li>
<li class=""><a href="fun√ß√µes_de_objeto.html">Fun√ß√µes de Objeto</a></li>
<li class=""><a href="indicadores_t√©cnicos.html">Indicadores T√©cnicos</a></li>
<li class=""><a href="trabalhando_com_resultados_de_otimiza√ß√£o.html">Trabalhando com Resultados de Otimiza√ß√£o</a></li>
<li class=""><a href="trabalhando_com_eventos.html">Trabalhando com Eventos</a></li>
<li class=""><a href="trabalhando_com_opencl.html">Trabalhando com OpenCL</a></li>
<li class=""><a href="trabalhar_com_bancos_de_dados.html">Trabalhar com bancos de dados</a></li>
<li class=""><a href="trabalho_com_directx.html">Trabalho com DirectX</a></li>
<li class=""><a href="metatrader_para_python.html">MetaTrader para Python</a></li>
<li class=""><a href="modelos_onnx.html">Modelos ONNX</a></li>
<li class=""><a href="biblioteca_padr√£o.html">Biblioteca Padr√£o</a></li>
<li class=""><a href="migrando_do_mql4.html">Migrando do MQL4</a></li>
<li class=""><a href="lista_de_fun√ß√µes_mql5.html">Lista de Fun√ß√µes MQL5</a></li>
<li class=""><a href="lista_de_constantes_mql5.html">Lista de Constantes MQL5</a></li>

        </ul>
    </nav>
    
    <main class="content">
        <header>
            <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <h1>Indicadores Customizados</h1>
        </header>
        
        <article>
            <p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2593
<h3>Indicadores Customizados</h3>
Este √© o grupo de fun√ß√µes utilizadas na cria√ß√£o dos indicadores personalizados. Estas fun√ß√µes n√£o
podem ser usadas para escrever Expert Advisors e Scripts.
<h3>Fun√ß√£o</h3>
<h3>A√ß√£o</h3>
<h3>SetIndexBuffer</h3>
Vincula-se o buffer de indicador especificado com din√¢mica
unidimensional array do tipo double
<h3>IndicatorSetDouble</h3>
Define o valor da propriedade de um indicador do tipo double
<h3>IndicatorSetInteger</h3>
Define o valor da propriedade de um indicador do tipo int
<h3>IndicatorSetString</h3>
Define o valor da propriedade de um indicador do tipo string
<h3>PlotIndexSetDouble</h3>
Define o valor da propriedade de linha de um indicador do tipo
double
<h3>PlotIndexSetInteger</h3>
Define o valor da propriedade de linha de um indicador do tipo int
<h3>PlotIndexSetString</h3>
Define o valor da propriedade de linha de um indicador do tipo string
<h3>PlotIndexGetInteger</h3>
Retorna o valor da propriedade de linha de um indicador do tipo
inteiro
Propriedades de indicador podem ser definidas utilizando as diretivas de compilador ou o uso de
fun√ß√µes. Para entender melhor isso, √© recomend√°vel que voc√™ estude estilos de indicador como
exemplos.
Todos os c√°lculos necess√°rios de um indicador personalizado devem ser colocados na fun√ß√£o
predeterminada OnCalculate(). Se voc√™ usar uma forma abreviada da fun√ß√£o chamada OnCalculate(),
como
</p>
<pre><code class="language-mql5">
int OnCalculate (const int rates_total, const int prev_calculated, const int begin, co
</code></pre>
<p>
ent√£o a vari√°vel rates_total cont√©m o valor do n√∫mero total de elementos da ordem de price[],
passados como um par√¢metro de entrada para calcular os valores do indicador.
Par√¢metro prev_calculated √© o resultado da execu√ß√£o de OnCalculate() na chamada anterior, que
permite organizar um algoritmo salvo para calcular os valores do indicador. Por exemplo, se o valor
corrente de rates_total = 1000, prev_calculated = 999, ent√£o talvez seja bastante para fazer os
c√°lculos apenas para um valor de cada buffer indicador.
Se a informa√ß√£o sobre o tamanho da entrada da ordem de pre√ßo fosse disponibilizado, ent√£o isso
levaria √† necessidade de fazer c√°lculos para 1000 valores de cada buffer de indicador. Na primeira
chamada do OnCalculate(), o valor prev_calculated = 0. Se a ordem de price[] foi alterado de alguma
forma, ent√£o neste caso prev_calculated tamb√©m √© igual a 0 (zero).
O par√¢metro begin mostra o n√∫mero de valores iniciais da ordem de pre√ßo, que n√£o cont√™m dados
para o c√°lculo. Por exemplo, se o valor de Accelerator Oscillator (para os quais os primeiros 37 valores
n√£o s√£o calculados) foram utilizados como um par√¢metro de entrada, ent√£o begin = 37. Por exemplo,
vamos considerar um simples indicador:
</p>
<pre><code class="language-mql5">
#property indicator_chart_window</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2594
</p>
<pre><code class="language-mql5">
#property indicator_buffers 1
#property indicator_plots   1
//---- plot Label1
#property indicator_label1  &quot;Etiqueta 1&quot;
#property indicator_type1   DRAW_LINE
#property indicator_color1  clrRed
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- buffers do indicador
double         Label1Buffer[];
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
void OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,Label1Buffer,INDICATOR_DATA);
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const int begin,
                const double &amp;price[])
  {
//---
   Print(&quot;begin = &quot;,begin,&quot;  prev_calculated = &quot;,prev_calculated,&quot;  rates_total = &quot;,ra
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
Arrast√°-lo a partir da janela do &quot;Navegador&quot; para a janela do indicador Accelerator Oscillator e n√≥s
indicamos que os c√°lculos devem ser feitos com base nos valores do indicador anterior:</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2595
Como um resultado, a primeira chamada do valor OnCalculate() de prev_calculated ser√° igual a zero, e
em outras chamadas ser√° igual ao valor rates_total (at√© que o n√∫mero de barras no gr√°fico de pre√ßo
aumenta).
O valor do par√¢metro begin ser√° exatamente igual ao n√∫mero das barras iniciais, para os quais os
valores do indicador Accelerator n√£o s√£o calculados de acordo com a l√≥gica do indicador. Se n√≥s
olharmos para o c√≥digo fonte do indicador personalizado Accelerator.mq5, n√≥s veremos as linha
seguintes na fun√ß√£o OnInit():</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2596
</p>
<pre><code class="language-mql5">
//--- define a primeira barra a partir do qual o √≠ndice ser√° desenhado
   PlotIndexSetInteger(0,PLOT_DRAW_BEGIN,37);
</code></pre>
<p>
Usando a fun√ß√£o PlotIndexSetInteger(0, PLOT_DRAW_BEGIN, empty_first_values), n√≥s definimos o
n√∫mero n√£o-existente dos primeiros valores no array zero de um indicador personalizado, o qual n√£o
precisamos aceitar para o c√°lculo (empty_first_values). Assim, temos mecanismos para:
1. definir o n√∫mero de valores iniciais de um indicador, o qual n√£o dever√° ser usado para os c√°lculos
de outro indicador personalizado;
2. obter informa√ß√µes sobre o n√∫mero dos primeiros valores a serem ignorados quando voc√™ chamar
um outro indicador personalizado , sem entrar na l√≥gica de seus c√°lculos.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2597
<h3>Estilos de Indicador em Exemplos</h3>
O MetaTrader 5 Terminal Cliente inclui 38 indicadores t√©cnicos que podem ser usados em MQL5
programas usando fun√ß√µes apropriadas. Mas a principal vantagem da l√≠ngua MQL5 √© a capacidade de
criar indicadores personalizados, os quais podem ent√£o serem utilizados em Expert Advisors ou
simplesmente serem aplicados sobre gr√°ficos de pre√ßos para fins de an√°lise t√©cnica.
O conjunto total dos indicadores podem serem derivados a partir de v√°rias bases de estilos de
desenhos, conhecidas como plotagem. Plotagem denota uma forma de visualiza√ß√£o de dados, que o
indicador calcula, armazena e providencia o pedido. Existem sete tipos b√°sicos plotagem:
1. Uma linha
2. Uma se√ß√£o (segmento)
3. Histograma
4. Seta (s√≠mbolo)
5. Uma √°rea pintada (canal preenchido)
6. Bars
7. Casti√ßal (candlesticks) japon√™s
Cada plotagem requer um para cinco arrays do tipo double, em que os valores dos indicadores s√£o
armazenados. Para efeitos de comodidade, estes arrays s√£o associados com os buffers do indicador. O
n√∫mero de buffers em um indicador deve ser declarado com anteced√™ncia usando diretivas de
compilador, por exemplo:
</p>
<pre><code class="language-mql5">
#property indicator_buffers 3 // N√∫mero de buffers
#property indicator_plots   2 // N√∫mero de plotes
</code></pre>
<p>
O n√∫mero de buffers no indicador √© sempre maior ou igual ao n√∫mero de plotagem no indicador.
Como cada tipo de plotagem b√°sica pode ter varia√ß√£o de cor ou detalhes de constru√ß√£o, o n√∫mero real
de tipos de plotagem em MQL5 √© de 18:
<h3>Plotagem</h3>
<h3>Descri√ß√£</h3>
o
<h3>Buffers de valor</h3>
<h3>Buffers de cor</h3>
<h3>DRAW_NONE</h3>
<h3>N√£o</h3>
√©
apresent
ado
visualme
nte 
no
gr√°fico,
mas 
os
valores
do buffer
correspo
ndente
podem
ser
vistos na
<h3>Janela de</h3>
<h3>Dados</h3>
1
-</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2598
<h3>Plotagem</h3>
<h3>Descri√ß√£</h3>
o
<h3>Buffers de valor</h3>
<h3>Buffers de cor</h3>
<h3>DRAW_LINE</h3>
<h3>Uma</h3>
linha 
√©
plotada
sobre os
valores
do buffer
correspo
ndente
(valores
vazios no
buffer
s√£o
indesej√°
veis)
1
-
<h3>DRAW_SECTION</h3>
<h3>√â</h3>
desenhad
o 
como
segment
os 
de
linha
entre os
valores
do buffer
correspo
ndente
(geralme
nte tem
muitos
valores
vazios)
1
-
<h3>DRAW_HISTOGRAM</h3>
<h3>√â</h3>
desenhad
o 
como
um
histogra
ma 
a
partir da
linha
zero para
os
valores
do buffer
correspo
ndente
(pode ter
valores
vazios)
1
-</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2599
<h3>Plotagem</h3>
<h3>Descri√ß√£</h3>
o
<h3>Buffers de valor</h3>
<h3>Buffers de cor</h3>
<h3>DRAW_HISTOGRAM2</h3>
<h3>√â</h3>
desenhad
o 
como
um
histogra
ma sobre
dois
buffers
de
indicador
(pode ter
valores
vazios)
2
-
<h3>DRAW_ARROW</h3>
<h3>√â</h3>
desenhad
o 
como
s√≠mbolos
(pode ter
valores
vazios)
1
-
<h3>DRAW_ZIGZAG</h3>
<h3>Similar</h3>
ao estilo
<h3>DRAW_S</h3>
<h3>ECTION,</h3>
mas
diferente
mente,
pode
plotar
segment
os
verticais
em uma
barra
2
-
<h3>DRAW_FILLING</h3>
<h3>Preenchi</h3>
mento de
cor entre
duas
linhas. 2
valores
dos
buffers
correspo
ndentes
s√£o
mostrado
2
-</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2600
<h3>Plotagem</h3>
<h3>Descri√ß√£</h3>
o
<h3>Buffers de valor</h3>
<h3>Buffers de cor</h3>
s 
na
<h3>Janela de</h3>
<h3>Dados</h3>
<h3>DRAW_BARS</h3>
<h3>√â</h3>
desenhad
o 
como
barras. 2
valores
dos
buffers
correspo
ndentes
s√£o
mostrado
s 
na
<h3>Janela de</h3>
<h3>Dados</h3>
4
-
<h3>DRAW_CANDLES</h3>
<h3>Desenha</h3>
do como
<h3>Casti√ßais</h3>
<h3>Japonese</h3>
s
(candlest
icks). 
2
valores
dos
buffers
correspo
ndentes
s√£o
mostrado
s 
na
<h3>Janela de</h3>
<h3>Dados</h3>
4
-
<h3>DRAW_COLOR_LINE</h3>
<h3>Uma</h3>
linha
para 
o
qual voc√™
pode
alternar
as cores
em
diferente
s barras
ou mudar
suas
1
1</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2601
<h3>Plotagem</h3>
<h3>Descri√ß√£</h3>
o
<h3>Buffers de valor</h3>
<h3>Buffers de cor</h3>
cores, a
qualquer
momento
<h3>DRAW_COLOR_SECTION</h3>
<h3>Similar</h3>
ao estilo
<h3>DRAW_S</h3>
<h3>ECTION,</h3>
mas 
a
cor 
de
cada
se√ß√£o
pode ser
ajustada
individua
lmente;
cor
tamb√©m
pode ser
ajustada
dinamica
mente
1
1
<h3>DRAW_COLOR_HISTOGRAM</h3>
<h3>Similar</h3>
ao estilo
<h3>DRAW_H</h3>
<h3>ISTOGRA</h3>
<h3>M,</h3>
mas
cada
faixa
pode ter
uma cor
diferente
, 
voc√™
pode
definir a
cor
dinamica
mente
1
1
<h3>DRAW_COLOR_HISTOGRAM2</h3>
<h3>Similar</h3>
ao estilo
<h3>DRAW_H</h3>
<h3>ISTOGRA</h3>
<h3>M2, mas</h3>
cada
faixa
pode ter
uma cor
2
1</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2602
<h3>Plotagem</h3>
<h3>Descri√ß√£</h3>
o
<h3>Buffers de valor</h3>
<h3>Buffers de cor</h3>
diferente
, 
voc√™
pode
definir a
cor
dinamica
mente
<h3>DRAW_COLOR_ARROW</h3>
<h3>Similar</h3>
ao estilo
<h3>DRAW_A</h3>
<h3>RROW,</h3>
mas cada
s√≠mbolo
pode ter
sua cor.
<h3>Cor pode</h3>
ser
mudada
dinamica
mente
1
1
<h3>DRAW_COLOR_ZIGZAG</h3>
<h3>O estilo</h3>
<h3>DRAW_ZI</h3>
<h3>GZAG</h3>
com
op√ß√µes
de cores
individua
is 
das
se√ß√µes e
mudan√ßa
din√¢mica
das cores
2
1
<h3>DRAW_COLOR_BARS</h3>
<h3>O estilo</h3>
<h3>DRAW_B</h3>
<h3>ARS com</h3>
op√ß√µes
de cores
individua
is 
das
barras e
mudan√ßa
din√¢mica
das cores
4
1
<h3>DRAW_COLOR_CANDLES</h3>
<h3>O estilo</h3>
<h3>DRAW_C</h3>
<h3>ANDLES</h3>
4
1</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2603
<h3>Plotagem</h3>
<h3>Descri√ß√£</h3>
o
<h3>Buffers de valor</h3>
<h3>Buffers de cor</h3>
com
op√ß√µes
de cores
individua
is 
dos
casti√ßais
(candlest
icks) 
e
mudan√ßa
din√¢mica
das cores
A diferen√ßa entre um buffer de indicador e um array
Cada indicador, no seu n√≠vel global, voc√™ deve declarar uma ou mais arrays do tipo double, o qual
ent√£o deve ser usado como um buffer de indicador usando a fun√ß√£o SetIndexBuffer(). Para desenhar
plotagem de indicador, apenas os valores dos buffers do indicador s√£o utilizados, quaisquer outros
arrays n√£o podem ser usados para esta finalidade. Al√©m disso, os valores de buffer s√£o exibidos na
Janela de Dados.
Um buffer de indicador deve ser din√¢mico e n√£o requer especifica√ß√£o de tamanho ‚Äì o tamanho do
array usado como buffer de indicador, √© definido pelo subsistema do terminal com execu√ß√£o
autom√°tica. 
Ap√≥s o array estar ligado ao buffer de indicador, a dire√ß√£o de indexa√ß√£o √© definida por padr√£o num
arrays comum, mas pode usar a fun√ß√£o ArraySetAsSeries() para alterar o modo de acesso aos
elementos array. Por padr√£o, o buffer de indicador √© usado para armazenar dados usados para
plotagem INDICATOR_DATA).
Se os c√°lculos dos valores de indicador requerem seguran√ßa de c√°lculos intermedi√°rios e
armazenamento de valores adicionais para cada barra, ent√£o esse array pode ser declarado como um
buffer de c√°lculo durante a liga√ß√£o (INDICATOR_CALCULATIONS). Para valores intermedi√°rios, voc√™
tamb√©m pode usar um array regular, mas neste caso, o programador tem que gerenciar o tamanho do
array.
Algumas plotagens permitem definir uma cor para cada barra. Para armazenar a informa√ß√£o sobre cor,
buffers de cores s√£o usados (INDICATOR_COLOR_INDEX). A cor √© um tipo integer color, mas todos os
buffers 
de 
indicadores 
ser√£o 
do 
tipo 
double. 
<h3>Valores</h3>
de 
cor 
e 
buffers 
auxiliares
(INDICATOR_CALCULATIONS) n√£o podem ser obtidos usando CopyBuffer().
O n√∫mero de buffers de indicadores devem ser especificados usando a diretiva de compilador
</p>
<pre><code class="language-mql5">
#property indicator_buffers number_of_buffers:
#property indicator_buffers 3  //  o indicador tem 3 buffers
</code></pre>
<p>
O n√∫mero m√°ximo permitido de buffers em um indicador √© 512.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2604
Relev√¢ncia de Buffers de Indicadores e Plotagem
Cada plotagem √© baseada em um ou mais buffers do indicador. Assim, para a exibi√ß√£o de casti√ßais
(candlesticks) simples, quatro valores s√£o obrigat√≥rios - Open (abertura), High (alta), Low (baixa) e
Close (fechamento) de pre√ßos. Conseq√ºentemente, para exibir um indicador na forma de casti√ßais
(candlesticks), √© necess√°rio declarar 4 buffers de indicadores e 4 arrays do tipo double para eles. Por
exemplo:
</p>
<pre><code class="language-mql5">
//--- O indicador tem quatro buffers de indicadores
#property indicator_buffers 4
//--- O indicador tem uma plotagem
#property indicator_plots   1
//--- Graficamente plotando n√∫mero 1 aparecer√° como casti√ßais (candlesticks)
#property indicator_type1   DRAW_CANDLES
//--- Casti√ßais (candlesticks) ser√£o desenhados em clrDodgerBlue
#property indicator_color1  clrDodgerBlue
//--- 4 arrays para buffers de indicadores
double OBuffer[];
double HBuffer[];
double LBuffer[];
double CBuffer[];
</code></pre>
<p>
Graficamente, plotagens autom√°ticas usam buffers de indicadores de acordo com o n√∫mero de
plotagem. A numera√ß√£o da plotagem come√ßa com um, a numera√ß√£o dos buffers come√ßa com zero. Se a
primeira plotagem requer 4 buffers do indicador, ent√£o os primeiros quatro buffers do indicador ser√£o
utilizados para desenh√°-lo. Estes quatro buffers devem estar lincados com os arrays apropriados com a
indexa√ß√£o correta usando a fun√ß√£o SetIndexBuffer().
</p>
<pre><code class="language-mql5">
//--- Arrays vinculados com buffers de indicador
   SetIndexBuffer(0,OBuffer,INDICATOR_DATA);  // O primeiro buffer corresponde ao √≠ndi
   SetIndexBuffer(1,HBuffer,INDICATOR_DATA);  // O segundo buffer corresponde ao √≠ndic
   SetIndexBuffer(2,LBuffer,INDICATOR_DATA);  // O terceiro buffer corresponde ao √≠ndi
   SetIndexBuffer(3,CBuffer,INDICATOR_DATA);  // O quarto buffer corresponde ao √≠ndice
</code></pre>
<p>
A plotagem dos casti√ßais (candlesticks), o indicador usar√° apenas o primeiro dos quatro buffers,
porque a plotagem do &quot;candlestick&quot; foi anunciado sobre o primeiro n√∫mero.
Alterar o exemplo, e adicionar plotagem de uma linha simples - DRAW_LINE. Agora, suponha que a
linha √© numerada como 1, e os casti√ßais (candlesticks) s√£o o n√∫mero 2. O n√∫mero de buffers e o
n√∫mero plotagem aumentou.
</p>
<pre><code class="language-mql5">
//--- O indicador tem 5 buffers de indicador
#property indicator_buffers 5
//--- O indicador tem 2 plotagens
#property indicator_plots   2
//--- Plotagem 1 √© uma linha
#property indicator_type1   DRAW_LINE
//--- A cor d linha √© clrDodgerRed
#property indicator_color1  clrDodgerRed</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2605
</p>
<pre><code class="language-mql5">
//--- Plotagem 2 √© desenhado como casti√ßal (candlestick) japon√™s
#property indicator_type2   DRAW_CANDLES
//--- A cor do casti√ßal (candlestick) √© clrDodgerBlue
#property indicator_color2  clrDodgerBlue
//--- 5 arrays para buffers de indicador 
double LineBuffer[];
double OBuffer[];
double HBuffer[];
double LBuffer[];
double CBuffer[];
</code></pre>
<p>
A ordem das plotagem mudou, e agora a linha vem em primeiro lugar, seguido dos casti√ßais
(candlesticks) Japoneses. Portanto, a ordem dos buffers √© apropriado - primeiro anunciamos um
buffer para a linha com o √≠ndice zero, e ent√£o quatro buffers para os casti√ßais (candlesticks).
</p>
<pre><code class="language-mql5">
   SetIndexBuffer(0,LineBuffer,INDICATOR_DATA);  // O primeiro buffer corresponde ao √≠
//--- Ligando arrays com buffers de indicador para os casti√ßais (candlesticks)
   SetIndexBuffer(1,OBuffer,INDICATOR_DATA);     // O segundo buffer corresponde ao √≠n
   SetIndexBuffer(2,HBuffer,INDICATOR_DATA);     // O terceiro buffer corresponde ao √≠
   SetIndexBuffer(3,LBuffer,INDICATOR_DATA);     // O quarto buffer corresponde ao √≠nd
   SetIndexBuffer(4,CBuffer,INDICATOR_DATA);     // O quinto buffer corresponde ao √≠nd
</code></pre>
<p>
O n√∫mero de buffers e plotagens ser√£o definidos usando somente diretivas de compilador, √©
imposs√≠vel alterar essas propriedades dinamicamente usando fun√ß√µes.
<h3>Vers√µes Coloridas de Estilos</h3>
Como s√£o vistos na tabela, os estilos s√£o divididos em dois grupos. O primeiro grupo inclui estilos
cujo nome n√£o existe a palavra COLOR, n√≥s chamamos de estilos b√°sicos:
¬∑ DRAW_LINE
¬∑ DRAW_SECTION
¬∑ DRAW_HISTOGRAM
¬∑ DRAW_HISTOGRAM2
¬∑ DRAW_ARROW
¬∑ DRAW_ZIGZAG
¬∑ DRAW_FILLING
¬∑ DRAW_BARS
¬∑ DRAW_CANDLES
No segundo grupo, os nomes de estilo cont√™m a palavra COLOR, vamos cham√°-los de vers√µes de
cores:
¬∑ DRAW_COLOR_LINE
¬∑ DRAW_COLOR_SECTION
¬∑ DRAW_COLOR_HISTOGRAM</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2606
¬∑ DRAW_COLOR_HISTOGRAM2
¬∑ DRAW_COLOR_ARROW
¬∑ DRAW_COLOR_ZIGZAG
¬∑ DRAW_COLOR_BARS
¬∑ DRAW_COLOR_CANDLES
Todas as vers√µes de cores de estilos diferentes a partir das b√°sicas permitem especificar uma cor
para cada parte da plotagem. A parte m√≠nima de plotagem √© uma barra, ent√£o podemos dizer que as
vers√µes de cores permitem definir a cor de cada bar.
As exce√ß√µes s√£o os estilos DRAW_NONE e DRAW_FILLING, eles n√£o tem vers√µes de cores.
Para definir a plotagem da cor em cada barra, um buffer adicional para armazenar o √≠ndice de cor foi
adicionada √† vers√£o de cor. Estes √≠ndices indicam o n√∫mero de uma cor numa array especial, a qual
cont√©m um conjunto predefinido de cores. O tamanho do array das cores √© 64. Isto significa que cada
vers√£o de cor de um estilo de pintura permite uma plotagem de 64 cores diferentes.
O conjunto e o n√∫mero de cores na array especial de cores ser√° definido atrav√©s de uma diretiva de
compila√ß√£o #property indicator_color, onde pode especificar todas as cores necess√°rias separadas por
v√≠rgulas. Por exemplo, como uma entrada de um indicador:
</p>
<pre><code class="language-mql5">
//--- Definir 8 cores para colorir os candlesticks (eles s√£o armazenados na array espe
#property indicator_color1  clrRed,clrBlue,clrGreen,clrYellow,clrMagenta,clrCyan,clrLi
</code></pre>
<p>
Ele afirma que para plotar 1, 8 cores s√£o definidas, que ser√£o colocados em um array especial. Al√©m
disso o programa n√£o especifica a cor da plotagem, mas apenas o seu √≠ndice. Se quisermos definir a
cor vermelha para o n√∫mero de barras K, o valor da cor do √≠ndice a partir de array deve ser definido no
buffer de cor do indicador. A cor vermelha √© especificada pela primeira vez na diretiva, que
corresponde ao n√∫mero de √≠ndice 0.
</p>
<pre><code class="language-mql5">
  //--- definir a cor clrRed para candlestick
</code></pre>
<p>
  col_buffer[buffer_index]=0;
O conjunto de cores n√£o √© colocado de uma vez por todas, pode ser alterado de forma din√¢mica
usando PlotIndexSetInteger(). Exemplo:
</p>
<pre><code class="language-mql5">
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          color_array[i]);      //  Uma nova cor
</code></pre>
<p>
<h3>Propriedades do indicador e plotagem</h3>
Para plotagem de indicadores, propriedades podem ser definidas por meio de diretivas de compilador
e usando as fun√ß√µes apropriadas. Ler maiores informa√ß√µes sobre isto em Conex√£o entre Propriedades
do Indicador e Fun√ß√µes. Mudan√ßa din√¢mica de propriedades do indicador usando fun√ß√µes especiais
permitem a cria√ß√£o de indicadores personalizados mais flex√≠veis. </p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2607
In√≠cio do Desenho do Indicador no Gr√°fico
Em muitos casos, de acordo com as condi√ß√µes do algoritmo, √© imposs√≠vel iniciar o c√°lculo dos valores
do indicador imediatamente com a barra atual, uma vez que √© necess√°rio proporcionar um n√∫mero
m√≠nimo de barras anteriores dispon√≠veis no hist√≥rico. Por exemplo, muitos tipos de alisamento
implicam na utiliza√ß√£o de um array de pre√ßos sobre N barras anteriores, e com base nestes valores, o
valor do indicador na barra atual √© calculado.
Nestes casos, n√£o existe qualquer maneira para calcular os valores do indicador para as primeiras N
barras, ou estes valores n√£o se destinam a ser apresentados no gr√°fico e s√£o apenas subsidiadas para
calcular novos valores. Para evitar a plotagem do indicador nas primeiras N barras do hist√≥rico, defina
o valor N para a propriedade PLOT_DRAW_BEGIN para a plotagem correspondente:
</p>
<pre><code class="language-mql5">
//--- Ligando arrays com buffers de indicador para os casti√ßais (candlesticks)
</code></pre>
<p>
<h3>PlotIndexSetInteger(number_of_plot,PLOT_DRAW_BEGIN,N);</h3>
<h3>Onde:</h3>
¬∑ number_of_plot ‚Äì um valor a partir de zero para indicator_plots-1 (numera√ß√£o dos lotes inicia com
zero).
¬∑ N - o n√∫mero da primeira barra no hist√≥rico, no qual o indicador n√£o deve ser exibido sobre o
gr√°fico.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2608
<h3>DRAW_NONE</h3>
O estilo DRAW_NONE √© projetado para uso em casos onde √© necess√°rio calcular os valores de um
buffer e mostr√°-los na Janela de Dados, mas a plotagem no gr√°fico n√£o √© necess√°ria. Para configurar
com precis√£o use a express√£o IndicatorSetInteger(INDICATOR_DIGITS,num_chars) na fun√ß√£o OnInit():
</p>
<pre><code class="language-mql5">
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,InvisibleBuffer,INDICATOR_DATA);
//--- Define a precis√£o dos valores a serem exibidos na Janela de Dados
   IndicatorSetInteger(INDICATOR_DIGITS,0);
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
O n√∫mero de buffers requeridos para plotagem de DRAW_NONE √© 1.
Um exemplo do indicador que mostra o n√∫mero da barra na janela de dados, sobre a qual o mouse
passa sobre ela. A numera√ß√£o corresponde as s√©ries temporais (timeseries), significando que a atual
barra inacabada tem √≠ndice zero e a mais antiga barra tem o maior √≠ndice.
Note que apesar do fato de ser definida a plotagem para a cor vermelha #1, o indicador n√£o desenha
nada no gr√°fico.
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                                    DRAW_NONE.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2609
</p>
<pre><code class="language-mql5">
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property indicator_chart_window
#property indicator_buffers 1
#property indicator_plots   1
//--- plotar Invis√≠vel
#property indicator_label1  &quot;Barra √çndice&quot;
#property indicator_type1   DRAW_NONE
#property indicator_style1  STYLE_SOLID
#property indicator_color1  clrRed
#property indicator_width1  1
//--- buffers do indicador
double         InvisibleBuffer[];
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- Ligando um array e um buffer de indicador
   SetIndexBuffer(0,InvisibleBuffer,INDICATOR_DATA);
//--- Define a precis√£o dos valores a serem exibidos na Janela de Dados
   IndicatorSetInteger(INDICATOR_DIGITS,0);
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static datetime lastbar=0;
//--- Se este for o primeiro c√°lculo do indicador
   if(prev_calculated==0)
     {
      //--- Renumerar as barras pela primeira vez
      CalcValues(rates_total,close);
      //--- Lembrar que a abertura do tempo da barra atual √© no fechamento da √∫ltima b
      lastbar=(datetime)SeriesInfoInteger(_Symbol,_Period,SERIES_LASTBAR_DATE);
     }</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2610
</p>
<pre><code class="language-mql5">
   else
     {
      //--- Se uma nova barra apareceu, sua abertura de tempo difere da √∫ltima barra
      if(lastbar!=SeriesInfoInteger(_Symbol,_Period,SERIES_LASTBAR_DATE))
        {
         //--- Renumerar as barras mais uma vez
         CalcValues(rates_total,close);
         //--- Atualizar o tempo de abertura da barra atual com a √∫ltima barra
         lastbar=(datetime)SeriesInfoInteger(_Symbol,_Period,SERIES_LASTBAR_DATE);
        }
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| N√∫mero das barras como numa timeseries¬†                          |
//+------------------------------------------------------------------+
void CalcValues(int total,double const  &amp;array[])
  {
//--- Definir a indexa√ß√£o do buffer do indicador como numa timeseries
   ArraySetAsSeries(InvisibleBuffer,true);
//--- Definir cada barra com sua numera√ß√£o
   for(int i=0;i&lt;total;i++) InvisibleBuffer[i]=i;
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2611
<h3>DRAW_LINE</h3>
DRAW_LINE desenha uma linha de cor especifica pelos valores do buffer do indicador. A largura, estilo
e cor da linha pode ser definido utilizando as diretivas de compila√ß√£o e dinamicamente usando a
fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de plotagem permitem &quot;avivar&quot; os
indicadores, de modo que suas mudan√ßas de apar√™ncia dependem da situa√ß√£o corrente.
O n√∫mero de buffers requerido para plotagem de DRAW_LINE √© 1.
Um exemplo do indicador que desenha a linha usando o fechamento de pre√ßo das barras. A linha de
cor, a largura e o estilo mudam aleatoriamente a cada N=5 ticks.
Note que inicialmente para plot1 com DRAW_LINE, as propriedades s√£o definidas usando a diretiva de
compilador #property, e ent√£o na fun√ß√£o OnCalculate() estas tr√™s propriedades s√£o definidas
aleatoriamente. O par√¢metro N √© definido nos par√¢metros externos do indicador para a possibilidade
de configura√ß√£o manual (o guia Par√¢metros na janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                                    DRAW_LINE.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_LINE&quot;
#property description &quot;Ele desenha uma linha de uma cor especifica no fechamento dos p
#property description &quot;Cor, a largura e o estilo de linhas √© alterado aleatoriamente&quot;
#property description &quot;depois de cada N ticks&quot;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2612
</p>
<pre><code class="language-mql5">
#property indicator_chart_window
#property indicator_buffers 1
#property indicator_plots   1
//--- Propriedades de linha s√£o definidas usando as diretivas de compila√ß√£o
#property indicator_label1  &quot;Line&quot;      // Nome de uma plotagem para a janela de dados
#property indicator_type1   DRAW_LINE   // Tipo de plotagem √© uma linha
#property indicator_color1  clrRed      // Cor da linha
#property indicator_style1  STYLE_SOLID // Estilo da linha
#property indicator_width1  1           // Largura da linha
//--- par√¢metros de entrada
input int      N=5;         // N√∫mero de ticks para mudar
//--- Um buffer do indicador para plotar
double         LineBuffer[];
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen};
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- Ligando um array e um buffer de indicador
   SetIndexBuffer(0,LineBuffer,INDICATOR_DATA);
//--- Inicializando o gerador de n√∫meros pseudo-aleat√≥rios
   MathSrand(GetTickCount());
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2613
</p>
<pre><code class="language-mql5">
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- Bloco para c√°lculo dos valores do indicador
   for(int i=0;i&lt;rates_total;i++)
     {
      LineBuffer[i]=close[i];
     }
//--- Retorna o valor de prev_calculated para a pr√≥xima chamada da fun√ß√£o
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia da linha desenhada no indicador¬†              |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco para alterar a cor da linha
//--- Obt√©m aleatoriamente um n√∫mero
   int number=MathRand();
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,colors[color_index]);
//--- Escrever a cor da linha
   comm=comm+(string)colors[color_index];
//--- Um bloco para alterar a largura da linha
   number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5; // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot;, Width=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2614
</p>
<pre><code class="language-mql5">
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=EnumToString(styles[style_index])+&quot;, &quot;+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2615
<h3>DRAW_SECTION</h3>
DRAW_SECTION desenha se√ß√µes da cor espec√≠fica pelos valores do buffer do indicador. A largura, cor e
estilo da linha podem ser especificadas como para o estilo DRAW_LINE - usando as diretivas de
compila√ß√£o ou dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das
propriedades de plotagem permitem &quot;avivar&quot; os indicadores, de modo que suas apar√™ncias sejam
alteradas dependendo da situa√ß√£o corrente.
Se√ß√µes s√£o desenhadas a partir de um valor n√£o vazio para outro valor n√£o vazio do buffer de
indicador, valores vazios s√£o ignorados. Para especificar qual o valor que deve ser considerado como
&quot;vazio&quot;, defina esse valor na propriedade PLOT_EMPTY_VALUE: Por exemplo, se o indicador deve ser
desenhado como uma seq√º√™ncia de se√ß√µes sobre valores diferentes de zero, ent√£o voc√™ precisa definir
o valor zero como um vazio:
</p>
<pre><code class="language-mql5">
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(index_of_plot_DRAW_SECTION,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Sempre preencha explicitamente nos valores dos buffers do indicador, defina um valor vazio num
buffer para os elementos que n√£o devem ser plotados.
O n√∫mero de buffers requeridos para plotagem de DRAW_SECTION √© 1.
Um exemplo do indicador que desenha se√ß√µes entre os pre√ßos de Alta (high) e de Baixa (low). A cor, a
largura, e o estilo de todas se√ß√µes mudam aleatoriamente a cada N ticks. 
Note que para inicializar plot1 com DRAW_SECTION, as propriedades s√£o definidas usando a diretiva
do compilador #property, e ent√£o na fun√ß√£o OnCalculate(), estas tr√™s propriedades s√£o definidas
aleatoriamente. O par√¢metro N √© definido nos par√¢metros externos do indicador para a possibilidade
de configura√ß√£o manual (o guia Par√¢metros na janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                                 DRAW_SECTION.mq5 |</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2616
</p>
<pre><code class="language-mql5">
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_SECTION&quot;
#property description &quot;Desenha se√ß√µes em linha reta para cada barra&quot;
#property description &quot;A cor, a largura eo estilo de se√ß√µes s√£o alteradas aleatoriamen
#property description &quot;depois de cada N ticks&quot;
#property indicator_chart_window
#property indicator_buffers 1
#property indicator_plots   1
//--- plotar Se√ß√£o
#property indicator_label1  &quot;Se√ß√£o&quot;
#property indicator_type1   DRAW_SECTION
#property indicator_color1  clrRed
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      bars=5;           // O comprimento das se√ß√µes nas barras
input int      N=5;              // O n√∫mero de ticks para mudar o estilo das se√ß√µes
//--- Um buffer do indicador para plotar
double         SectionBuffer[];
//--- Uma vari√°vel auxiliar para calcular extremidades das se√ß√µes
int            divider;
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen};
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- Ligando um array e um buffer de indicador
   SetIndexBuffer(0,SectionBuffer,INDICATOR_DATA);
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);
//--- Verifica o par√¢metro do indicador
   if(bars&lt;=0)
     {
      PrintFormat(&quot;Valor invalido do par√¢metro da barra=%d&quot;,barras);
      return(INIT_PARAMETERS_INCORRECT);
     }
   else divider=2*bars;
//---+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2617
</p>
<pre><code class="language-mql5">
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- O n√∫mero de barra a partir da qual o c√°lculo dos valores do indicador inicia
   int start=0;
//--- Se o indicador foi calculado antes, ent√£o definir o in√≠cio na barra anterior
   if(prev_calculated&gt;0) start=prev_calculated-1;
//--- Aqui est√£o todos os c√°lculos dos valores do indicador
   for(int i=start;i&lt;rates_total;i++)
     {
      //--- Obter um resto da divis√£o do n√∫mero de barra por 2*Barras
      int rest=i%divider;
      //--- Se o n√∫mero de barra √© divis√≠vel por 2*Barras
      if(rest==0)
        {
         //--- Definir o final da se√ß√£o na alta de pre√ßo desta barra
         SectionBuffer[i]=high[i];
        }
      //---Se o resto da divis√£o √© igual para barras, 
      else
        {
         //--- Definir o final da se√ß√£o na alta de pre√ßo desta barra
         if(rest==bars) SectionBuffer[i]=low[i];
         //--- Se nada aconteceu, ignore a barra - definir 0</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2618
</p>
<pre><code class="language-mql5">
         else SectionBuffer[i]=0;
        }
     }
//--- Retorna o valor de prev_calculated para a pr√≥xima chamada da fun√ß√£o
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Alterar a apar√™ncia das se√ß√µes no indicador¬†                     |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco de mudan√ßa da cor da linha
   int number=MathRand(); // Obter um n√∫mero aleat√≥rio
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,colors[color_index]);
//--- Escrever a cor da linha
   comm=comm+&quot;\r\n&quot;+(string)colors[color_index];
//--- Um bloco para alterar a largura da linha
   number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5;   // A largura √© definida de 0 a 4
//--- Definir a largura
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot;\r\nWidth=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;
//--- define o estilo da linha
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=&quot;\r\n&quot;+EnumToString(styles[style_index])+&quot;&quot;+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2619
<h3>DRAW_HISTOGRAM</h3>
O estilo DRAW_HISTOGRAM desenha um histograma como uma seq√º√™ncia de colunas de uma
especifica cor do zero para um especifico valor. Os valores s√£o extra√≠dos do buffer do indicador. A
largura, cor e estilo da coluna pode ser especificado como para o estilo DRAW_LINE - usando diretivas
de compila√ß√£o ou dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das
propriedades de plotagem permitem alterar o visual do histograma com base na situa√ß√£o atual.
Uma vez que uma coluna a partir do n√≠vel zero √© desenhada sobre cada barra, DRAW_HISTOGRAM
deve ser melhor utilizada numa janela do gr√°fico em separado. Na maioria das vezes este tipo de de
plotagem √© usada para criar indicadores do tipo de oscilador, por exemplo, Bears Power ou OsMA. Para
os valores vazios que n√£o s√£o vis√≠veis, o valor zero deve ser especificado.
O n√∫mero de buffers requerido para plotagem de DRAW_HISTOGRAM √© 1.
Um exemplo do indicador que desenha uma sen√≥ide de uma cor espec√≠fica com base na fun√ß√£o
MathSin(). A cor, a largura e o estilo de todas colunas do histograma mudam aleatoriamente a cada N
ticks. O par√¢metro de barras determina o per√≠odo da sen√≥ide, isto √©, ap√≥s um n√∫mero especifico de
barras a sen√≥ide vai repetir o ciclo.
Note que inicialmente para plot1 com DRAW_HISTOGRAM, as propriedades s√£o definidas usando a
diretiva de compilador #property, e ent√£o na fun√ß√£o OnCalculate() estas tr√™s propriedades s√£o
definidas aleatoriamente. O par√¢metro N √© definido nos par√¢metros externos do indicador para a
possibilidade de configura√ß√£o manual (o guia Par√¢metros na janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                               DRAW_HISTOGRAM.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2620
</p>
<pre><code class="language-mql5">
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_HISTOGRAM&quot;
#property description &quot;Ele desenha um sen√≥ide como um histograma em uma janela separad
#property description &quot;A cor e a largura das colunas s√£o alterados aleatoriamente&quot;
#property description &quot;depois de cada N ticks&quot;
#property description &quot;O par√¢metro das barras define o n√∫mero de barras no ciclo da se
#property indicator_separate_window
#property indicator_buffers 1
#property indicator_plots   1
//--- plotar Histograma
#property indicator_label1  &quot;Histograma&quot;
#property indicator_type1   DRAW_HISTOGRAM
#property indicator_color1  clrBlue
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      bars=30;          // O per√≠odo de uma sen√≥ide em barras
input int      N=5;              // O n√∫mero de ticks para alterar o histograma
//--- buffers do indicador
double         HistogramBuffer[];
//--- Um fator para obter o √¢ngulo 2Pi em radianos, quando multiplicado pelo par√¢metro
double    multiplier;
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen};
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,HistogramBuffer,INDICATOR_DATA);
//--- Calcular a multiplica√ß√£o
   if(bars&gt;1)multiplier=2.*M_PI/bars;
   else
     {
      PrintFormat(&quot;Defina o valor das barras=%d maior do que 1&quot;,bars);
      //--- Finaliza√ß√£o antecipada do indicador
      return(INIT_PARAMETERS_INCORRECT);
     }
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2621
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- Calcule os valores do indicador
   int start=0;
//--- Se j√° foi calculado durante os in√≠cios anteriores do OnCalculate
   if(prev_calculated&gt;0) start=prev_calculated-1; // definir o in√≠cio do c√°lculo com a
//--- Preencher o buffer do indicador com valores
   for(int i=start;i&lt;rates_total;i++)
     {
      HistogramBuffer[i]=sin(i*multiplier);
     }
//--- Retorna o valor de prev_calculated para a pr√≥xima chamada da fun√ß√£o
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia das linhas no indicador¬†                      |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco para alterar a cor da linha
   int number=MathRand(); // Obter um n√∫mero aleat√≥rio
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index=number%size;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2622
</p>
<pre><code class="language-mql5">
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,colors[color_index]);
//--- Escrever a cor da linha
   comm=comm+&quot;\r\n&quot;+(string)colors[color_index];
//--- Um bloco para alterar a largura da linha
   number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5;   // A largura √© definida de 0 a 4
//--- Definir a largura
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot;\r\nWidth=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;
//--- define o estilo da linha
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=&quot;\r\n&quot;+EnumToString(styles[style_index])+&quot;&quot;+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2623
<h3>DRAW_HISTOGRAM2</h3>
O estilo DRAW_HISTOGRAM2 desenha uma histograma de uma cor especifica ‚Äì segmentos verticais
usando os valores de dois buffers do indicator. A largura, cor e estilo dos segmentos podem ser
especificados para o estilo DRAW_LINE - usando diretivas de compila√ß√£o ou dinamicamente usando a
fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de plotagem permitem alterar o
visual do histograma com base na situa√ß√£o atual.
O estilo DRAW_HISTOGRAM2 pode ser usado numa sub-janela separada e na sua janela principal. Para
valores vazios nada √© desenhado, todos os valores nos buffers do indicador precisam ser definidos
explicitamente. Buffers n√£o s√£o inicializados com o valor zero.
O n√∫mero de buffers requerido para plotagem de DRAW_HISTOGRAM2 √© 2.
Um exemplo de indicador que plota um segmento vertical da cor especifica e largura entre a Abertura
(open) e o Fechamento (close) de pre√ßos de cada barra. A cor, a largura e o estilo de todas as colunas
do histograma mudam aleatoriamente a cada N ticks. durante a inicializa√ß√£o do indicador, na fun√ß√£o
OnInit(), o n√∫mero do dia da semana em que n√£o ser√° desenhado o histograma - invisible_day - √©
definido aleatoriamente. Para este fim um valor vazio √© definido PLOT_EMPTY_VALUE=0:
</p>
<pre><code class="language-mql5">
//--- Definir um valor vazio
   PlotIndexSetDouble(index_of_plot_DRAW_SECTION,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Note que inicialmente para plot1 com DRAW_HISTOGRAM2, as propriedades s√£o definidas usando a
diretiva de compilador #property, e ent√£o na fun√ß√£o OnCalculate() estas tr√™s propriedades s√£o
definidas aleatoriamente. O par√¢metro N √© definido nos par√¢metros externos do indicador para a
possibilidade de configura√ß√£o manual (o guia Par√¢metros na janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                              DRAW_HISTOGRAM2.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2624
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Un indicador para demonstrar DRAW_HISTOGRAM2&quot;
#property description &quot;√â desenhado um segmento entre a abertura e fechamento em cada b
#property description &quot;A cor, a largura e o estilo s√£o alterados aleatoriamente&quot;
#property description &quot;depois de cada N ticks&quot;
#property indicator_chart_window
#property indicator_buffers 2
#property indicator_plots   1
//--- plotar Histogram_2
#property indicator_label1  &quot;Histogram_2&quot;
#property indicator_type1   DRAW_HISTOGRAM2
#property indicator_color1  clrRed
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;              // O n√∫mero de ticks para alterar o histograma
//--- buffers do indicador
double         Histogram_2Buffer1[];
double         Histogram_2Buffer2[];
//--- O dia da semana, em que o indicador n√£o √© plotado
int invisible_day;
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen};
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,Histogram_2Buffer1,INDICATOR_DATA);
   SetIndexBuffer(1,Histogram_2Buffer2,INDICATOR_DATA);
//--- Definir um valor vazio
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);
//--- Obt√©m aleatoriamente um n√∫mero a partir do 0 at√© 5
   invisible_day=MathRand()%6;
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2625
</p>
<pre><code class="language-mql5">
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- Calcule os valores do indicador
   int start=0;
//--- Para obter o dia da semana pela abertura de pre√ßo de cada barra
   MqlDateTime dt;
//--- Se j√° foi calculado durante os in√≠cios anteriores do OnCalculate
   if(prev_calculated&gt;0) start=prev_calculated-1; // definir o in√≠cio do c√°lculo com a
//--- Preencher o buffer do indicador com valores
   for(int i=start;i&lt;rates_total;i++)
     {
      TimeToStruct(time[i],dt);
      if(dt.day_of_week==invisible_day)
        {
         Histogram_2Buffer1[i]=0;
         Histogram_2Buffer2[i]=0;
        }
      else
        {
         Histogram_2Buffer1[i]=open[i];
         Histogram_2Buffer2[i]=close[i];
        }
     }
//--- Retorna o valor de prev_calculated para a pr√≥xima chamada da fun√ß√£o
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia das linhas no indicador¬†                      |
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2626
</p>
<pre><code class="language-mql5">
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco de mudan√ßa da cor da linha
   int number=MathRand(); // Obter um n√∫mero aleat√≥rio
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,colors[color_index]);
//--- Escrever a cor da linha
   comm=comm+&quot;\r\n&quot;+(string)colors[color_index];
//--- Um bloco para alterar a largura da linha
   number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5;   // A largura √© definida de 0 a 4
//--- Define a largura da linha
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot;\r\nWidth=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;
//--- define o estilo da linha
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=&quot;\r\n&quot;+EnumToString(styles[style_index])+&quot;&quot;+comm;
//--- Adiciona informa√ß√£o sobre o dia que √© omitido nos c√°lculos
   comm=&quot;\r\nDia n√£o plotado - &quot;+EnumToString((ENUM_DAY_OF_WEEK)invisible_day)+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2627
<h3>DRAW_ARROW</h3>
O estilo DRAW_ARROW desenha setas de cor espec√≠fica (s√≠mbolos do conjunto Wingdings) baseado no
valor do buffer do indicador. A largura e a cor dos s√≠mbolos pode ser especificado semelhante ao
modelo DRAW_LINE - usando diretivas de compilador ou dinamicamente usando a fun√ß√£o
PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de plotagem permitem alterar o visual de
um indicador baseado na situa√ß√£o atual.
O c√≥digo de s√≠mbolo √© definido usando a propriedade PLOT_ARROW. 
</p>
<pre><code class="language-mql5">
//--- Definir o c√≥digo s√≠mbolo a partir das fontes Wingdings para desenhar em PLOT_ARR
   PlotIndexSetInteger(0,PLOT_ARROW,code);
</code></pre>
<p>
O valor padr√£o do PLOT_ARROW=159 (um c√≠rculo).
Cada seta √© na verdade um s√≠mbolo que tem a altura e o ponto de ancoragem e pode abranger algumas
informa√ß√µes importantes num gr√°fico (por exemplo, o pre√ßo de fechamento da barra). Assim,
podemos adicionalmente especificar o deslocamento vertical em pixels, o qual n√£o depende da escala
do gr√°fico. As setas ser√£o deslocadas para baixo pelo n√∫mero especificado de pixels, embora os
valores do indicador permanecer√£o os mesmos:
</p>
<pre><code class="language-mql5">
//--- Definir o deslocamento vertical das setas em pixels
   PlotIndexSetInteger(0,PLOT_ARROW_SHIFT,shift);
</code></pre>
<p>
Um valor negativo de PLOT_ARROW_SHIFT significa a mudan√ßa de setas para cima, valores positivos
deslocam a seta para baixo.
O estilo DRAW_ARROW pode ser usado numa sub-janela separada de um gr√°fico e em sua janela
principal. Valores vazios n√£o s√£o desenhados e n√£o aparecem na &quot;Janela de Dados&quot;, todos os valores
nos buffers do indicador devem ser definidos explicitamente. Buffers n√£o s√£o inicializados com o valor
zero.
</p>
<pre><code class="language-mql5">
//--- Definir um valor vazio
   PlotIndexSetDouble(index_of_plot_DRAW_ARROW,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
O n√∫mero de buffers necess√°rios para plotagem DRAW_ARROW √© 1.
Um exemplo de indicador que desenha as setas em cada uma das barras com o pre√ßo mais alto do que
o pre√ßo final da barra anterior. A cor, a largura, deslocamento e s√≠mbolo de c√≥digo de todas setas s√£o
alterados aleatoriamente a cada N ticks.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2628
No exemplo, para plot1 com o estilo DRAW_ARROW, as propriedades, a cor e o tamanho s√£o
especificados usando a diretiva de compilador #property, e depois na fun√ß√£o OnCalculate() as
propriedades s√£o definidas aleatoriamente. O par√¢metro N √© definido nos par√¢metros externos do
indicador para a possibilidade de configura√ß√£o manual (o guia Par√¢metros na janela Propriedades do
indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                                   DRAW_ARROW.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_ARROW&quot;
#property description &quot;Desenha setas definidas pelos caracteres Unicode, sobre um gr√°f
#property description &quot;A cor, o tamanho, deslocamento e c√≥digo s√≠mbolo da seta, s√£o al
#property description &quot;depois de cada N ticks&quot;
#property description &quot;O par√¢metro de c√≥digo define o valor da base: c√≥digo = 159 (um 
#property indicator_chart_window
#property indicator_buffers 1
#property indicator_plots   1
//--- Plotagem de Setas
#property indicator_label1  &quot;Setas&quot;
#property indicator_type1   DRAW_ARROW
#property indicator_color1  clrGreen
#property indicator_width1  1
//--- par√¢metros de entrada</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2629
</p>
<pre><code class="language-mql5">
input int      N=5;         // N√∫mero de ticks para mudar
input ushort   code=159;    // C√≥digo s√≠mbolo para desenhar em DRAW_ARROW
//--- Um buffer do indicador para plotar
double         ArrowsBuffer[];
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen};
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,ArrowsBuffer,INDICATOR_DATA);
//--- Definir o c√≥digo s√≠mbolo para desenho em PLOT_ARROW
   PlotIndexSetInteger(0,PLOT_ARROW,code);
//--- Definir o deslocamento vertical das setas em pixels
   PlotIndexSetInteger(0,PLOT_ARROW_SHIFT,5);
//--- Definir como um valor vazio 0
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcular ticks para mudar a cor, tamanho, deslocamento e c√≥digo da seta
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- Bloco para c√°lculo dos valores do indicador</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2630
</p>
<pre><code class="language-mql5">
   int start=1;
   if(prev_calculated&gt;0) start=prev_calculated-1;
//--- Calculando loop
   for(int i=1;i&lt;rates_total;i++)
     {
      //--- Se o pre√ßo atual fechado √© mais alto do que o anterior, desenhar uma seta
      if(close[i]&gt;close[i-1])
         ArrowsBuffer[i]=close[i];
      //--- Otherwise specify the zero value
      else
         ArrowsBuffer[i]=0;
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Alterar a apar√™ncia dos s√≠mbolos no indicador                    |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para formar as informa√ß√µes sobre as propriedades do indicador
   string comm=&quot;&quot;;
//--- Um bloco para alterar a cor da seta
   int number=MathRand(); // Obter um n√∫mero aleat√≥rio
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,colors[color_index]);
//--- Escrever a cor da linha
   comm=comm+&quot;\r\n&quot;+(string)colors[color_index];
//--- Um bloco para mudar o tamanho das setas
   number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5;   // O tamanho √© definido a partir de 0 at√© 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a cor da linha
   comm=comm+&quot;\r\nWidth=&quot;+IntegerToString(width);
//--- Um bloco para mudar o c√≥digo das setas (PLOT_ARROW)
   number=MathRand();
//--- Obter o restante da divis√£o de n√∫mero inteiro para calcular um novo c√≥digo da se
   int code_add=number%20;
//--- Definir o novo s√≠mbolo de c√≥digo como o resultado de code+code_add
   PlotIndexSetInteger(0,PLOT_ARROW,code+code_add);
//--- Escreva o c√≥digo de s√≠mbolo PLOT_ARROW</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2631
</p>
<pre><code class="language-mql5">
   comm=&quot;\r\n&quot;+&quot;PLOT_ARROW=&quot;+IntegerToString(code+code_add)+comm;
//--- Um bloco de mudan√ßa do deslocamento vertical das setas em pixels
   number=MathRand();
//--- Obter o deslocamento como o restante da divis√£o inteira
   int shift=20-number%41;
//--- Definir o deslocamento novo de -20 a 20
   PlotIndexSetInteger(0,PLOT_ARROW_SHIFT,shift);
//--- Escrever o deslocamento PLOT_ARROW_SHIFT
   comm=&quot;\r\n&quot;+&quot;PLOT_ARROW_SHIFT=&quot;+IntegerToString(shift)+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2632
<h3>DRAW_ZIGZAG</h3>
O estilo DRAW_ZIGZAG desenha segmentos da cor especifica baseada nos valor de dois buffers do
indicador. Este estilo √© muito similar ao DRAW_SECTION, mas ao contr√°rio deste √∫ltimo, permite
desenhar segmentos verticais dentro de uma barra, se os valores de ambos os buffers do indicador
s√£o definidos para este barra. Os segmentos s√£o plotados a partir de um valor no primeiro buffer para
um valor no segundo buffer do indicador. Nenhum dos buffers pode conter somente valores vazios,
uma vez que neste caso nada √© plotado.
A largura, cor e estilo da linha podem ser especificadas como para o estilo DRAW_SECTION - usando as
diretivas de compila√ß√£o ou dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas
din√¢micas das propriedades de plotagem permitem &quot;avivar&quot; os indicadores, de modo que suas
apar√™ncias sejam alteradas dependendo da situa√ß√£o corrente.
Se√ß√µes s√£o desenhadas a partir de um valor n√£o vazio de um buffer para um valor n√£o vazio de outro
buffer do indicador. Para especificar o valor que deve ser considerado como &quot;vazio&quot;, defina esse valor
na propriedade PLOT_EMPTY_VALUE:
</p>
<pre><code class="language-mql5">
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(index_of_plot_DRAW_ZIGZAG,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Sempre preencher explicitamente os valores dos buffers do indicador, definir um valor vazio num
buffer para ignorar barras.
O n√∫mero de buffers requeridos para plotagem DRAW_ZIGZAG √© 2.
Um exemplo de indicador de que plota uma serra com base nos altas e baixas dos pre√ßos. A cor, a
largura eo estilo das linhas zigzag alteram aleatoriamente a cada N ticks.
Note que para inicializar plot1 com DRAW_ZIGZAG, as propriedades s√£o definidas usando a diretiva de
compilar #property, e ent√£o na fun√ß√£o OnCalculate() estas propriedades s√£o definidas aleatoriamente.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2633
O par√¢metro N √© definido nos par√¢metros externos do indicador para a possibilidade de configura√ß√£o
manual (o guia Par√¢metros na janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                                  DRAW_ZIGZAG.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_ZIGZAG&quot;
#property description &quot;Ele desenha uma \&quot;serra\&quot; como segmentos de reta, ignorando as 
#property description &quot;O dia a ignorar √© selecionado aleatoriamente durante a iniciali
#property description &quot;A cor, a largura e tamanho dos segmentos s√£o alterados aleatori
#property description &quot; a cada N ticks&quot;
#property indicator_separate_window
#property indicator_buffers 2
#property indicator_plots   1
//--- plotar ZigZag
#property indicator_label1  &quot;ZigZag&quot;
#property indicator_type1   DRAW_ZIGZAG
#property indicator_color1  clrBlue
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;              // N√∫mero de ticks para alterar 
//--- buffers do indicador
double         ZigZagBuffer1[];
double         ZigZagBuffer2[];
//--- O dia da semana, em que o indicador n√£o √© plotado
int invisible_day;
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen};
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- Arrays de liga√ß√£o e buffers do indicador
   SetIndexBuffer(0,ZigZagBuffer1,INDICATOR_DATA);
   SetIndexBuffer(1,ZigZagBuffer2,INDICATOR_DATA);
//--- Obter um valor aleat√≥rio de 0 para 6, para este dia o indicador n√£o √© plotado
   invisible_day=MathRand()%6;
//--- O valor 0 (vazio) n√£o vai participar no desenho</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2634
</p>
<pre><code class="language-mql5">
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetString(0,PLOT_LABEL,&quot;ZigZag1;ZigZag2&quot;);
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero suficiente de ticks foi acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- A estrutura de tempo √© necess√°rio para obter o dia da semana de cada barra
   MqlDateTime dt;
//--- A posi√ß√£o inicial dos c√°lculos
   int start=0;
//--- Se o indicador foi calculado com o tick anterior, ent√£o inicia o c√°lculo com o p
   if(prev_calculated!=0) start=prev_calculated-1;
//--- Calculando loop
   for(int i=start;i&lt;rates_total;i++)
     {
      //--- Escreva o tempo de abertura da barra na estrutura
      TimeToStruct(time[i],dt);
      //--- Se o dia da semana desta barra √© igual para invisible_day
      if(dt.day_of_week==invisible_day)
        {
         //--- Escrever valores vazios de buffers para este barra
         ZigZagBuffer1[i]=0;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2635
</p>
<pre><code class="language-mql5">
         ZigZagBuffer2[i]=0;
        }
      //--- Se o dia da semana √© OK, preencha os buffers
      else
        {
         //--- Se o n√∫mero de barra √© o mesmo
         if(i%2==0)
           {
            //---  Escrever High (alta) no primeiro buffer a Low (baixa) no segundo
            ZigZagBuffer1[i]=high[i];
            ZigZagBuffer2[i]=low[i];
           }
         //--- O n√∫mero da barra √© impar
         else
           {
            //--- Preenchimento da barra na ordem inversa
            ZigZagBuffer1[i]=low[i];
            ZigZagBuffer2[i]=high[i];
           }
        }
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Alterar a apar√™ncia dos segmentos zigzag¬†                        |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de ZigZag
   string comm=&quot;&quot;;
//--- Um bloco para mudar a cor do ziguezague
   int number=MathRand(); // Obter um n√∫mero aleat√≥rio
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,colors[color_index]);
//--- Escrever a cor da linha
   comm=comm+&quot;\r\n&quot;+(string)colors[color_index];
//--- Um bloco para alterar a largura da linha
   number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5;   // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2636
</p>
<pre><code class="language-mql5">
   comm=comm+&quot;\r\nWidth=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=&quot;\r\n&quot;+EnumToString(styles[style_index])+&quot;&quot;+comm;
//--- Adiciona informa√ß√£o sobre o dia que √© omitido nos c√°lculos
   comm=&quot;\r\nDia n√£o plotado - &quot;+EnumToString((ENUM_DAY_OF_WEEK)invisible_day)+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2637
<h3>DRAW_FILLING</h3>
O estilo DRAW_FILLING plota uma √°rea colorida entre valores de dois buffers do indicador. De fato,
este modelo desenha duas linhas e preenche o espa√ßo entre elas, com uma das duas cores espec√≠ficas.
Ele √© usado para a cria√ß√£o de indicadores que desenham canais. Nenhum dos buffers podem conter
apenas valores vazios, uma vez que, neste caso, nada √© plotado.
Voc√™ pode definir duas cores de preenchimento:
¬∑ a primeira cor √© usada para as √°reas onde os valores do primeiro buffer s√£o maiores do que os
valores do segundo buffer do indicador;
¬∑ a segunda cor √© usada para as √°reas onde os valores de do segundo buffer do s√£o maiores do que os
valores no primeiro buffer indicador.
A cor de preenchimento pode ser definida usando as diretivas do compilador ou dinamicamente usando
a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de plotagem permitem &quot;avivar&quot;
os indicadores, de modo que suas mudan√ßas de apar√™ncia dependem da situa√ß√£o corrente.
O indicador √© calculado para todas as barras, para a qual os valores dos dois buffers do indicador n√£o
s√£o iguais a 0 ou o valor vazio. Para especificar o valor que deve ser considerado como &quot;vazio&quot;, defina
esse valor na propriedade PLOT_EMPTY_VALUE:
</p>
<pre><code class="language-mql5">
   #define INDICATOR_EMPTY_VALUE -1.0
   ...
//--- INDICATOR_EMPTY_VALUE (valor vazio) n√£o vai participar no c√°lculo de
   PlotIndexSetDouble (DRAW_FILLING_creation_index,PLOT_EMPTY_VALUE,INDICATOR_EMPTY_VA
</code></pre>
<p>
Desenhar sobre as barras que n√£o participam no c√°lculo do indicador depende dos valores nos buffers
do indicador:
¬∑ Barras, para os quais os valores de ambos os buffers do indicador s√£o iguais a 0, n√£o participam no
desenho do indicador. Isto significa que a √°rea com valores iguais a zero n√£o √© preenchida.
¬∑ Barras, para as quais os valores dos buffers do indicador s√£o iguais ao &quot;valor vazio&quot;, participam no
desenho do indicador. A √°rea com valores vazios ser√° preenchida de modo que conecte as √°reas com
valores significativos.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2638
Deve ser notado que se o &quot;valor vazio&quot; √© igual a zero, as barras que n√£o participam no c√°lculo do
indicador tamb√©m s√£o preenchidas.
O n√∫mero de buffers necess√°rios para plotagem DRAW_FILLING √© 2.
Um exemplo do indicador que desenha um canal entre duas MAs com diferentes per√≠odos m√©dios em
uma janela separada. A mudan√ßa das cores no cruzamento das m√©dias m√≥veis mostra visualmente a
mudan√ßa das tend√™ncias ascendentes e descendentes. As cores alteram aleatoriamente a cada N ticks.
O par√¢metro N √© definido nos par√¢metro externos do indicador para a possibilidade de configura√ß√£o
manual (na guia Par√¢metros na janela Propriedades do indicador).
Note que inicialmente para plot1 com DRAW_FILLING as propriedades s√£o definidas usando a diretiva
de compilador #property, e ent√£o na fun√ß√£o OnCalculate() novas cores s√£o definidas aleatoriamente. 
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                                 DRAW_FILLING.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2639
</p>
<pre><code class="language-mql5">
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_FILLING&quot;
#property description &quot;Ele desenha um canal entre duas MAs em uma janela separada&quot;
#property description &quot;O preenchimento da cor √© alterada aleatoriamente&quot;
#property description &quot;depois de cada N ticks&quot;
#property indicator_separate_window
#property indicator_buffers 2
#property indicator_plots   1
//--- plotar Interse√ß√£o
#property indicator_label1  &quot;Interse√ß√£o&quot;
#property indicator_type1   DRAW_FILLING
#property indicator_color1  clrRed,clrBlue
#property indicator_width1  1
//--- par√¢metros de entrada
input int      Fast=13;          // Per√≠odo r√°pido da MA
input int      Slow=21;          // Per√≠odo lento da MA
input int      shift=1;          // Deslocamento das MAs para frente (positivo)
input int      N=5;              // N√∫mero de ticks para alterar 
//--- buffers do Indicador
double         IntersectionBuffer1[];
double         IntersectionBuffer2[];
int fast_handle;
int slow_handle;
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen,clrAquamarine,clrBlanchedAlmond,clrBrown,clrCo
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,IntersectionBuffer1,INDICATOR_DATA);
   SetIndexBuffer(1,IntersectionBuffer2,INDICATOR_DATA);
//---
   PlotIndexSetInteger(0,PLOT_SHIFT,shift);
//---
   fast_handle=iMA(_Symbol,_Period,Fast,0,MODE_SMA,PRICE_CLOSE);
   slow_handle=iMA(_Symbol,_Period,Slow,0,MODE_SMA,PRICE_CLOSE);
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2640
</p>
<pre><code class="language-mql5">
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero suficiente de ticks foi acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- Faz o primeiro c√°lculo do indicador, ou os dados foram alterados e requerem um r
   if(prev_calculated==0)
     {
      //--- Copia todos os valores dos indicadores para os buffers apropriados
      int copied1=CopyBuffer(fast_handle,0,0,rates_total,IntersectionBuffer1);
      int copied2=CopyBuffer(slow_handle,0,0,rates_total,IntersectionBuffer2);
     }
   else // Preenche apenas os dados que s√£o atualizados
     {
      //--- Obt√©m a diferen√ßa entre as barras atuais e as que iniciaram anteriormente 
      int to_copy=rates_total-prev_calculated;
      //--- Se n√£o existe qualquer diferen√ßa, ainda c√≥pia um valor - na barra zero
      if(to_copy==0) to_copy=1;
      //--- copia valores to_copy para o fim dos buffers do indicador
      int copied1=CopyBuffer(fast_handle,0,0,to_copy,IntersectionBuffer1);
      int copied2=CopyBuffer(slow_handle,0,0,to_copy,IntersectionBuffer2);
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera as cores do preenchimento do canal¬†                       |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco para alterar a cor da linha</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2641
</p>
<pre><code class="language-mql5">
   int number=MathRand(); // Obter um n√∫mero aleat√≥rio
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index1=number%size;
//--- Define a primeira cor como a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,0,colors[color_index1]);
//--- Escreve a primeira cor
   comm=comm+&quot;\r\nColor1 &quot;+(string)colors[color_index1];
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   number=MathRand(); // Obt√©m um n√∫mero aleat√≥rio
   int color_index2=number%size;
//--- Define a segunda cor como a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,1,colors[color_index2]);
//--- Escreve a segunda cor
   comm=comm+&quot;\r\nColor2 &quot;+(string)colors[color_index2];
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2642
<h3>DRAW_BARS</h3>
O estilo DRAW_BARS desenha barras nos valores de quatro buffers do indicador, que cont√™m a
Abertura (open), Alta (high), Baixa (low) e Fechamento (close) dos pre√ßos. √â usado para a cria√ß√£o de
indicadores personalizados como barras, incluindo aqueles numa sub-janela separada de um gr√°fico e
sobre outros instrumentos financeiros.
A cor das barras pode ser definida usando as diretivas de compilador ou dinamicamente utilizando a
fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de plotagem permitem &quot;avivar&quot; os
indicadores, de modo que suas mudan√ßas de apar√™ncia dependem da situa√ß√£o corrente.
O indicador √© desenhado apenas para as barras, para o qual os valores n√£o vazios de todos quatro
buffers do indicador s√£o definidos. Para especificar o valor que deve ser considerado como &quot;vazio&quot;,
defina este valor na propriedade PLOT_EMPTY_VALUE:
</p>
<pre><code class="language-mql5">
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(index_of_plot_DRAW_BARS,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Sempre preencher explicitamente os valores dos buffers do indicador, definir um valor vazio num
buffer para ignorar barras.
O n√∫mero de buffers necess√°rios para plotagem de DRAW_BARS √© 4. Todos os buffers para a plotagem
devem ir um ap√≥s o outro na ordem dada: Open (abertura do pre√ßo), High (alta do pre√ßo), Low (baixa
do pre√ßo) e Close (fechamento do pre√ßo). Nenhum dos buffers podem conter apenas valores vazios,
uma vez que, neste caso, nada √© plotado.
Um exemplo do indicador que desenha barras sobre um instrumento financeiro selecionado numa
janela separada. A cor das barras muda aleatoriamente a cada N ticks. O par√¢metro N √© definido nos
par√¢metro externos do indicador para a possibilidade de configura√ß√£o manual (na guia Par√¢metros na
janela Propriedades do indicador).</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2643
Por favor, note que para plot1 com o estilo DRAW_BARS, a cor √© definida usando a diretiva de
compilador #property, e ent√£o, na fun√ß√£o OnCalculate() a cor √© definida aleatoriamente a partir de
uma lista preparada anteriormente.
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                                    DRAW_BARS.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_BARS&quot;
#property description &quot;Ele desenha barras de uma sele√ß√£o de s√≠mbolos numa janela separ
#property description &quot;A cor e a largura das barras, bem como o s√≠mbolo s√£o alterados 
#property description &quot;cada N ticks&quot;
#property indicator_separate_window
#property indicator_buffers 4
#property indicator_plots   1
//--- plotar Barras
#property indicator_label1  &quot;Barras&quot;
#property indicator_type1   DRAW_BARS
#property indicator_color1  clrGreen
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;              // O n√∫mero de ticks para alterar o tipo
input int      bars=500;         // O n√∫mero de barras para mostrar
input bool     messages=false;   // Mostrar mensagens no log &quot;Expert Advisors&quot;
//--- buffers do Indicador
double         BarsBuffer1[];
double         BarsBuffer2[];
double         BarsBuffer3[];
double         BarsBuffer4[];
//--- Nome do s√≠mbolo
string symbol;
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen,clrPurple,clrBrown,clrIndianRed};
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- Se as barras s√£o muito pequenas - concluir o trabalho antes do tempo
   if(bars&lt;50)
     {
      Comment(&quot;Por favor, especifique um n√∫mero maior de barras! A opera√ß√£o do indicad</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2644
</p>
<pre><code class="language-mql5">
      return(INIT_PARAMETERS_INCORRECT);
     }
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,BarsBuffer1,INDICATOR_DATA);
   SetIndexBuffer(1,BarsBuffer2,INDICATOR_DATA);
   SetIndexBuffer(2,BarsBuffer3,INDICATOR_DATA);
   SetIndexBuffer(3,BarsBuffer4,INDICATOR_DATA);
//--- O nome do s√≠mbolo, para o qual as barras s√£o desenhadas
   symbol=_Symbol;
//--- Definir a exibi√ß√£o do s√≠mbolo
   PlotIndexSetString(0,PLOT_LABEL,symbol+&quot; Open;&quot;+symbol+&quot; High;&quot;+symbol+&quot; Low;&quot;+symb
   IndicatorSetString(INDICATOR_SHORTNAME,&quot;DRAW_BARS(&quot;+symbol+&quot;)&quot;);
//--- Um valor vazio
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0.0);
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero suficiente de ticks foi acumulado
   if(ticks&gt;=N)
     {
      //--- Selecione um novo s√≠mbolo a partir da janela de observa√ß√£o do Mercado
      symbol=GetRandomSymbolName();
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      int tries=0;
      //--- Fa√ßa 5 tentativas de preencher os buffers com os pre√ßos a partir s√≠mbolo
      while(!CopyFromSymbolToBuffers(symbol,rates_total) &amp;&amp; tries&lt;5)
        {
         //--- Um contador de chamadas da fun√ß√£o CopyFromSymbolToBuffers()
         tries++;
        }</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2645
</p>
<pre><code class="language-mql5">
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Preencher os buffers do indicador com pre√ßos¬†                    |
//+------------------------------------------------------------------+
bool CopyFromSymbolToBuffers(string name,int total)
  {
//--- No array de rates[], vamos copiar Open (abertura), High (alta), Low (baixa) e Cl
   MqlRates rates[];
//--- O contador de tentativas
   int attempts=0;
//--- Quanto foi copiado
   int copied=0;
//--- Fazer 25 tentativas para obter uma s√©rie temporal(timeseries) sobre o s√≠mbolo de
   while(attempts&lt;25 &amp;&amp; (copied=CopyRates(name,_Period,0,bars,rates))&lt;0)
     {
      Sleep(100);
      attempts++;
      if(messages) PrintFormat(&quot;%s Copiar taxas(%s) tentativas=%d&quot;,__FUNCTION__,nome,t
     }
//--- Se falhou em copiar um n√∫mero suficiente de barras
   if(copied!=bars)
     {
      //--- Formar uma mensagem string
      string comm=StringFormat(&quot;Para o s√≠mbolo %s, conseguiu receber somente %d barras
                               name,
                               copied,
                               bars
                               );
      //--- Mostrar uma mensagem num coment√°rio na janela do gr√°fico principal
      Comment(comm);
      //--- Mostrar a mensagem
      if(messages) Print(comm);
      return(false);
     }
   else
     {
      //--- Definir a exibi√ß√£o do s√≠mbolo
      PlotIndexSetString(0,PLOT_LABEL,name+&quot; Open;&quot;+name+&quot; High;&quot;+name+&quot; Low;&quot;+name+&quot; 
      IndicatorSetString(INDICATOR_SHORTNAME,&quot;DRAW_BARS(&quot;+name+&quot;)&quot;);
     }
//--- Inicializar buffers com valores vazios
   ArrayInitialize(BarsBuffer1,0.0);   
   ArrayInitialize(BarsBuffer2,0.0);   
   ArrayInitialize(BarsBuffer3,0.0);   </p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2646
</p>
<pre><code class="language-mql5">
   ArrayInitialize(BarsBuffer4,0.0);   
//--- Copiar os pre√ßos para os buffers
   for(int i=0;i&lt;copied;i++)
     {
      //--- Calcular o √≠ndice apropriado para os buffers
      int buffer_index=total-copied+i;
      //--- Escreva os pre√ßos para os buffers
      BarsBuffer1[buffer_index]=rates[i].open;
      BarsBuffer2[buffer_index]=rates[i].high;
      BarsBuffer3[buffer_index]=rates[i].low;
      BarsBuffer4[buffer_index]=rates[i].close;
     }
   return(true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Aleatoriamente retorna um s√≠mbolo de Observa√ß√£o do Mercado¬†  |
//+------------------------------------------------------------------+
string GetRandomSymbolName()
  {
//--- O n√∫mero de s√≠mbolos mostrada na janela de observa√ß√£o do Mercado
   int symbols=SymbolsTotal(true);
//--- A posi√ß√£o de um s√≠mbolo na lista - um n√∫mero aleat√≥rio de 0 para s√≠mbolos
   int number=MathRand()%symbols;
//--- Retornar o nome de um s√≠mbolo na posi√ß√£o especificada
   return SymbolName(number,true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia das barras¬†                                       |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades da barra
   string comm=&quot;&quot;;
//--- Um bloco para alterar a cor das barras
   int number=MathRand(); // Obter um n√∫mero aleat√≥rio
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,colors[color_index]);
//--- Escrever a cor da linha
   comm=comm+&quot;\r\n&quot;+(string)colors[color_index];
//--- Um bloco para alterar a largura das barras
   number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5;   // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2647
</p>
<pre><code class="language-mql5">
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot;\r\nWidth=&quot;+IntegerToString(width);
//--- Escreve o nome do s√≠mbolo
   comm=&quot;\r\n&quot;+symbol+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2648
<h3>DRAW_CANDLES</h3>
O estilo DRAW_CANDLES desenha candlesticks sobre os valores dos quatro buffers do indicador, que
cont√™m Open (abertura), High (alta), Low (baixa) e Close (fechamento) de pre√ßos. √â usado para a
cria√ß√£o de indicadores personalizados como uma seq√º√™ncia de candlesticks, incluindo os inseridos
numa sub-janela separada de um gr√°fico e noutros instrumentos financeiros.
A cor dos candlesticks pode ser definida usando as diretivas de compilador ou dinamicamente usando
a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de plotagem permitem &quot;avivar&quot;
os indicadores, de modo que suas mudan√ßas de apar√™ncia dependem da situa√ß√£o corrente.
O indicador √© desenhado apenas para as barras, para o qual os valores n√£o vazios de todos quatro
buffers do indicador s√£o definidos. Para especificar o valor que deve ser considerado como &quot;vazio&quot;,
defina este valor na propriedade PLOT_EMPTY_VALUE:
</p>
<pre><code class="language-mql5">
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(index_of_plot_DRAW_CANDLES,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Sempre preencher explicitamente os valores dos buffers do indicador, definir um valor vazio num
buffer para ignorar barras.
O n√∫mero de buffers necess√°rios para plotagem de DRAW_CANDLES √© 4. Todos os buffers para a
plotagem devem ir um ap√≥s o outro na ordem dada: Open (abertura do pre√ßo), High (alta do pre√ßo),
Low (baixa do pre√ßo) e Close (fechamento do pre√ßo). Nenhum dos buffers podem conter apenas
valores vazios, uma vez que, neste caso, nada √© plotado.
Para o estilo DRAW_CANDLES, √© poss√≠vel definir de uma a tr√™s cores, dependendo de isso √© alterada a
apar√™ncia das velas. Se for definida apenas uma cor, todas as velas no gr√°fico ser√£o pintadas
completamente com essa cor.
</p>
<pre><code class="language-mql5">
//--- velas semelhantes pintadas numa cor
#property indicator_label1  &quot;One color candles&quot;
#property indicator_type1   DRAW_CANDLES
//--- como √© indicada apenas uma cor, todas as velas ter√£o uma cor
#property indicator_color1  clrGreen  
</code></pre>
<p>
Si n√≥s especificarmos duas cores separadas por uma v√≠rgula, os contornos das velas ser√£o desenhados
com a primeira cor e o corpo com a segunda.
</p>
<pre><code class="language-mql5">
//--- a cor das velas √© diferente da cor das sombras
#property indicator_label1  &quot;Two color candles&quot;
#property indicator_type1   DRAW_CANDLES
//--- sombras e contornos das velas de cor verde e corpo branco
#property indicator_color1  clrGreen,clrWhite 
</code></pre>
<p>
Para exibir de maneira diferente as velas crescentes e decrescentes, √© indispens√°vel definir,
separando por v√≠rgulas, tr√™s cores. Neste caso, o contorno da vela ser√° tra√ßado usando a primeira cor,
enquanto a cor da velas de alta e baixa ser√£o definidas pela segunda e terceira cor.
</p>
<pre><code class="language-mql5">
//--- a cor das velas √© diferente da cor das sombras
#property indicator_label1  &quot;One color candles&quot;
#property indicator_type1   DRAW_CANDLES
//--- sombras e contorno de cor verde, corpo da vela de alta de cor branca, corpo da v</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2649
</p>
<pre><code class="language-mql5">
#property indicator_color1  clrGreen,clrWhite,clrRed
</code></pre>
<p>
Assim, usando o estilo DRAW_CANDLES, √© poss√≠vel criar variantes personalizadas das velas. Tamb√©m
√© poss√≠vel alterar dinamicamente todas as cores -no processo de trabalho do indicador- mediante a
fun√ß√£o 
<h3>PlotIndexSetInteger(√≠ndice_de_constru√ß√£o_DRAW_CANDLES,</h3>
<h3>PLOT_LINE_COLOR,</h3>
n√∫mero_de_modificador, cor), aqui o n√∫mero_de_modificador pode ter os seguintes valores:
¬∑ 0 ‚Äì cor do contorno e sombras
¬∑ 1‚Äì cor do corpo da vela de alta
¬∑ 2 ‚Äì cor do corpo da vela de baixa 
</p>
<pre><code class="language-mql5">
//--- definimos a cor do contorno e sombras
</code></pre>
<p>
<h3>PlotIndexSetInteger(0,PLOT_LINE_COLOR,0,clrBlue);</h3>
</p>
<pre><code class="language-mql5">
//--- definimos a cor do corpo para velas de alta
</code></pre>
<p>
<h3>PlotIndexSetInteger(0,PLOT_LINE_COLOR,1,clrGreen);</h3>
</p>
<pre><code class="language-mql5">
//--- definimos a cor do corpo para velas de baixa
</code></pre>
<p>
<h3>PlotIndexSetInteger(0,PLOT_LINE_COLOR,2,clrRed);</h3>
Um exemplo de indicador que desenha candlesticks para um instrumento financeiro selecionado em
uma janela separada. A cor dos candlesticks muda aleatoriamente a cada N ticks. O par√¢metro N √©
definido nos par√¢metro externos do indicador para a possibilidade de configura√ß√£o manual (na guia
Par√¢metros na janela Propriedades do indicador).
Por favor, note que para plot1, a cor √© definida usando a diretiva de compilador #property, e ent√£o,
na fun√ß√£o OnCalculate() a cor √© definida aleatoriamente a partir de uma lista preparada
anteriormente. 
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                                 DRAW_CANDLES.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2650
</p>
<pre><code class="language-mql5">
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_CANDLES.&quot;
#property description &quot;ele desenha candlesticks de um s√≠mbolo selecionado numa janela 
#property description &quot; &quot;
#property description &quot;A cor e a largura dos candlesticks, bem como o s√≠mbolo s√£o alte
#property description &quot;aleatoriamente a cada N ticks&quot;
#property indicator_separate_window
#property indicator_buffers 4
#property indicator_plots   1
//--- plotar Barras
#property indicator_label1  &quot;DRAW_CANDLES1&quot;
#property indicator_type1   DRAW_CANDLES
#property indicator_color1  clrGreen
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;              // O n√∫mero de ticks para alterar o tipo
input int      bars=500;         // O n√∫mero de barras para mostrar
input bool     messages=false;   // Mostrar mensagens no log &quot;Expert Advisors&quot; 
//--- buffers do Indicador
double         Candle1Buffer1[];
double         Candle1Buffer2[];
double         Candle1Buffer3[];
double         Candle1Buffer4[];
//--- Nome do s√≠mbolo
string symbol;
//--- Um array para armazenar as cores
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen,clrPurple,clrBrown,clrIndianRed};
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- Se as barras s√£o muito pequenas - concluir o trabalho antes do tempo
   if(bars&lt;50)
     {
      Comment(&quot;Por favor, especifique um n√∫mero maior de barras! A opera√ß√£o do indicad
      return(INIT_PARAMETERS_INCORRECT);
     }
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,Candle1Buffer1,INDICATOR_DATA);
   SetIndexBuffer(1,Candle1Buffer2,INDICATOR_DATA);
   SetIndexBuffer(2,Candle1Buffer3,INDICATOR_DATA);
   SetIndexBuffer(3,Candle1Buffer4,INDICATOR_DATA);</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2651
</p>
<pre><code class="language-mql5">
//--- Um valor vazio
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);
//--- O nome do s√≠mbolo, para o qual as barras s√£o desenhadas
   symbol=_Symbol;
//--- Definir a exibi√ß√£o do s√≠mbolo
   PlotIndexSetString(0,PLOT_LABEL,symbol+&quot; Open;&quot;+symbol+&quot; High;&quot;+symbol+&quot; Low;&quot;+symb
   IndicatorSetString(INDICATOR_SHORTNAME,&quot;DRAW_CANDLES(&quot;+symbol+&quot;)&quot;);
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=INT_MAX-100;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero suficiente de ticks foi acumulado
   if(ticks&gt;=N)
     {
      //--- Selecione um novo s√≠mbolo a partir da janela de observa√ß√£o do Mercado
      symbol=GetRandomSymbolName();
      //--- Alterar a forma
      ChangeLineAppearance();
      //--- Selecione um novo s√≠mbolo a partir da janela de observa√ß√£o do Mercado
      int tries=0;
      //--- Fa√ßa 5 tentativas de preencher os buffers de Plot1 com os pre√ßos a partir 
      while(!CopyFromSymbolToBuffers(symbol,rates_total,0,
            Candle1Buffer1,Candle1Buffer2,Candle1Buffer3,Candle1Buffer4)
            &amp;&amp; tries&lt;5)
        {
         //--- Um contador de chamadas da fun√ß√£o CopyFromSymbolToBuffers()
         tries++;
        }
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2652
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Preenche o candlestick especificado¬†                             |
//+------------------------------------------------------------------+
bool CopyFromSymbolToBuffers(string name,
                             int total,
                             int plot_index,
                             double &amp;buff1[],
                             double &amp;buff2[],
                             double &amp;buff3[],
                             double &amp;buff4[]
                             )
  {
//--- No array de rates[], vamos copiar Open (abertura), High (alta), Low (baixa) e Cl
   MqlRates rates[];
//--- O contador de tentativas
   int attempts=0;
//--- Quanto foi copiado
   int copied=0;
//--- Fazer 25 tentativas para obter uma s√©rie temporal(timeseries) sobre o s√≠mbolo de
   while(attempts&lt;25 &amp;&amp; (copied=CopyRates(name,_Period,0,bars,rates))&lt;0)
     {
      Sleep(100);
      attempts++;
      if(messages) PrintFormat(&quot;%s Copiar taxas(%s) tentativas=%d&quot;,__FUNCTION__,nome,t
     }
//--- Se falhou em copiar um n√∫mero suficiente de barras
   if(copied!=bars)
     {
      //--- Formar uma mensagem string
      string comm=StringFormat(&quot;Para o s√≠mbolo %s, conseguiu receber somente %d barras
                               name,
                               copied,
                               bars
                               );
      //--- Mostrar uma mensagem num coment√°rio na janela do gr√°fico principal
      Comment(comm);
      //--- Mostrar a mensagem
      if(messages) Print(comm);
      return(false);
     }
   else
     {
      //--- Definir a exibi√ß√£o do s√≠mbolo
      PlotIndexSetString(plot_index,PLOT_LABEL,name+&quot; Open;&quot;+name+&quot; High;&quot;+name+&quot; Low;
     }
//--- Inicializar buffers com valores vazios
   ArrayInitialize(buff1,0.0);
   ArrayInitialize(buff2,0.0);</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2653
</p>
<pre><code class="language-mql5">
   ArrayInitialize(buff3,0.0);
   ArrayInitialize(buff4,0.0);
//--- Sobre cada tick √© copiado pre√ßos para os buffers
   for(int i=0;i&lt;copied;i++)
     {
      //--- Calcular o √≠ndice apropriado para os buffers
      int buffer_index=total-copied+i;
      //--- Escreva os pre√ßos para os buffers
      buff1[buffer_index]=rates[i].open;
      buff2[buffer_index]=rates[i].high;
      buff3[buffer_index]=rates[i].low;
      buff4[buffer_index]=rates[i].close;
     }
   return(true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Aleatoriamente retorna um s√≠mbolo de Observa√ß√£o do Mercado¬†  |
//+------------------------------------------------------------------+
string GetRandomSymbolName()
  {
//--- O n√∫mero de s√≠mbolos mostrada na janela de observa√ß√£o do Mercado
   int symbols=SymbolsTotal(true);
//--- A posi√ß√£o de um s√≠mbolo na lista - um n√∫mero aleat√≥rio de 0 para s√≠mbolos
   int number=MathRand()%symbols;
//--- Retornar o nome de um s√≠mbolo na posi√ß√£o especificada
   return SymbolName(number,true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia das barras¬†                                       |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades da barra
   string comm=&quot;&quot;;
//--- Um bloco para alterar a cor das barras
   int number=MathRand(); // Obter um n√∫mero aleat√≥rio
//--- O divisor √© igual ao tamanho do array colors[]
   int size=ArraySize(colors);
//--- Obter o √≠ndice para selecionar uma nova cor como o restante da divis√£o inteira
   int color_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_COLOR,colors[color_index]);
//--- Escrever a cor
   comm=comm+&quot;\r\n&quot;+(string)colors[color_index];
//--- Escreve o nome do s√≠mbolo
   comm=&quot;\r\n&quot;+symbol+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2654</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2655
<h3>DRAW_COLOR_LINE</h3>
O valor DRAW_COLOR_LINE √© uma variante colorida do estilo DRAW_LINE; ele tamb√©m desenha uma
linha usando os valores do buffer do indicador. Mas esse estilo, como todos os estilos de cores com a
palavra COLOR em seu t√≠tulo tem um buffer indicador adicional e especial que armazena o √≠ndice de
cores (n√∫mero) a partir de um conjunto especial array de cores. Assim, a cor de cada segmento de
linha pode ser definida atrav√©s da especifica√ß√£o do √≠ndice de cores para desenhar a linha naquela
barra.
A largura, o estilo e as cores das linhas podem ser definidas usando as diretivas de compilador e
dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de
plotagem permitem &quot;avivar&quot; os indicadores, de modo que suas mudan√ßas de apar√™ncia dependem da
situa√ß√£o corrente.
O n√∫mero de buffers requerido para plotagem de DRAW_COLOR_LINE √© 2.
¬∑ um buffer para armazenar os valores do indicador utilizado para desenhar uma linha;
¬∑ um buffer para armazenar o √≠ndice de cores da linha em cada barra.
Cores ser√£o especificadas pela diretiva de compilador #property indicator_color1 separada por uma
v√≠rgula. O n√∫mero de cores n√£o pode exceder a 64.
</p>
<pre><code class="language-mql5">
//--- Define 5 cores para colorir cada barra (elas s√£o armazenadas no array especial)
#property indicator_color1  clrRed,clrBlue,clrGreen,clrOrange,clrDeepPink // (Podem se
</code></pre>
<p>
Um exemplo do indicador que desenha a linha usando o fechamento de pre√ßo das barras. A largura da
linha e estilo s√£o alterados aleatoriamente a cada N=5 ticks.
As cores dos segmentos de linhas tamb√©m s√£o alteradas aleatoriamente na fun√ß√£o personalizada
ChangeColors().
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2656
</p>
<pre><code class="language-mql5">
//| Altera a cor dos segmentos de linha¬†                             |
//+------------------------------------------------------------------+
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)
     {
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores
      comm=comm+StringFormat(&quot;LineColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToString
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
O exemplo mostra a caracter√≠stica das vers√µes &quot;cor&quot; de indicadores - para mudar a cor de um
segmento de linha, voc√™ n√£o precisa alterar os valores no buffer ColorLineColors[] (que cont√©m os
√≠ndices de cores). Tudo que voc√™ precisa fazer √© definir novas cores em um array especial. Isto
permite-lhe alterar rapidamente a cor de uma vez para toda a plotagem, mudando apenas um pequeno
array de cores utilizando a fun√ß√£o PlotIndexSetInteger().
Note que para inicializar plot1 com DRAW_COLOR_LINE as propriedades s√£o definidas usando a
diretiva de compilador #property, e ent√£o na fun√ß√£o OnCalculate() existem tr√™s propriedades que s√£o
definidas aleatoriamente. 
O N e Length (o comprimento dos segmentos de corres nas barras) dos par√¢metros s√£o definidos nos
par√¢metros externos do indicador para a possibilidade de configura√ß√£o manual (a guia Par√¢metros na
janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                              DRAW_COLOR_LINE.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2657
</p>
<pre><code class="language-mql5">
#property description &quot;Um indicador para demonstrar RAW_COLOR_LINE&quot;
#property description &quot;Ele desenha uma linha no Fechamento do pre√ßo em partes colorida
#property description &quot;A largura, estilo e cor de partes da linha s√£o alteradas aleato
#property description &quot;cada N ticks&quot;
#property indicator_chart_window
#property indicator_buffers 2
#property indicator_plots   1
//--- plotar ColorLine
#property indicator_label1  &quot;ColorLine&quot;
#property indicator_type1   DRAW_COLOR_LINE
//--- Define 5 cores para colorir cada barra (elas s√£o armazenadas no array especial)
#property indicator_color1  clrRed,clrBlue,clrGreen,clrOrange,clrDeepPink // (Podem se
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;           //N√∫mero de ticks para alterar 
input int      Length=20;     // A largura de cada parte de cor nas barras
int            line_colors=5; // O n√∫mero para definir as cores √© 5 - ver #property in
//--- Um buffer para plotagem
double         ColorLineBuffer[];
//--- Um buffer para armazenar a cor da linha sobre cada barra
double         ColorLineColors[];
//--- O array para armazenar cores contendo 7 elementos
</code></pre>
<p>
color colors[]={clrRed,clrBlue,clrGreen,clrChocolate,clrMagenta,clrDodgerBlue,clrGolde
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- Ligando um array e um buffer de indicador
   SetIndexBuffer(0,ColorLineBuffer,INDICATOR_DATA);
   SetIndexBuffer(1,ColorLineColors,INDICATOR_COLOR_INDEX);
//--- Inicializando o gerador de n√∫meros pseudo-aleat√≥rios
   MathSrand(GetTickCount());
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2658
</p>
<pre><code class="language-mql5">
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Alterar as cores de se√ß√µes de linhas
      ChangeColors(colors,5);
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- Bloco para c√°lculo dos valores do indicador
   for(int i=0;i&lt;rates_total;i++)
     {
      //--- Escrever o valor do indicador para o buffer
      ColorLineBuffer[i]=close[i];
      //--- Agora, aleatoriamente definir um √≠ndice de cores para esta barra
      int color_index=i%(5*Length);
      color_index=color_index/Length;
      //--- Para esta barra, a linha ter√° a cor com o √≠ndice color_index
      ColorLineColors[i]=color_index;
     }
//--- Retorna o valor de prev_calculated para a pr√≥xima chamada da fun√ß√£o
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a cor dos segmentos de linha¬†                             |
//+------------------------------------------------------------------+
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)
     {</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2659
</p>
<pre><code class="language-mql5">
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores
      comm=comm+StringFormat(&quot;LineColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToString
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia de uma linha visualizada no indicador¬†        |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco para alterar a largura da linha
   int number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5; // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot; Width=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   int size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=EnumToString(styles[style_index])+&quot;, &quot;+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2660
<h3>DRAW_COLOR_SECTION</h3>
O estilo DRAW_COLOR_SECTION √© uma vers√£o de cor de DRAW_SECTION, mas ao contr√°rio deste
√∫ltimo, permite se√ß√µes de desenho de cores diferentes. O estilo DRAW_COLOR_SECTION, como todos
os estilos de cor com a palavra COLOR em seu t√≠tulo tem um buffer de indicador adicional e especial
que armazena o √≠ndice de cores (n√∫mero) a partir de um conjunto especial array de cores. Assim, a cor
de cada uma das se√ß√µes pode ser definido atrav√©s da especifica√ß√£o do √≠ndice de cores do √≠ndice da
barra que corresponde a se√ß√£o final.
A largura, cor e estilo das se√ß√µes podem ser especificados como para o estilo DRAW_SECTION - usando
as as diretivas do compilador ou dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas
din√¢micas das propriedades de plotagem permitem &quot;avivar&quot; os indicadores, de modo que suas
apar√™ncias sejam alteradas dependendo da situa√ß√£o corrente.
Se√ß√µes s√£o desenhadas a partir de um valor n√£o vazio para outro valor n√£o vazio do buffer de
indicador, valores vazios s√£o ignorados. Para especificar qual o valor que deve ser considerado como
&quot;vazio&quot;, defina esse valor na propriedade PLOT_EMPTY_VALUE: Por exemplo, se o indicador deve ser
desenhado como uma seq√º√™ncia de se√ß√µes sobre valores diferentes de zero, ent√£o voc√™ precisa definir
o valor zero como um vazio:
</p>
<pre><code class="language-mql5">
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(index_of_plot_DRAW_COLOR_SECTION,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Sempre preencha explicitamente nos valores dos buffers do indicador, defina um valor vazio num
buffer para os elementos que n√£o devem ser plotados.
O n√∫mero de buffers requirido para plotagem de DRAW_COLOR_SECTION √© 2.
¬∑ um buffer para armazenar os valores do indicador utilizado para desenhar uma linha;
¬∑ um buffer para armazenar o √≠ndice de cor, que √© usada para desenhar a se√ß√£o (faz sentido definir
apenas valores n√£o vazios).
Cores ser√£o especificadas pela diretiva de compilador #property indicator_color1 separada por uma
v√≠rgula. O n√∫mero de cores n√£o pode exceder a 64.
Um exemplo do indicador que desenha se√ß√µes coloridas a cada 5 barras longas, usando os valores da
alta do pre√ßo. A cor, a largura e o estilo das se√ß√µes alteram aleatoriamente a cada N ticks. </p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2661
Note que para inicializar plot1 com DRAW_COLOR_SECTION, 8 cores s√£o definidas usando a diretiva
de compilador #property. Ent√£o na fun√ß√£o OnCalculate(), cores s√£o definidas aleatoriamente a partir
do array de cores colors[].
 O par√¢metro N √© defindo nos par√¢metros externos do indicador para a possibilidade de configura√ß√£o
manual (na guia Par√¢metros na janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                           DRAW_COLOR_SECTION.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_COLOR_SECTION&quot;
#property description &quot;Ele desenha sec√ß√µes coloridas com o comprimento igual ao n√∫mero
#property description &quot;A cor, a largura eo estilo de se√ß√µes s√£o alteradas aleatoriamen
#property description &quot;depois de cada N ticks&quot;
#property indicator_chart_window
#property indicator_buffers 2
#property indicator_plots   1
//--- plotar ColorSection
#property indicator_label1  &quot;ColorSection&quot;
#property indicator_type1   DRAW_COLOR_SECTION
//--- Definir 8 cores para colorir se√ß√µes (eles s√£o armazenados numa array especial)
#property indicator_color1  clrRed,clrGold,clrMediumBlue,clrLime,clrMagenta,clrBrown,c
#property indicator_style1  STYLE_SOLID</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2662
</p>
<pre><code class="language-mql5">
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;                      // N√∫mero de ticks para alterar 
input int      bars_in_section=5;        // O comprimento das se√ß√µes nas barras
//--- Uma vari√°vel auxiliar para calcular extremidades das se√ß√µes
int            divider;
int            color_sections;
//--- Um buffer para plotagem
double         ColorSectionBuffer[];
//--- Um buffer para armazenar a cor da linha sobre cada barra
double         ColorSectionColors[];
//--- Um array para armazenar as cores que cont√©m 14 elementos
</code></pre>
<p>
color colors[]=
</p>
<pre><code class="language-mql5">
  {
   clrRed,clrBlue,clrGreen,clrChocolate,clrMagenta,clrDodgerBlue,clrGoldenrod,
   clrIndigo,clrLightBlue,clrAliceBlue,clrMoccasin,clrWhiteSmoke,clrCyan,clrMediumPurp
</code></pre>
<p>
  };
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,ColorSectionBuffer,INDICATOR_DATA);
   SetIndexBuffer(1,ColorSectionColors,INDICATOR_COLOR_INDEX);
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);
//---- O n√∫mero de cores para colorir as sec√ß√µes
   int color_sections=8;   //  veja um coment√°rio para #property indicator_color1
//--- Verifica o par√¢metro do indicador
   if(bars_in_section&lt;=0)
     {
      PrintFormat(&quot;Comprimento se√ß√£o inv√°lido=%d&quot;,bars_in_section);
      return(INIT_PARAMETERS_INCORRECT);
     }
   else divider=color_sections*bars_in_section;
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2663
</p>
<pre><code class="language-mql5">
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Alterar cores utilizadas para plotar as se√ß√µes
      ChangeColors(colors,color_sections);
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- O n√∫mero de barra a partir da qual o c√°lculo dos valores do indicador inicia
   int start=0;
//--- Se o indicador foi calculado antes, ent√£o definir o in√≠cio na barra anterior
   if(prev_calculated&gt;0) start=prev_calculated-1;
//--- Aqui est√£o todos os c√°lculos dos valores do indicador
   for(int i=start;i&lt;rates_total;i++)
     {
      //--- Se o n√∫mero de barras √© divis√≠vel pela section_length, isso significa que 
      if(i%bars_in_section==0)
        {
         //--- Definir o final da se√ß√£o na alta de pre√ßo desta barra
         ColorSectionBuffer[i]=high[i];
         //--- O resto da divis√£o do n√∫mero de barra pela scetion_length*number_of_col
         int rest=i%divider;
         //Obter o n√∫mero da cor =  a partir de 0 para number_of_colors-1
         int color_indext=rest/bars_in_section;
         ColorSectionColors[i]=color_indext;
        }
      //---Se o resto da divis√£o √© igual para barras, 
      else
        {
         //--- Se nada aconteceu, ignore a barra - definir 0
         else ColorSectionBuffer[i]=0;
        }
     }
//--- Retorna o valor de prev_calculated para a pr√≥xima chamada da fun√ß√£o
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2664
</p>
<pre><code class="language-mql5">
//| Altera a cor dos segmentos de linha¬†                             |
//+------------------------------------------------------------------+
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)
     {
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores
      comm=comm+StringFormat(&quot;SectionColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToStr
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia de uma linha visualizada no indicador¬†        |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco para alterar a largura da linha
   int number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5; // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot; Width=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   int size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2665
</p>
<pre><code class="language-mql5">
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=EnumToString(styles[style_index])+&quot;, &quot;+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2666
<h3>DRAW_COLOR_HISTOGRAM</h3>
O estilo DRAW_COLOR_HISTOGRAM desenha um histograma como uma seq√º√™ncia de colunas coloridas
a partir de zero pra um valor espec√≠fico. Os valores s√£o extra√≠dos do buffer do indicador. Cada coluna
pode ter a sua pr√≥pria cor a partir de um conjunto pr√©-definido de cores.
A largura, cor e estilo do histograma podem ser especificados como para o estilo DRAW_HISTOGRAM -
usando as diretivas de compilador ou dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas
din√¢micas das propriedades de plotagem permitem alterar o visual do histograma com base na
situa√ß√£o atual.
<h3>Uma</h3>
vez 
que 
uma 
coluna 
a 
partir 
do 
n√≠vel 
zero 
√© 
desenhado 
em 
cada 
barra,
DRAW_COLOR_HISTOGRAM ser√° melhor utilizado numa janela de gr√°fico em separado. Na maioria das
vezes este tipo de plotagem √© usada para criar indicadores do tipo osciladores, por exemplo, Awesome
Oscillator ou Market Facilitation Index. Para os valores vazios que n√£o s√£o vis√≠veis, o valor zero deve
ser especificado.
O n√∫mero de buffers necess√°rios para plotagem DRAW_COLOR_HISTOGRAM √© 2.
¬∑ um buffer para armazenar um valor que n√£o seja zero do segmento vertical em cada barra, a
segunda extremidade do segmento estar√° sempre na linha zero do indicador;
¬∑ um buffer para armazenar o √≠ndice de cor, que √© usada para desenhar a se√ß√£o (faz sentido definir
apenas valores n√£o vazios).
Cores podem ser determinadas usando a diretiva de compilador #property indicator_color1 separadas
por uma v√≠rgula. O n√∫mero de cores n√£o pode exceder a 64.
Um exemplo do indicador que desenha uma sen√≥ide de uma cor espec√≠fica com base na fun√ß√£o
MathSin(). A cor, a largura e o estilo de todas colunas do histograma mudam aleatoriamente a cada N
ticks. O par√¢metro de barras determina o per√≠odo da sen√≥ide, isto √©, ap√≥s um n√∫mero especifico de
barras a sen√≥ide vai repetir o ciclo.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2667
Por favor note que para plot1 com o estilo DRAW_COLOR_HISTOGRAM, 5 cores s√£o definidas usando a
diretiva de compilador #property, e ent√£o na fun√ß√£o OnCalculate(), as cores s√£o selecionadas
aleatoriamente a partir de quatorze cores armazenada no array de colors[]. O par√¢metro N √© definido
nos par√¢metros externos do indicador para a possibilidade de configura√ß√£o manual (o guia Par√¢metros
na janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                         DRAW_COLOR_HISTOGRAM.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_COLOR_HISTOGRAM&quot;
#property description &quot;Ele desenha um sen√≥ide como um histograma em uma janela separad
#property description &quot;A cor e a largura das colunas s√£o alterados aleatoriamente&quot;
#property description &quot;depois de cada N ticks&quot;
#property description &quot;O par√¢metro de barras define o n√∫mero de barras para repetir a 
#property indicator_separate_window
#property indicator_buffers 2
#property indicator_plots   1
//--- par√¢metros de entrada
input int      bars=30;          // O per√≠odo de uma sen√≥ide em barras
input int      N=5;              // O n√∫mero de ticks para alterar o histograma
//--- plotar Color_Histogram
#property indicator_label1  &quot;Color_Histogram&quot;
#property indicator_type1   DRAW_COLOR_HISTOGRAM
//--- Definir 8 cores para colorir se√ß√µes (eles s√£o armazenados numa array especial)
#property indicator_color1  clrRed,clrGreen,clrBlue,clrYellow,clrMagenta,clrCyan,clrMe
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- Um buffer de valores
double         Color_HistogramBuffer[];
//--- Um buffer de √≠ndices de cor
double         Color_HistogramColors[];
//--- Um fator para obter o √¢ngulo 2Pi em radianos, quando multiplicado pelo par√¢metro
double         multiplier;
int            color_sections;
//--- Um array para armazenar as cores que cont√©m 14 elementos
</code></pre>
<p>
color colors[]=
</p>
<pre><code class="language-mql5">
  {
   clrRed,clrBlue,clrGreen,clrChocolate,clrMagenta,clrDodgerBlue,clrGoldenrod,
   clrIndigo,clrLightBlue,clrAliceBlue,clrMoccasin,clrWhiteSmoke,clrCyan,clrMediumPurp
</code></pre>
<p>
  };
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2668
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,Color_HistogramBuffer,INDICATOR_DATA);
   SetIndexBuffer(1,Color_HistogramColors,INDICATOR_COLOR_INDEX);
//---- O n√∫mero de cores para a colorir a sen√≥ide
   color_sections=8;   //  Veja coment√°rio para #property indicator_color1
//--- Calcular a multiplica√ß√£o
   if(bars&gt;1)multiplier=2.*M_PI/bars;
   else
     {
      PrintFormat(&quot;Defina o valor das barras=%d maior do que 1&quot;,bars);
      //--- Finaliza√ß√£o antecipada do indicador
      return(INIT_PARAMETERS_INCORRECT);
     }   
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Alterar cores usadas para o histograma
      ChangeColors(colors,color_sections);      
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2669
</p>
<pre><code class="language-mql5">
//--- Calcule os valores do indicador
   int start=0;
//--- Se j√° foi calculado durante os in√≠cios anteriores do OnCalculate
   if(prev_calculated&gt;0) start=prev_calculated-1; // definir o in√≠cio do c√°lculo com a
//--- Preencher o buffer do indicador com valores
   for(int i=start;i&lt;rates_total;i++)
     {
      //--- Um valor
      Color_HistogramBuffer[i]=sin(i*multiplier);
      //--- Cor
      int color_index=i%(bars*color_sections);
      color_index/=bars;
      Color_HistogramColors[i]=color_index;
     }
//--- Retorna o valor de prev_calculated para a pr√≥xima chamada da fun√ß√£o
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a cor dos segmentos de linha¬†                             |
//+------------------------------------------------------------------+
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)
     {
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores
      comm=comm+StringFormat(&quot;HistogramColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToS
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia de uma linha visualizada no indicador¬†        |
//+------------------------------------------------------------------+
void ChangeLineAppearance()</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2670
</p>
<pre><code class="language-mql5">
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco para alterar a largura da linha
   int number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5; // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot; Width=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   int size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=EnumToString(styles[style_index])+&quot;, &quot;+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2671
<h3>DRAW_COLOR_HISTOGRAM2</h3>
O estilo DRAW_COLOR_HISTOGRAM2 desenha uma histograma de uma cor espec√≠fica ‚Äì segmentos
verticais usando os valores de buffers do indicador. Mas diferentemente ao de uma cor
DRAW_HISTOGRAM2, este estilo pode ter a sua pr√≥pria cor a partir de um conjunto pr√©-definido em
cada coluna do histograma. Os valores de todos os segmentos s√£o retirados do buffer do indicador.
A largura, o estilo e a cor do histograma pode ser especificado como para o estilo DRAW_HISTOGRAM2
‚Äì usando as diretivas de compilador ou usando dinamicamente a fun√ß√£o PlotIndexSetInteger().
Mudan√ßas din√¢micas das propriedades de plotagem permitem alterar o visual do histograma com base
na situa√ß√£o atual.
O estilo DRAW_COLOR_HISTOGRAM2 pode ser usado em uma sub-janela separada de um gr√°fico e em
sua janela principal. Para valores vazios nada √© desenhado, todos os valores nos buffers do indicador
precisam ser definidos explicitamente. Buffers n√£o s√£o inicializados com valores vazios.
O n√∫mero de buffers necess√°rios para plotagem do DRAW_COLOR_HISTOGRAM2 √© 3:
¬∑ dois buffers para armazenar a extremidade superior e inferior do segmento vertical em cada barra;
¬∑ um buffer para armazenar o √≠ndice de cor, o qual √© usado para desenhar o segmento (faz sentido
definir apenas valores n√£o vazios).
Um exemplo de indicador que desenha um histograma de uma cor especifica entre os pre√ßos de alta e
baixa. Para cada dia da semana, as linhas de histograma ter uma cor diferente. A cor do dia, a largura
e o estilo do histograma √© alterado aleatoriamente a cada N ticks.
Por favor note que para plot1 com o estilo DRAW_COLOR_HISTOGRAM2, 5 cores s√£o definidas usando
a diretiva de compilador #property, e ent√£o na fun√ß√£o OnCalculate() as cores s√£o selecionadas
aleatoriamente a partir de 14 cores armazenadas no array colors[]. 
 O par√¢metro N √© defindo nos par√¢metros externos do indicador para a possibilidade de configura√ß√£o
manual (na guia Par√¢metros na janela Propriedades do indicador).</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2672
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                        DRAW_COLOR_HISTOGRAM2.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_COLOR_HISTOGRAM2&quot;
#property description &quot;√â desenhado um segmento entre a abertura e fechamento em cada b
#property description &quot;A cor, a largura e o estilo s√£o alterados aleatoriamente&quot;
#property description &quot;depois de cada N ticks&quot;
#property indicator_chart_window
#property indicator_buffers 3
#property indicator_plots   1
//--- plotar ColorHistogram_2
#property indicator_label1  &quot;ColorHistogram_2&quot;
#property indicator_type1   DRAW_COLOR_HISTOGRAM2
//--- Definir 5 cores para colorir o histograma com base nos dias de semana (elas s√£o 
#property indicator_color1  clrRed,clrBlue,clrGreen,clrYellow,clrMagenta
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;              // O n√∫mero de ticks para alterar o histograma
int            color_sections;
//--- Valores de buffers
double         ColorHistogram_2Buffer1[];
double         ColorHistogram_2Buffer2[];
//--- Um buffer de √≠ndices de cor
double         ColorHistogram_2Colors[];
//--- Um array para armazenar as cores que cont√©m 14 elementos
</code></pre>
<p>
color colors[]=
</p>
<pre><code class="language-mql5">
  {
   clrRed,clrBlue,clrGreen,clrChocolate,clrMagenta,clrDodgerBlue,clrGoldenrod,
   clrIndigo,clrLightBlue,clrAliceBlue,clrMoccasin,clrWhiteSmoke,clrCyan,clrMediumPurp
</code></pre>
<p>
  };
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,ColorHistogram_2Buffer1,INDICATOR_DATA);
   SetIndexBuffer(1,ColorHistogram_2Buffer2,INDICATOR_DATA);</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2673
</p>
<pre><code class="language-mql5">
   SetIndexBuffer(2,ColorHistogram_2Colors,INDICATOR_COLOR_INDEX);
//--- Definir um valor vazio
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);
//---- O n√∫mero de cores para a colorir a sen√≥ide
   color_sections=8;   //  Veja um coment√°rio #property indicator_color1
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Mude as cores usadas para desenhar o histograma
      ChangeColors(colors,color_sections);      
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- Calcule os valores do indicador
   int start=0;
//--- Para obter o dia da semana pela abertura de pre√ßo de cada barra
   MqlDateTime dt;
//--- Se j√° foi calculado durante os in√≠cios anteriores do OnCalculate
   if(prev_calculated&gt;0) start=prev_calculated-1; // definir o in√≠cio do c√°lculo com a
//--- Preencher o buffer do indicador com valores
   for(int i=start;i&lt;rates_total;i++)
     {
      TimeToStruct(time[i],dt);
      //--- valor
      ColorHistogram_2Buffer1[i]=high[i];
      ColorHistogram_2Buffer2[i]=low[i];</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2674
</p>
<pre><code class="language-mql5">
      //--- Define o √≠ndice de cores de acordo com o dia da semana
      int day=dt.day_of_week;
      ColorHistogram_2Colors[i]=day;
     }
//--- Retorna o valor de prev_calculated para a pr√≥xima chamada da fun√ß√£o
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a cor dos segmentos de linha¬†                             |
//+------------------------------------------------------------------+
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)
     {
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores
      comm=comm+StringFormat(&quot;HistogramColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToS
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia de uma linha visualizada no indicador¬†        |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco para alterar a largura da linha
   int number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5; // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2675
</p>
<pre><code class="language-mql5">
   comm=comm+&quot; Width=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   int size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=EnumToString(styles[style_index])+&quot;, &quot;+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2676
<h3>DRAW_COLOR_ARROW</h3>
O estilo DRAW_COLOR_ARROW desenha setas coloridas (s√≠mbolos do conjunto Wingdings) baseado no
valor do buffer do indicador. Em contraste com DRAW_ARROW, neste estilo, √© poss√≠vel definir uma
cor partir de um conjunto predefinido de cores especificada pela propriedade indicator_color1 para
cada s√≠mbolo.
A largura e a cor dos s√≠mbolos podem ser especificadas com o estilo DRAW_ARROW ‚Äì usando diretivas
de compilador ou dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das
propriedades de plotagem permitem modificar a apar√™ncia de um indicador com base na situa√ß√£o
atual.
O c√≥digo de s√≠mbolo √© definido usando a propriedade PLOT_ARROW. 
</p>
<pre><code class="language-mql5">
//--- Definir o c√≥digo s√≠mbolo a partir das fontes Wingdings para desenhar em PLOT_ARR
   PlotIndexSetInteger(0,PLOT_ARROW,code);
</code></pre>
<p>
O valor padr√£o do PLOT_ARROW=159 (um c√≠rculo).
Cada seta √© na verdade um s√≠mbolo que tem a altura e o ponto de ancoragem e pode abranger algumas
informa√ß√µes importantes num gr√°fico (por exemplo, o pre√ßo de fechamento da barra). Assim,
podemos adicionalmente especificar o deslocamento vertical em pixels, o qual n√£o depende da escala
do gr√°fico. As setas ser√£o deslocadas para baixo pelo n√∫mero especificado de pixels, embora os
valores do indicador permanecer√£o os mesmos:
</p>
<pre><code class="language-mql5">
//--- Definir o deslocamento vertical das setas em pixels
   PlotIndexSetInteger(0,PLOT_ARROW_SHIFT,shift);
</code></pre>
<p>
Um valor negativo de PLOT_ARROW_SHIFT significa a mudan√ßa de setas para cima, valores positivos
deslocam a seta para baixo.
O estilo DRAW_COLOR_ARROW pode ser usado em separado na sub-janela do gr√°fico e em sua janela
principal. Valores vazios n√£o s√£o desenhados e n√£o aparecem na &quot;Janela de Dados&quot;, todos os valores
nos buffers do indicador devem ser definidos explicitamente. Buffers n√£o s√£o inicializados com o valor
zero.
</p>
<pre><code class="language-mql5">
//--- Definir um valor vazio
   PlotIndexSetDouble(plot_index_DRAW_COLOR_ARROW,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
O n√∫mero de buffers necess√°rios para plotagem de DRAW_COLOR_ARROW √© 2.
¬∑ Um buffer para armazenar o valor do pre√ßo que √© utilizado para desenhar o s√≠mbolo (al√©m de um
deslocamento em pixels, determinado na propriedade PLOT_ARROW_SHIFT);
¬∑ Um buffer para guardar o √≠ndice de cor¬†que √© utilizado para desenhar uma seta(faz sentido
configurar apenas valores n√£o vazios).
Um exemplo de indicador que desenha as setas em cada uma das barras com o pre√ßo mais alto do que
o pre√ßo final da barra anterior. A largura, deslocamento e s√≠mbolo de c√≥digo de todas setas s√£o
alterados aleatoriamente a cada N ticks. A cor do s√≠mbolo depende do n√∫mero da barra na qual est√°
desenhada.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2677
Neste exemplo, para plot1 com o estilo DRAW_COLOR_ARROW, as propriedades, cor e tamanho s√£o
especificadas usando a diretiva de compilador #property, e ent√£o, na fun√ß√£o OnCalculate() as
propriedades s√£o definidas aleatoriamente. O par√¢metro N √© definido nos par√¢metros externos do
indicador para a possibilidade de configura√ß√£o manual (o guia Par√¢metros na janela Propriedades do
indicador).
Por favor, note que inicialmente oito cores s√£o usadas na diretiva de compilador #property, e ent√£o,
na fun√ß√£o OnCalculate(), a cor √© definida aleatoriamente a partir das 14 cores que s√£o armazenadas
no array colors[]. 
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                             DRAW_COLOR_ARROW.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_COLOR_ARROW&quot;
#property description &quot;Desenha setas de diferentes cores definidas pelo caracteres Uni
#property description &quot;A cor, o tamanho, deslocamento e c√≥digo de s√≠mbolo da seta s√£o 
#property description &quot; aleatoriamente a cada N ticks&quot;
#property description &quot;O par√¢metro de c√≥digo define o valor da base: c√≥digo = 159 (um 
#property indicator_chart_window
#property indicator_buffers 2
#property indicator_plots   1
//--- plotar ColorArrow
#property indicator_label1  &quot;ColorArrow&quot;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2678
</p>
<pre><code class="language-mql5">
#property indicator_type1   DRAW_COLOR_ARROW
//--- Define 8 cores para colorir o histograma com base nos dias de semana (eles s√£o a
#property indicator_color1  clrRed,clrBlue,clrSeaGreen,clrGold,clrDarkOrange,clrMagent
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;         // N√∫mero de ticks para mudar
input ushort   code=159;    // C√≥digo s√≠mbolo para desenhar em DRAW_ARROW
int            color_sections;
//--- Um buffer do indicador para plotar
double         ColorArrowBuffer[];
//--- Um buffer para armazenar √≠ndices de cor
double         ColorArrowColors[];
//--- Um array para armazenar as cores que cont√©m 14 elementos
</code></pre>
<p>
color colors[]=
</p>
<pre><code class="language-mql5">
  {
   clrRed,clrBlue,clrGreen,clrChocolate,clrMagenta,clrDodgerBlue,clrGoldenrod,
   clrIndigo,clrLightBlue,clrAliceBlue,clrMoccasin,clrWhiteSmoke,clrCyan,clrMediumPurp
</code></pre>
<p>
  };
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,ColorArrowBuffer,INDICATOR_DATA);
   SetIndexBuffer(1,ColorArrowColors,INDICATOR_COLOR_INDEX);
//--- Definir o c√≥digo s√≠mbolo para desenho em PLOT_ARROW
   PlotIndexSetInteger(0,PLOT_ARROW,code);
//--- Definir o deslocamento vertical das setas em pixels
   PlotIndexSetInteger(0,PLOT_ARROW_SHIFT,5);
//--- Definir como um valor vazio 0
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);   
//---- O n√∫mero de cores para a colorir a sen√≥ide
   color_sections=8;   //  veja um coment√°rio #property indicator_color1
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2679
</p>
<pre><code class="language-mql5">
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcular ticks para mudar a cor, tamanho, deslocamento e c√≥digo da seta
   ticks++;
//--- Se um n√∫mero cr√≠tico de ticks tem sido acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar propriedades de seta
      ChangeLineAppearance();
      //--- Mude as cores usadas para desenhar o histograma
      ChangeColors(colors,color_sections);
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- Bloco para c√°lculo dos valores do indicador
   int start=1;
   if(prev_calculated&gt;0) start=prev_calculated-1;
//--- Calculando loop
   for(int i=1;i&lt;rates_total;i++)
     {
      //--- Se o pre√ßo atual fechado √© mais alto do que o anterior, desenhar uma seta
      if(close[i]&gt;close[i-1])
         ColorArrowBuffer[i]=close[i];
      //--- Caso contr√°rio, especificar o valor nulo
      else
         ColorArrowBuffer[i]=0;
      //--- Cor da seta
      int index=i%color_sections;
      ColorArrowColors[i]=index;
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a cor dos segmentos de linha¬†                             |
//+------------------------------------------------------------------+
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2680
</p>
<pre><code class="language-mql5">
     {
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores
      comm=comm+StringFormat(&quot;ArrowColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToStrin
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia de uma linha visualizada no indicador¬†        |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades de linha
   string comm=&quot;&quot;;
//--- Um bloco para alterar a largura da linha
   int number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5; // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot; Width=&quot;+IntegerToString(width);
   
//--- Um bloco para mudar o c√≥digo das setas (PLOT_ARROW)
   number=MathRand();
//--- Obter o restante da divis√£o de n√∫mero inteiro para calcular um novo c√≥digo da se
   int code_add=number%20;
//--- Definir o novo s√≠mbolo de c√≥digo como o resultado de code+code_add
   PlotIndexSetInteger(0,PLOT_ARROW,code+code_add);
//--- Escreva o c√≥digo de s√≠mbolo PLOT_ARROW
   comm=&quot;\r\n&quot;+&quot;PLOT_ARROW=&quot;+IntegerToString(code+code_add)+comm;   
//--- Um bloco de mudan√ßa do deslocamento vertical das setas em pixels
   number=MathRand();
//--- Obter o deslocamento como o restante da divis√£o inteira
   int shift=20-number%41;
//--- Define um deslocamento a partir de
   PlotIndexSetInteger(0,PLOT_ARROW_SHIFT,shift);
//--- Escrever o deslocamento PLOT_ARROW_SHIFT
   comm=&quot;\r\n&quot;+&quot;PLOT_ARROW_SHIFT=&quot;+IntegerToString(shift)+comm;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2681
</p>
<pre><code class="language-mql5">
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2682
<h3>DRAW_COLOR_ZIGZAG</h3>
O estilo DRAW_COLOR_ZIGZAG desenha segmentos cores diferentes, usando os valores de dois
buffers do indicador. Este estilo √© uma vers√£o colorida de DRAW_ZIGZAG, ou seja, permite a
especificar para cada segmento uma cor individual a partir do conjunto pr√©-definido de cores. Os
segmentos s√£o plotados a partir de um valor no primeiro buffer para um valor no segundo buffer do
indicador. Nenhum dos buffers pode conter somente valores vazios, uma vez que neste caso nada √©
plotado.
A largura, cor e estilo das linhas podem ser especificadas como para o estilo DRAW_ZIGZAG - usando
as diretivas de compila√ß√£o ou dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas
din√¢micas das propriedades de plotagem permitem &quot;avivar&quot; os indicadores, de modo que suas
apar√™ncias sejam alteradas dependendo da situa√ß√£o corrente.
Se√ß√µes s√£o desenhadas a partir de um valor n√£o vazio de um buffer para um valor n√£o vazio de outro
buffer do indicador. Para especificar o valor que deve ser considerado como &quot;vazio&quot;, defina esse valor
na propriedade PLOT_EMPTY_VALUE:
</p>
<pre><code class="language-mql5">
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(index_of_plot_DRAW_COLOR_ZIGZAG,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Sempre preencha explicitamente nos valores dos buffers de indicador, defina um valor vazio num
buffer para saltar barras.
O n√∫mero de buffers requerida para plotagem de DRAW_COLOR_ZIGZAG √© 3:
¬∑ dois buffers para armazenar os valores das extremidades das se√ß√µes em zigue-zague;
¬∑ um buffer para armazenar o √≠ndice de cor, que √© usada para desenhar a se√ß√£o (faz sentido definir
apenas valores n√£o vazios).
Um exemplo de indicador de que plota uma serra com base nos altas e baixas dos pre√ßos. A cor, a
largura e o estilo das linhas em ziguezague alteram aleatoriamente a cada N ticks. </p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2683
Por favor note que para plot1 com o estilo DRAW_COLOR_ZIGZAG, 8 cores s√£o definidas usando a
diretiva de compila√ß√£o #property, e ent√£o na fun√ß√£o OnCalculate() a cor √© selecionada aleatoriamente
a partir de 14 cores armazenadas no array colors[]. 
 O par√¢metro N √© defindo nos par√¢metros externos do indicador para a possibilidade de configura√ß√£o
manual (na guia Par√¢metros na janela Propriedades do indicador).
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                            DRAW_COLOR_ZIGZAG.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_COLOR_ZIGZAG&quot;
#property description &quot;Ele desenha uma linha tracejada, como uma seq√º√™ncia das se√ß√µes 
#property description &quot;A cor, a largura e tamanho dos segmentos s√£o alterados aleatori
#property description &quot; a cada N ticks&quot;
#property indicator_chart_window
#property indicator_buffers 3
#property indicator_plots   1
//--- plotar Color_Zigzag
#property indicator_label1  &quot;Color_Zigzag&quot;
#property indicator_type1   DRAW_COLOR_ZIGZAG
//--- Definir 8 cores para colorir se√ß√µes (eles s√£o armazenados numa array especial)
#property indicator_color1  clrRed,clrBlue,clrGreen,clrYellow,clrMagenta,clrCyan,clrLi
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;              // N√∫mero de ticks para alterar 
int            color_sections;
//--- Buffers dos valores das extremidades do segmento
double         Color_ZigzagBuffer1[];
double         Color_ZigzagBuffer2[];
//--- Buffers do √≠ndice de cores das extremidades dos segmento
double         Color_ZigzagColors[];
//--- Um array para armazenar as cores que cont√©m 14 elementos
</code></pre>
<p>
color colors[]=
</p>
<pre><code class="language-mql5">
  {
   clrRed,clrBlue,clrGreen,clrChocolate,clrMagenta,clrDodgerBlue,clrGoldenrod,
   clrIndigo,clrLightBlue,clrAliceBlue,clrMoccasin,clrWhiteSmoke,clrCyan,clrMediumPurp
</code></pre>
<p>
  };
</p>
<pre><code class="language-mql5">
//--- Um array para armazenar os estilos de linha
</code></pre>
<p>
ENUM_LINE_STYLE styles[]={STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOT
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2684
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,Color_ZigzagBuffer1,INDICATOR_DATA);
   SetIndexBuffer(1,Color_ZigzagBuffer2,INDICATOR_DATA);
   SetIndexBuffer(2,Color_ZigzagColors,INDICATOR_COLOR_INDEX);
//----N√∫mero de corres para colorir o zigzag
   color_sections=8;   //  veja um coment√°rio para a #property indicator_color1
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Calcule ticks para mudar o estilo, cor e largura da linha
   ticks++;
//--- Se um n√∫mero suficiente de ticks foi acumulado
   if(ticks&gt;=N)
     {
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Alterar cores utilizadas para plotar as se√ß√µes
      ChangeColors(colors,color_sections);
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- A estrutura de tempo √© necess√°rio para obter o dia da semana de cada barra
   MqlDateTime dt;
      
//--- A posi√ß√£o inicial dos c√°lculos
   int start=0;
//--- Se o indicador foi calculado com o tick anterior, ent√£o inicia o c√°lculo com o p
   if(prev_calculated!=0) start=prev_calculated-1;
//--- Calculando loop
   for(int i=start;i&lt;rates_total;i++)</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2685
</p>
<pre><code class="language-mql5">
     {
      //--- Escreva o tempo de abertura da barra na estrutura
      TimeToStruct(time[i],dt);
      //--- Se √© ainda o n√∫mero de barra
      if(i%2==0)
        {
         //---  Escrever a alta no primeiro buffer e a baixa no segundo
         Color_ZigzagBuffer1[i]=high[i];
         Color_ZigzagBuffer2[i]=low[i];
         //--- A cor do segmento
         Color_ZigzagColors[i]=dt.day_of_year%color_sections;
        }
      //--- o n√∫mero da barra √© √≠mpar
      else
        {
         //--- Preencha a barra numa ordem inversa
         Color_ZigzagBuffer1[i]=low[i];
         Color_ZigzagBuffer2[i]=high[i];
         //--- A cor do segmento
         Color_ZigzagColors[i]=dt.day_of_year%color_sections;         
        }
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Alterar a cor do segmento zigzag                                 |
//+------------------------------------------------------------------+
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)
     {
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2686
</p>
<pre><code class="language-mql5">
      comm=comm+StringFormat(&quot;ZigzagColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToStri
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Alterar a apar√™ncia dos segmentos zigzag¬†                        |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o da informa√ß√£o sobre as propriedades de Color_ZigZag
   string comm=&quot;&quot;;
//--- Um bloco para alterar a largura da linha
   int number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5;   // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot;\r\nWidth=&quot;+IntegerToString(width);
//--- Um bloco para mudar o estilo da linha
   number=MathRand();
//--- O divisor √© igual ao tamanho do array de estilos
   int size=ArraySize(styles);
//--- Obter o √≠ndice para selecionar um novo estilo como o resto da divis√£o inteira
   int style_index=number%size;
//--- Definir a cor com a propriedade PLOT_LINE_COLOR
   PlotIndexSetInteger(0,PLOT_LINE_STYLE,styles[style_index]);
//--- Escrever o estilo de linha
   comm=&quot;\r\n&quot;+EnumToString(styles[style_index])+&quot;&quot;+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2687
<h3>DRAW_COLOR_BARS</h3>
O estilo DRAW_COLOR_BARS desenha barra sobre valores de quatro buffers de indicador, que cont√©m
Open (abertura), High (alta), Low (baixa) e Close (fechamento) de pre√ßos. Este estilo √© uma vers√£o
avan√ßada do DRAW_BARS e permite a especifica√ß√£o para cada barra de uma cor individual do conjunto
predefinido de cores. √â usado para a cria√ß√£o de indicadores personalizados como barras, incluindo
aqueles numa sub-janela separada de um gr√°fico e sobre outros instrumentos financeiros. 
A cor das barras pode ser definida usando as diretivas de compilador ou dinamicamente utilizando a
fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de plotagem permitem &quot;avivar&quot; os
indicadores, de modo que suas mudan√ßas de apar√™ncia dependem da situa√ß√£o corrente.
O indicador √© desenhado apenas para as barras, para o qual os valores n√£o vazios de todos quatro
buffers do indicador s√£o definidos. Para especificar o valor que deve ser considerado como &quot;vazio&quot;,
defina este valor na propriedade PLOT_EMPTY_VALUE:
</p>
<pre><code class="language-mql5">
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(index_of_plot_DRAW_COLOR_BARS,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Sempre preencher explicitamente os valores dos buffers do indicador, definir um valor vazio num
buffer para ignorar barras.
O n√∫mero requerido de buffers para plotagem de DRAW_COLOR_BARS √© 5:
¬∑ quatro buffers para armazenar Open, High, Low e Close;
¬∑ um buffer para armazenar o √≠ndice das cores, que √© usado para desenhar uma barra(faz sentido
defini-lo apenas para as barras que ser√£o desenhadas).
Todos os buffers para a plotagem devem ir um ap√≥s o outro na ordem determinada: Open, High, Low,
Close e o buffer de cor. Nenhum dos buffers de pre√ßos podem conter valores nulos, uma vez que neste
caso nada √© plotado.
Um exemplo do indicador que desenha barras sobre um instrumento financeiro selecionado numa
janela separada. A cor das barras muda aleatoriamente a cada N ticks. O par√¢metro N √© definido nos
par√¢metro externos do indicador para a possibilidade de configura√ß√£o manual (na guia Par√¢metros na
janela Propriedades do indicador).</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2688
Por favor note que para plot1 com o estilo DRAW_COLOR_BARS, 8 cores s√£o definidas usando a
diretiva de compilador #property, e ent√£o na fun√ß√£o OnCalculate() a cor √© selecionada aleatoriamente
a partir de 14 cores armazenadas no array de colors[]. 
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                              DRAW_COLOR_BARS.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_COLOR_BARS&quot;
#property description &quot;Ele desenha diferentes cores nas barras de um s√≠mbolo seleciona
#property description &quot;A cor e a largura das barras, bem como o s√≠mbolo s√£o alterados 
#property description &quot;cada N ticks&quot;
#property indicator_separate_window
#property indicator_buffers 5
#property indicator_plots   1
//--- plotar ColorBars
#property indicator_label1  &quot;ColorBars&quot;
#property indicator_type1   DRAW_COLOR_BARS
//--- Define 8 cores para colorir barras (elas s√£o armazenadas num array especial)
#property indicator_color1  clrRed,clrBlue,clrGreen,clrYellow,clrMagenta,clrCyan,clrLi
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input int      N=5;              // O n√∫mero de ticks para alterar o tipo</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2689
</p>
<pre><code class="language-mql5">
input int      bars=500;         // O n√∫mero de barras para mostrar
input bool     messages=false;   // Mostrar mensagens no log &quot;Expert Advisors&quot; 
//--- buffers do Indicador
double         ColorBarsBuffer1[];
double         ColorBarsBuffer2[];
double         ColorBarsBuffer3[];
double         ColorBarsBuffer4[];
double         ColorBarsColors[];
//--- Nome do s√≠mbolo
string symbol;
int    bars_colors;
//--- Um array para armazenar as cores que cont√©m 14 elementos
</code></pre>
<p>
color colors[]=
</p>
<pre><code class="language-mql5">
  {
   clrRed,clrBlue,clrGreen,clrChocolate,clrMagenta,clrDodgerBlue,clrGoldenrod,
   clrIndigo,clrLightBlue,clrAliceBlue,clrMoccasin,clrMagenta,clrCyan,clrMediumPurple
</code></pre>
<p>
  };
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,ColorBarsBuffer1,INDICATOR_DATA);
   SetIndexBuffer(1,ColorBarsBuffer2,INDICATOR_DATA);
   SetIndexBuffer(2,ColorBarsBuffer3,INDICATOR_DATA);
   SetIndexBuffer(3,ColorBarsBuffer4,INDICATOR_DATA);
   SetIndexBuffer(4,ColorBarsColors,INDICATOR_COLOR_INDEX);
//---- N√∫mero de cores para colorir as barras
   bars_colors=8;   //  veja uma coment√°rio para a #property indicator_color1
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=0;
//--- Conte ticks para mudar o estilo, cor e largura da barra</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2690
</p>
<pre><code class="language-mql5">
   ticks++;
//--- Se um n√∫mero suficiente de ticks foi acumulado
   if(ticks&gt;=N)
     {
      //--- Selecione um novo s√≠mbolo a partir da janela de observa√ß√£o do Mercado
      symbol=GetRandomSymbolName();
      //--- Alterar as propriedades da linha
      ChangeLineAppearance();
      //--- Mude as cores usadas para desenhar os candlesticks
      ChangeColors(colors,bars_colors);
      int tries=0;
      //--- Fa√ßa 5 tentativas de preencher os buffers com os pre√ßos a partir s√≠mbolo
      while(!CopyFromSymbolToBuffers(symbol,rates_total,bars_colors) &amp;&amp; tries&lt;5)
        {
         //--- Um contador de chamadas da fun√ß√£o CopyFromSymbolToBuffers()
         tries++;
        }
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Preencher os buffers do indicador com pre√ßos¬†                    |
//+------------------------------------------------------------------+
bool CopyFromSymbolToBuffers(string name,int total,int bar_colors)
  {
//--- No array de rates[], vamos copiar Open (abertura), High (alta), Low (baixa) e Cl
   MqlRates rates[];
//--- O contador de tentativas
   int attempts=0;
//--- Quanto foi copiado
   int copied=0;
//--- Fazer 25 tentativas para obter uma s√©rie temporal(timeseries) sobre o s√≠mbolo de
   while(attempts&lt;25 &amp;&amp; (copied=CopyRates(name,_Period,0,bars,rates))&lt;0)
     {
      Sleep(100);
      attempts++;
      if(messages) PrintFormat(&quot;%s Copiar taxas(%s) tentativas=%d&quot;,__FUNCTION__,nome,t
     }
//--- Se falhou em copiar um n√∫mero suficiente de barras
   if(copied!=bars)
     {
      //--- Formar uma mensagem string
      string comm=StringFormat(&quot;Para o s√≠mbolo %s, conseguiu receber somente %d barras
                               name,
                               copied,
                               bars</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2691
</p>
<pre><code class="language-mql5">
                               );
      //--- Mostrar uma mensagem num coment√°rio na janela do gr√°fico principal
      Comment(comm);
      //--- Mostrar a mensagem
      if(messages) Print(comm);
      return(false);
     }
   else
     {
      //--- Definir a exibi√ß√£o do s√≠mbolo
      PlotIndexSetString(0,PLOT_LABEL,name+&quot; Open;&quot;+name+&quot; High;&quot;+name+&quot; Low;&quot;+name+&quot; 
      IndicatorSetString(INDICATOR_SHORTNAME,&quot;DRAW_COLOR_BARS(&quot;+name+&quot;)&quot;);
     }
//--- Inicializar buffers com valores vazios
   ArrayInitialize(ColorBarsBuffer1,0.0);
   ArrayInitialize(ColorBarsBuffer2,0.0);
   ArrayInitialize(ColorBarsBuffer3,0.0);
   ArrayInitialize(ColorBarsBuffer4,0.0);
//--- Copiar os pre√ßos para os buffers
   for(int i=0;i&lt;copied;i++)
     {
      //--- Calcular o √≠ndice apropriado para os buffers
      int buffer_index=total-copied+i;
      //--- Escreva os pre√ßos para os buffers
      ColorBarsBuffer1[buffer_index]=rates[i].open;
      ColorBarsBuffer2[buffer_index]=rates[i].high;
      ColorBarsBuffer3[buffer_index]=rates[i].low;
      ColorBarsBuffer4[buffer_index]=rates[i].close;
      //---
      ColorBarsColors[buffer_index]=i%bar_colors;
     }
   return(true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Aleatoriamente retorna um s√≠mbolo de Observa√ß√£o do Mercado¬†      |
//+------------------------------------------------------------------+
string GetRandomSymbolName()
  {
//--- O n√∫mero de s√≠mbolos mostrada na janela de observa√ß√£o do Mercado
   int symbols=SymbolsTotal(true);
//--- A posi√ß√£o de um s√≠mbolo na lista - um n√∫mero aleat√≥rio de 0 para s√≠mbolos
   int number=MathRand()%symbols;
//--- Retornar o nome de um s√≠mbolo na posi√ß√£o especificada
   return SymbolName(number,true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|  Alterar a cor do segmento zigzag                                |
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2692
</p>
<pre><code class="language-mql5">
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)
     {
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores
      comm=comm+StringFormat(&quot;BarColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToString
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Altera a apar√™ncia das barras¬†                                   |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades da barra
   string comm=&quot;&quot;;
//--- Um bloco para alterar a largura das barras
   int number=MathRand();
//--- Obter a largura do restante da divis√£o inteira
   int width=number%5;   // A largura √© definida de 0 a 4
//--- Definir a cor com a propriedade PLOT_LINE_WIDTH
   PlotIndexSetInteger(0,PLOT_LINE_WIDTH,width);
//--- Escrever a largura da linha
   comm=comm+&quot;\r\nWidth=&quot;+IntegerToString(width);
//--- Escreve o nome do s√≠mbolo
   comm=&quot;\r\n&quot;+symbol+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2693</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2694
<h3>DRAW_COLOR_CANDLES</h3>
O estilo DRAW_COLOR_CANDLES style, como o DRAW_CANDLES, desenha candlesticks usando valores
de quatro buffers de indicador o qual cont√©m Open (abertura), High (alta), Low (baixa) e Close
(fechamento) de pre√ßos. Al√©m disso, ele permite a especifica√ß√£o de uma cor para cada um candlestick
de um determinado conjunto. Para esta finalidade, o estilo tem um buffer de cor especial que
armazena os √≠ndices de cor para cada barra. √â usado para a cria√ß√£o de indicadores personalizados
como uma seq√º√™ncia de candlesticks, incluindo os inseridos numa sub-janela separada de um gr√°fico e
noutros instrumentos financeiros. 
O n√∫mero de cores de candlesticks pode ser definido usando as diretivas de compilador ou
dinamicamente usando a fun√ß√£o PlotIndexSetInteger(). Mudan√ßas din√¢micas das propriedades de
plotagem permitem &quot;avivar&quot; os indicadores, de modo que suas mudan√ßas de apar√™ncia dependem da
situa√ß√£o corrente.
O indicador √© desenhado apenas para as barras, para o qual os valores n√£o vazios de quatro buffers de
pre√ßos do indicador s√£o definidos. Para especificar o valor que deve ser considerado como &quot;vazio&quot;,
defina esse valor na propriedade PLOT_EMPTY_VALUE:
</p>
<pre><code class="language-mql5">
//--- O valor 0 (vazio) n√£o vai participar no desenho
   PlotIndexSetDouble(index_of_plot_DRAW_COLOR_CANDLES,PLOT_EMPTY_VALUE,0);
</code></pre>
<p>
Sempre preencher explicitamente os valores dos buffers do indicador, definir um valor vazio num
buffer para ignorar barras.
O n√∫mero de buffers necess√°rios para plotagem de DRAW_COLOR_CANDLES √© 5:
¬∑ quatro buffers para armazenar Open, High, Low e Close;
¬∑ um buffer para armazenar o √≠ndice de cor, que √© usada para desenhar um candlestick (faz sentido
defini-lo apenas para os candlesticks que ser√£o desenhados).
Todos os buffers para a plotagem devem ir um ap√≥s o outro na ordem determinada: Open, High, Low,
Close e o buffer de cor. Nenhum dos buffers de pre√ßos pode conter apenas valores vazios, uma vez
que, neste caso, nada √© plotado.
Um exemplo de indicador que desenha candlesticks para um instrumento financeiro selecionado em
uma janela separada. A cor dos candlesticks muda aleatoriamente a cada N ticks. O par√¢metro N √©
definido nos par√¢metro externos do indicador para a possibilidade de configura√ß√£o manual (na guia
Par√¢metros na janela Propriedades do indicador).</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2695
Por favor, note que para plot1, a cor √© definida usando a diretiva de compilador #property, e ent√£o,
na fun√ß√£o OnCalculate() a cor √© definida aleatoriamente a partir de uma lista preparada
anteriormente. 
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                           DRAW_COLOR_CANDLES.mq5 |
//|                        Copyright 2011, MetaQuotes Software Corp. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;Copyright 2000-2024, MetaQuotes Ltd.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;
#property description &quot;Um indicador para demonstrar DRAW_COLOR_CANDLES.&quot;
#property description &quot;ele desenha candlesticks de um s√≠mbolo selecionado numa janela 
#property description &quot; &quot;
#property description &quot;A cor e a largura dos candlesticks, bem como o s√≠mbolo s√£o alte
#property description &quot;aleatoriamente a cada N ticks&quot;
#property indicator_separate_window
#property indicator_buffers 5
#property indicator_plots   1
//--- Plotar ColorCandles
#property indicator_label1  &quot;ColorCandles&quot;
#property indicator_type1   DRAW_COLOR_CANDLES
//--- Definir 8 cores para colorir os candlesticks (eles s√£o armazenados na array espe
#property indicator_color1  clrRed,clrBlue,clrGreen,clrYellow,clrMagenta,clrCyan,clrLi
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2696
</p>
<pre><code class="language-mql5">
//--- par√¢metros de entrada
input int      N=5;              // O n√∫mero de ticks para alterar o tipo
input int      bars=500;         // O n√∫mero de candlesticks para mostrar
input bool     messages=false;   // Mostrar mensagens no log &quot;Expert Advisors&quot; 
//--- buffers do Indicador
double         ColorCandlesBuffer1[];
double         ColorCandlesBuffer2[];
double         ColorCandlesBuffer3[];
double         ColorCandlesBuffer4[];
double         ColorCandlesColors[];
int            candles_colors;
//--- Nome do s√≠mbolo
string symbol;
//--- Um array para armazenar as cores que cont√©m 14 elementos
</code></pre>
<p>
color colors[]=
</p>
<pre><code class="language-mql5">
  {
   clrRed,clrBlue,clrGreen,clrChocolate,clrMagenta,clrDodgerBlue,clrGoldenrod,
   clrIndigo,clrLightBlue,clrAliceBlue,clrMoccasin,clrMagenta,clrCyan,clrMediumPurple
</code></pre>
<p>
  };
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- Se as barras s√£o muito pequenas - concluir o trabalho antes do tempo
   if(bars&lt;50)
     {
      Comment(&quot;Por favor, especifique um n√∫mero maior de barras! A opera√ß√£o do indicad
      return(INIT_PARAMETERS_INCORRECT);
     }
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,ColorCandlesBuffer1,INDICATOR_DATA);
   SetIndexBuffer(1,ColorCandlesBuffer2,INDICATOR_DATA);
   SetIndexBuffer(2,ColorCandlesBuffer3,INDICATOR_DATA);
   SetIndexBuffer(3,ColorCandlesBuffer4,INDICATOR_DATA);
   SetIndexBuffer(4,ColorCandlesColors,INDICATOR_COLOR_INDEX);
//--- Um valor vazio
   PlotIndexSetDouble(0,PLOT_EMPTY_VALUE,0);
//--- O nome do s√≠mbolo, para o qual as barras s√£o desenhadas
   symbol=_Symbol;
//--- Definir a exibi√ß√£o do s√≠mbolo
   PlotIndexSetString(0,PLOT_LABEL,symbol+&quot; Open;&quot;+symbol+&quot; High;&quot;+symbol+&quot; Low;&quot;+symb
   IndicatorSetString(INDICATOR_SHORTNAME,&quot;DRAW_COLOR_CANDLES(&quot;+symbol+&quot;)&quot;);
//---- O n√∫mero de cores para a cor dos candlesticks
   candles_colors=8;     //  Veja uma coment√°rio para a #property indicator_color1
//--- 
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2697
</p>
<pre><code class="language-mql5">
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int ticks=INT_MAX-100;
//--- Contar ticks para mudar o estilo e cor
   ticks++;
//--- Se um n√∫mero suficiente de ticks foi acumulado
   if(ticks&gt;=N)
     {
      //--- Selecione um novo s√≠mbolo a partir da janela de observa√ß√£o do Mercado
      symbol=GetRandomSymbolName();
      //--- Alterar a forma
      ChangeLineAppearance();
      //--- Mude as cores usadas para desenhar os candlesticks
      ChangeColors(colors,candles_colors);
      int tries=0;
      //--- Fa√ßa 5 tentativas de preencher os buffers de Plot1 com os pre√ßos a partir 
      while(!CopyFromSymbolToBuffers(symbol,rates_total,0,
            ColorCandlesBuffer1,ColorCandlesBuffer2,ColorCandlesBuffer3,
            ColorCandlesBuffer4,ColorCandlesColors,candles_colors)
            &amp;&amp; tries&lt;5)
        {
         //--- Um contador de chamadas da fun√ß√£o CopyFromSymbolToBuffers()
         tries++;
        }
      //--- Redefinir o contador de ticks para zero
      ticks=0;
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Preenche o candlestick especificado¬†                             |
//+------------------------------------------------------------------+
bool CopyFromSymbolToBuffers(string name,
                             int total,
                             int plot_index,
                             double &amp;buff1[],</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2698
</p>
<pre><code class="language-mql5">
                             double &amp;buff2[],
                             double &amp;buff3[],
                             double &amp;buff4[],
                             double &amp;col_buffer[],
                             int    cndl_colors
                             )
  {
//--- No array de rates[], vamos copiar Open (abertura), High (alta), Low (baixa) e Cl
   MqlRates rates[];
//--- O contador de tentativas
   int attempts=0;
//--- Quanto foi copiado
   int copied=0;
//--- Fazer 25 tentativas para obter uma s√©rie temporal(timeseries) sobre o s√≠mbolo de
   while(attempts&lt;25 &amp;&amp; (copied=CopyRates(name,_Period,0,bars,rates))&lt;0)
     {
      Sleep(100);
      attempts++;
      if(messages) PrintFormat(&quot;%s Copiar taxas(%s) tentativas=%d&quot;,__FUNCTION__,nome,t
     }
//--- Se falhou em copiar um n√∫mero suficiente de barras
   if(copied!=bars)
     {
      //--- Formar uma mensagem string
      string comm=StringFormat(&quot;Para o s√≠mbolo %s, conseguiu receber somente %d barras
                               name,
                               copied,
                               bars
                               );
      //--- Mostrar uma mensagem num coment√°rio na janela do gr√°fico principal
      Comment(comm);
      //--- Mostrar a mensagem
      if(messages) Print(comm);
      return(false);
     }
   else
     {
      //--- Definir a exibi√ß√£o do s√≠mbolo
      PlotIndexSetString(plot_index,PLOT_LABEL,name+&quot; Open;&quot;+name+&quot; High;&quot;+name+&quot; Low;
      IndicatorSetString(INDICATOR_SHORTNAME,&quot;DRAW_COLOR_CANDLES(&quot;+symbol+&quot;)&quot;);
     }
//--- Inicializar buffers com valores vazios
   ArrayInitialize(buff1,0.0);
   ArrayInitialize(buff2,0.0);
   ArrayInitialize(buff3,0.0);
   ArrayInitialize(buff4,0.0);
//--- Sobre cada tick √© copiado pre√ßos para os buffers
   for(int i=0;i&lt;copied;i++)
     {</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2699
</p>
<pre><code class="language-mql5">
      //--- Calcular o √≠ndice apropriado para os buffers
      int buffer_index=total-copied+i;
      //--- Escreva os pre√ßos para os buffers
      buff1[buffer_index]=rates[i].open;
      buff2[buffer_index]=rates[i].high;
      buff3[buffer_index]=rates[i].low;
      buff4[buffer_index]=rates[i].close;
      //--- Definir a cor do candlestick
      int color_index=i%cndl_colors;
      col_buffer[buffer_index]=color_index;
     }
   return(true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Aleatoriamente retorna um s√≠mbolo de Observa√ß√£o do Mercado¬†      |
//+------------------------------------------------------------------+
string GetRandomSymbolName()
  {
//--- O n√∫mero de s√≠mbolos mostrada na janela de observa√ß√£o do Mercado
   int symbols=SymbolsTotal(true);
//--- A posi√ß√£o de um s√≠mbolo na lista - um n√∫mero aleat√≥rio de 0 para s√≠mbolos
   int number=MathRand()%symbols;
//--- Retornar o nome de um s√≠mbolo na posi√ß√£o especificada
   return SymbolName(number,true);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Mudar a cor dos segmentos de candlestick¬†                        |
//+------------------------------------------------------------------+
void  ChangeColors(color  &amp;cols[],int plot_colors)
  {
//--- O n√∫mero de cores
   int size=ArraySize(cols);
//--- 
   string comm=ChartGetString(0,CHART_COMMENT)+&quot;\r\n\r\n&quot;;
//--- Para cada √≠ndice de cor definir uma nova cor aleatoriamente
   for(int plot_color_ind=0;plot_color_ind&lt;plot_colors;plot_color_ind++)
     {
      //--- Obter um valor aleat√≥rio
      int number=MathRand();
      //--- Obter um √≠ndice no array col[] como um resto da divis√£o inteira
      int i=number%size;
      //--- Definir a cor para cada √≠ndice com a propriedade PLOT_LINE_COLOR
      PlotIndexSetInteger(0,                    //  O n√∫mero do estilo gr√°fico
                          PLOT_LINE_COLOR,      //  Identificador da propriedade
                          plot_color_ind,       //  O √≠ndice da cor, onde se escreve a
                          cols[i]);             //  Uma nova cor
      //--- Escrever as cores
      comm=comm+StringFormat(&quot;CandleColorIndex[%d]=%s \r\n&quot;,plot_color_ind,ColorToStri</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2700
</p>
<pre><code class="language-mql5">
      ChartSetString(0,CHART_COMMENT,comm);
     }
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Mudar a apar√™ncia dos candlesticks¬†                              |
//+------------------------------------------------------------------+
void ChangeLineAppearance()
  {
//--- Uma string para a forma√ß√£o de informa√ß√µes sobre as propriedades do candlestick
   string comm=&quot;&quot;;
//--- Escreve o nome do s√≠mbolo
   comm=&quot;\r\n&quot;+symbol+comm;
//--- Mostrar a informa√ß√£o no gr√°fico usando um coment√°rio
   Comment(comm);
</code></pre>
<p>
  }</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2701
Conex√£o entre as propriedades de indicadores e fun√ß√µes
correspondentes
Cada indicador personalizado tem in√∫meras propriedades, algumas das quais s√£o obrigat√≥rias e est√£o
sempre posicionadas no in√≠cio da descri√ß√£o. S√£o as seguintes propriedades:
¬∑ indica√ß√£o 
de 
uma 
janela 
para 
plotar 
o 
indicador 
‚Äì 
indicator_separate_window 
ou
indicator_chart_window;
¬∑ n√∫mero de buffers do indicador ‚Äì indicator_buffers;
¬∑ n√∫mero de plotagem do indicador ‚Äì indicator_plots.
Tamb√©m existem outras propriedades que podem ser definidas tanto atrav√©s das diretivas pr√©
processador como das fun√ß√µes destinadas √† cria√ß√£o do indicador personalizado. Estas propriedades e
fun√ß√µes correspondentes s√£o descritas na seguinte tabela.
<h3>Diretivas para propriedades</h3>
de sub-janela de indicador
<h3>Fun√ß√µes do tipo</h3>
<h3>IndicatorSet...()</h3>
<h3>Descri√ß√£o para ajustar</h3>
propriedades da sub-janela
indicator_height
<h3>IndicatorSetInteger</h3>
(INDICATOR_INDICATOR_HEIG
<h3>HT, nHeight)</h3>
O valor fixo da altura da sub-
janela
indicator_minimum
<h3>IndicatorSetDouble</h3>
(INDICATOR_MINIMUM,
dMaxValue)
<h3>O</h3>
valor 
m√≠nimo 
do 
eixo
vertical
indicator_maximum
<h3>IndicatorSetDouble</h3>
(INDICATOR_MAXIMUM,
dMinValue)
<h3>O valor m√°ximo</h3>
do 
eixo
vertical
indicator_levelN
<h3>IndicatorSetDouble</h3>
(INDICATOR_LEVELVALUE, 
<h3>N-</h3>
1, nLevelValue)
<h3>Valor de eixo vertical para N</h3>
n√≠vel
nenhuma 
diretiva 
de 
pr√©
processador 
<h3>IndicatorSetString</h3>
(INDICATOR_LEVELTEXT, N-1,
sLevelName)
<h3>Nome de um n√≠vel apresentado</h3>
indicator_levelcolor
<h3>IndicatorSetInteger</h3>
(INDICATOR_LEVELCOLOR, N-
1, nLevelColor)
<h3>Cor de N n√≠vel</h3>
indicator_levelwidth
<h3>IndicatorSetInteger</h3>
(INDICATOR_LEVELWIDTH, N-
1, nLevelWidth)
<h3>Largura da linha para N n√≠vel</h3>
indicator_levelstyle
<h3>IndicatorSetInteger</h3>
(INDICATOR_LEVELSTYLE, N-1,
nLevelStyle)
<h3>Estilo de linha para N n√≠vel</h3>
<h3>Diretivas para plotagem de</h3>
propriedades
<h3>Fun√ß√µes do tipo</h3>
<h3>PlotIndexSet...()</h3>
<h3>Descri√ß√£o do ajuste da</h3>
propriedade de plotar</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2702
<h3>Diretivas para propriedades</h3>
de sub-janela de indicador
<h3>Fun√ß√µes do tipo</h3>
<h3>IndicatorSet...()</h3>
<h3>Descri√ß√£o para ajustar</h3>
propriedades da sub-janela
indicator_labelN
<h3>PlotIndexSetString(N-</h3>
1,PLOT_LABEL,sLabel)
<h3>Nome abreviado do N n√∫mero</h3>
de plotar. Ele √© exibido numa
janela de dados e na dica pop-
up quando passa-se o curso
sobre ele
indicator_colorN
<h3>PlotIndexSetInteger(N-1,</h3>
<h3>PLOT_LINE_COLOR, nColor)</h3>
<h3>Cor da linha para N plotagem</h3>
indicator_styleN
<h3>PlotIndexSetInteger(N-1,</h3>
<h3>PLOT_LINE_STYLE, nType)</h3>
<h3>Estilo da linha para N plotagem</h3>
indicator_typeN
<h3>PlotIndexSetInteger(N-1,</h3>
<h3>PLOT_DRAW_TYPE, nType)</h3>
<h3>Tipo de linha para N plotagem</h3>
indicator_widthN
<h3>PlotIndexSetInteger(N-1,</h3>
<h3>PLOT_LINE_WIDTH, nWidth)</h3>
<h3>Largura</h3>
da 
linha 
para 
<h3>N</h3>
plotagem
<h3>Propriedades comum do</h3>
indicador
<h3>Fun√ß√µes do tipo</h3>
<h3>IndicatorSet...()</h3>
<h3>Description</h3>
nenhuma 
diretiva 
de 
pr√©
processador 
<h3>IndicatorSetString</h3>
(INDICATOR_SHORTNAME,
sShortName)
<h3>Define</h3>
o 
nome 
abreviado
conveniente do indicador, que
ser√° 
exibido 
na 
lista 
de
indicadores 
(aberto 
no
terminal pressionando Ctrl+I).
nenhuma 
diretiva 
de 
pr√©
processador 
<h3>IndicatorSetInteger</h3>
(INDICATOR_DIGITS, nDigits)
<h3>Conjuntos necess√°rios</h3>
para
precis√£o 
da 
exibi√ß√£o 
de
valores 
dos 
indicadores 
-
n√∫mero de casas decimais
nenhuma 
diretiva 
de 
pr√©
processador 
<h3>IndicatorSetInteger</h3>
(INDICATOR_LEVELS, nLevels)
<h3>Define o n√∫mero de n√≠veis na</h3>
janela do indicador
indicator_applied_price
<h3>Sem fun√ß√£o, a propriedade</h3>
pode ser definida apenas pela
diretiva pr√© processador.
<h3>Tipo do pre√ßo padr√£o usado</h3>
para o c√°lculo de indicadores.
<h3>Ele √© especificado</h3>
quando
necess√°rio, somente quando o
<h3>OnCalculate() do primeiro tipo</h3>
√© usado.
<h3>O</h3>
valor 
da 
propriedade
tamb√©m pode ser definido a
partir 
do 
di√°logo 
de
propriedades do indicador na
aba &quot;Par√¢metros&quot; - &quot;Aplicar
para&quot;.
Deve notar-se que a numera√ß√£o dos n√≠veis e plotagens em termos de pr√© processador inicia-se com
um, enquanto a numera√ß√£o das mesmas propriedades usando fun√ß√µes inicia-se com zero, ou seja, o
valor indicado deve ser pelo menos um do que o indicado para #property.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2703
Existem v√°rias diretivas, para a qual n√£o existem fun√ß√µes correspondentes:
<h3>Diretiva</h3>
<h3>Description</h3>
indicator_chart_window
<h3>Indicador √© visualizado na janela principal</h3>
indicator_separate_window
<h3>Indicador</h3>
√© 
visualizado 
numa 
sub-janela
separada
indicator_buffers
<h3>N√∫mero necess√°rios de buffers do indicador</h3>
indicator_plots
<h3>N√∫meros de plotagem no indicador</h3></p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2704
<h3>SetIndexBuffer</h3>
 A fun√ß√£o vincula um buffer espec√≠fico de indicador com um array unidimensional din√¢mico do tipo
double.
</p>
<pre><code class="language-mql5">
bool¬† SetIndexBuffer(
   int¬†                   index,¬†        // √≠ndice de buffer
   double¬†                buffer[],¬†     // array
   ENUM_INDEXBUFFER_TYPE¬† data_type¬†     // O que ser√° o armazenado
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
index
[in] N√∫mero do buffer do indicador. A numera√ß√£o inicia com 0. O n√∫mero deve ser inferior ao valor
declarado em #property¬†indicator_buffers.
buffer[] 
[in]  Um array declarado no programa de indicador personalizado.
data_type 
[in] Tipo de dados armazenados no array do indicador. Por padr√£o ele √© INDICATOR_DATA (valores
de c√°lculos do indicador). Ele tamb√©m pode ter o valor de INDICATOR_COLOR_INDEX; neste caso,
este buffer √© usado para armazenar √≠ndices de cor para o buffer do indicador anterior. Voc√™ pode
especificar at√© cores na linha #property¬†indicator_colorN. O valor INDICATOR_CALCULATIONS
significa que o buffer √© usado nos c√°lculos intermedi√°rio do indicador, e n√£o se destina ao
desenho.
<h3>Valor do Retorno</h3>
Com sucesso, retorna true, do contr√°rio - false.
<h3>Observa√ß√£o</h3>
Ap√≥s a vincula√ß√£o, o array buffer[] din√¢mico ser√° indexado como os arrays comuns, mesmo que a
indexa√ß√£o de timeseries seja obrigatoriamente pr√©-instalado para o array. Se voc√™ quiser alterar a
ordem de acesso aos elementos do array do indicador, use a fun√ß√£o ArraySetAsSeries() ap√≥s a
vincula√ß√£o do array usando a fun√ß√£o SetIndexBuffer(). Por favor, note que voc√™ n√£o pode alterar
o tamanho dos arrays din√¢micos definidos como buffers do indicador pela fun√ß√£o SetIndexBuffer().
Para buffers do indicador, todas as opera√ß√µes de altera√ß√£o de tamanho s√£o realizadas pela execu√ß√£o
do sub-sistema do terminal.
<h3>Exemplo:</h3>
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//|                                              TestCopyBuffer1.mq5 |
//|                         Copyright 2000-2024, MetaQuotes Ltd. |
//|                                              https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright &quot;2009, MetaQuotes Software Corp.&quot;
#property link      &quot;https://www.mql5.com&quot;
#property version   &quot;1.00&quot;</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2705
</p>
<pre><code class="language-mql5">
#property indicator_separate_window
#property indicator_buffers 1
#property indicator_plots   1
//---- plotar MA
#property indicator_label1  &quot;MA&quot;
#property indicator_type1   DRAW_LINE
#property indicator_color1  clrRed
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- par√¢metros de entrada
input bool               AsSeries=true;
input int                period=15;
input ENUM_MA_METHOD     smootMode=MODE_EMA;
input ENUM_APPLIED_PRICE price=PRICE_CLOSE;
input int                shift=0;
//--- buffers do indicador
double                   MABuffer[];
int                      ma_handle;
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- mapeamento de buffers do indicador
   if(AsSeries) ArraySetAsSeries(MABuffer,true);
   Print(&quot;Buffer do indicador √© timeseries = &quot;,ArrayGetAsSeries(MABuffer));
   SetIndexBuffer(0,MABuffer,INDICATOR_DATA);
   Print(&quot;Buffer do indicador ap√≥s SetIndexBuffer() √© timeseries = &quot;,
         ArrayGetAsSeries(MABuffer));
   
//--- alterar a ordem dos elementos de acesso do buffer do indicador
   ArraySetAsSeries(MABuffer,AsSeries);
   
   IndicatorSetString(INDICATOR_SHORTNAME,&quot;MA(&quot;+period+&quot;)&quot;+AsSeries);
//---
   ma_handle=iMA(Symbol(),0,period,shift,smootMode,price);
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2706
</p>
<pre><code class="language-mql5">
                const long &amp;volume[],
                const int &amp;spread[])
  {
//--- Copiar os valores da m√©dia m√≥vel no buffer MABuffer
   int copied=CopyBuffer(ma_handle,0,0,rates_total,MABuffer);
   Print(&quot;MABuffer[0] = &quot;,MABuffer[0]);// Dependendo dos valores AsSeries
                                      // Receber√° um valor mais antigo
                                      // Ou para a barra atual inacabada
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
</code></pre>
<p>
<h3>Tamb√©m Veja</h3>
Propriedades dos indicadores personalizados,  Acesso para indicadores e timeseries</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2707
<h3>IndicatorSetDouble</h3>
A fun√ß√£o define o valor da propriedade do indicador correspondente. Propriedade do indicador deve
ser do tipo double. Existem duas variantes da fun√ß√£o.
Chamar especificando o identificador da propriedade.
</p>
<pre><code class="language-mql5">
bool¬† IndicatorSetDouble(
   int¬†    prop_id,¬†          // identificador
   double¬† prop_value¬†        // valor para ser definido
   );
</code></pre>
<p>
Chamar especificando o identificador e o modificador da propriedade.
</p>
<pre><code class="language-mql5">
bool¬† IndicatorSetDouble(
   int¬†    prop_id,¬†          // identificador
   int¬†    prop_modifier,¬†    // modificador
   double¬† prop_value¬†        // valor para ser definido
   )
</code></pre>
<p>
<h3>Par√¢metros</h3>
prop_id
[in]  Identificador da propriedade do indicador. O valor pode ser um dos valores do enumerador
ENUM_CUSTOMIND_PROPERTY_DOUBLE.
prop_modifier
[in]  Modificador da propriedade espec√≠fica. Somente as propriedades de n√≠vel requerem um
modificador. A numera√ß√£o dos n√≠veis a partir do 0. Isso significa que a fim de definir a
propriedade para o segundo n√≠vel, voc√™ precisa determinar 1 (menor que 1 quando usar a diretiva
de compila√ß√£o).
prop_value
[in]  Valor de propriedade.
<h3>Valor do Retorno</h3>
Em caso de execu√ß√£o bem sucedida, retorna true, do contr√°rio - false.
<h3>Observa√ß√£o</h3>
Numera√ß√£o das propriedades (modificadores) come√ßa a partir de 1 (um) quando usa a diretiva de
</p>
<pre><code class="language-mql5">
#property, enquanto que a fun√ß√£o usa numera√ß√£o a partir de (zero). No caso do n√∫mero de n√≠vel ser
</code></pre>
<p>
definido incorretamente, o visor do indicador  pode ser diferente do pretendido.
Por exemplo, o primeiro valor para o indicador de n√≠vel de sub-janela separada pode ser ajustado de
duas maneiras:
¬∑ property indicator_level1  50 - o valor 1 √© utilizado para especificar o n√∫mero de n√≠vel,
¬∑ IndicatorSetDouble(INDICATOR_LEVELVALUE, 0, 50) - 0 √© usado para especificar o primeiro n√≠vel.
Exemplo: indicador inverte para baixo os valores m√°ximo e m√≠nimo da janela do indicador e os
valores de n√≠veis em que as linhas horizontais s√£o colocadas.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2708
</p>
<pre><code class="language-mql5">
#property indicator_separate_window
//--- define o valor m√°ximo e m√≠nimo para a janela do indicador
#property indicator_minimum  0
#property indicator_maximum  100
//--- visualiza tr√™s n√≠veis horizontais na janela separada
#property indicator_level1 25
#property indicator_level2 50
#property indicator_level3 75
//--- definir a espessura dos n√≠veis horizontais
#property indicator_levelwidth 1
//--- definir o estilo dos n√≠veis horizontais
#property indicator_levelstyle STYLE_DOT
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- definir as descri√ß√µes dos n√≠veis horizontais
   IndicatorSetString(INDICATOR_LEVELTEXT,0,&quot;Primeiro N√≠vel (√≠ndice 0)&quot;);
   IndicatorSetString(INDICATOR_LEVELTEXT,1,&quot;Segundo N√≠vel (√≠ndice 1)&quot;);
   IndicatorSetString(INDICATOR_LEVELTEXT,2,&quot;Terceiro N√≠vel (√≠ndice 2)&quot;);
//--- define o mome abreviado para o indicador
   IndicatorSetString(INDICATOR_SHORTNAME,&quot;IndicatorSetDouble() Demo&quot;);
//--- definir a cor para cada n√≠vel
   IndicatorSetInteger(INDICATOR_LEVELCOLOR,0,clrBlue);
   IndicatorSetInteger(INDICATOR_LEVELCOLOR,1,clrGreen);
   IndicatorSetInteger(INDICATOR_LEVELCOLOR,2,clrRed);</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2709
</p>
<pre><code class="language-mql5">
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int tick_counter=0;
   static double level1=25,level2=50,level3=75;
   static double max=100,min=0, shift=100;
//--- calcular ticks
   tick_counter++;
//--- inverter os n√≠veis a cada 10 tick
   if(tick_counter%10==0)
     {
      //--- inverter sinal para os valores de n√≠vel
      level1=-level1;
      level2=-level2;
      level3=-level3;
      //--- inverter sinal para os valores m√°ximos e m√≠nimos
      max-=shift;
      min-=shift;
      //--- inverter o valor de deslocamento
      shift=-shift;
      //--- definir novo valor para n√≠vel
      IndicatorSetDouble(INDICATOR_LEVELVALUE,0,level1);
      IndicatorSetDouble(INDICATOR_LEVELVALUE,1,level2);
      IndicatorSetDouble(INDICATOR_LEVELVALUE,2,level3);
      //--- definir novos valores m√°ximo e m√≠nimo na janela do indicador
      Print(&quot;Set up max = &quot;,max,&quot;,   min = &quot;,min);
      IndicatorSetDouble(INDICATOR_MAXIMUM,max);
      IndicatorSetDouble(INDICATOR_MINIMUM,min);
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3></p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2710
Exemplos de Estilos de Indicador, Conex√£o entre Propriedades do Indicador e Fun√ß√µes, Estilos de
<h3>Desenho</h3></p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2711
<h3>IndicatorSetInteger</h3>
A fun√ß√£o define o valor da propriedade do indicador correspondente. Propriedade do indicador deve
ser do tipo int ou color. Existem duas variantes da fun√ß√£o.
Chamar especificando o identificador da propriedade.
</p>
<pre><code class="language-mql5">
bool¬† IndicatorSetInteger(
   int¬† prop_id,¬†          // identificador
   int¬† prop_value¬†        // valor a ser definido
   );
</code></pre>
<p>
Chamar especificando o identificador e o modificador da propriedade.
</p>
<pre><code class="language-mql5">
bool¬† IndicatorSetInteger(
   int¬† prop_id,¬†          // identificador
   int¬† prop_modifier,¬†    // modificador
   int¬† prop_value¬†        // valor a ser definido
   )
</code></pre>
<p>
<h3>Par√¢metros</h3>
prop_id
[in]  Identificador da propriedade do indicador. O valor pode ser um dos valores do enumerador
ENUM_CUSTOMIND_PROPERTY_INTEGER.
prop_modifier
[in]  Modificador da propriedade espec√≠fica. Somente as propriedades de n√≠vel requerem um
modificador.
prop_value
[in]  Valor de propriedade.
<h3>Valor do Retorno</h3>
Em caso de execu√ß√£o bem sucedida, retorna true, do contr√°rio - false.
<h3>Observa√ß√£o</h3>
Numera√ß√£o das propriedades (modificadores) come√ßa a partir de 1 (um) quando usa a diretiva de
</p>
<pre><code class="language-mql5">
#property, enquanto que a fun√ß√£o usa numera√ß√£o a partir de (zero). No caso do n√∫mero de n√≠vel ser
</code></pre>
<p>
definido incorretamente, o visor do indicador  pode ser diferente do pretendido.
Por exemplo, para definir a espessura da primeira linha horizontal usar o √≠ndice zero:
¬∑ IndicatorSetInteger(INDICATOR_LEVELWIDTH, 0, 5) - √≠ndice 0 √© usado para definir a espessura do
primeiro n√≠vel.
Exemplo: indicador que define a cor, estilo e espessura do indicador de linhas horizontais.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2712
</p>
<pre><code class="language-mql5">
#property indicator_separate_window
#property indicator_minimum 0
#property indicator_maximum 100
//--- visualiza tr√™s n√≠veis horizontais na janela separada
#property indicator_level1 20
#property indicator_level2 50
#property indicator_level3 80
//--- definir a espessura dos n√≠veis horizontais
#property indicator_levelwidth 5
//--- definir a cor dos n√≠veis horizontais
#property indicator_levelcolor clrAliceBlue
//--- definir o estilo dos n√≠veis horizontais
#property indicator_levelstyle STYLE_DOT
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- definir as descri√ß√µes dos n√≠veis horizontais
   IndicatorSetString(INDICATOR_LEVELTEXT,0,&quot;Primeiro N√≠vel (√≠ndice 0)&quot;);
   IndicatorSetString(INDICATOR_LEVELTEXT,1,&quot;Segundo N√≠vel (√≠ndice 1)&quot;);
   IndicatorSetString(INDICATOR_LEVELTEXT,2,&quot;Terceiro N√≠vel (√≠ndice 2)&quot;);
//--- define o mome abreviado para o indicador
   IndicatorSetString(INDICATOR_SHORTNAME,&quot;IndicatorSetInteger() Demo&quot;);
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2713
</p>
<pre><code class="language-mql5">
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
   static int tick_counter=0;
//--- calcular ticks
   tick_counter++;
//--- e calcular as cores dos n√≠veis horizontais, dependendo do contador de tick
   ChangeLevelColor(0,tick_counter,3,6,10); // tr√™s √∫ltimos par√¢metros est√£o comutando
   ChangeLevelColor(1,tick_counter,3,6,8);
   ChangeLevelColor(2,tick_counter,4,7,9);
//--- modificar o estilo dos n√≠veis horizontais
   ChangeLevelStyle(0,tick_counter);
   ChangeLevelStyle(1,tick_counter+5);
   ChangeLevelStyle(2,tick_counter+15);
//--- obter a largura como o restante da divis√£o inteira por 5 ticks
   int width=tick_counter%5;
//--- itera√ß√£o em todos os n√≠veis horizontais e definir espessura
   for(int l=0;l&lt;3;l++)
      IndicatorSetInteger(INDICATOR_LEVELWIDTH,l,width+1);
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Definir a cor da linha horizontal na janela separada do indicador|
//+------------------------------------------------------------------+
void ChangeLevelColor(int level,      // n√∫mero de linha horizontal
                      int tick_number,// dividendo, para obter o n√∫mero do restante da
                      int f_trigger,  // primeiro divisor de comuta√ß√£o de cor
                      int s_trigger,  // segundo divisor de comuta√ß√£o de cor
                      int t_trigger)  // terceiro divisor de comuta√ß√£o de cor
  {
   static color colors[3]={clrRed,clrBlue,clrGreen};
//--- √≠ndice de cor a partir do array colors[]
   int index=-1;
//--- calcular o n√∫mero de cor a partir do array colors[] para pintar linha horizontal
   if(tick_number%f_trigger==0)
      index=0;   // se tick_number divide por f_trigger sem o restante
   if(tick_number%s_trigger==0)
      index=1;   // se tick_number divide por s_trigger sem o restante</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2714
</p>
<pre><code class="language-mql5">
   if(tick_number%t_trigger==0)
      index=2;   // se tick_number divide por t_trigger sem o restante
//--- se a cor est√° definida, estabele√ßa-a      
   if(index!=-1)
      IndicatorSetInteger(INDICATOR_LEVELCOLOR,level,colors[index]);
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Define estilo de linha horizontal na janela do indicador separado|
//+------------------------------------------------------------------+
void ChangeLevelStyle(int level,     // n√∫mero de linha horizontal
                      int tick_number// n√∫mero para obter o resto da divis√£o
                      )
  {
//--- array para armazenar estilos
   static ENUM_LINE_STYLE styles[5]=
     {STYLE_SOLID,STYLE_DASH,STYLE_DOT,STYLE_DASHDOT,STYLE_DASHDOTDOT};
//--- √≠ndice de estilo a partir do array styles[] 
   int index=-1;
//--- calcular o n√∫mero a partir do array styles[] para definir a linha horizontal
   if(tick_number%50==0)
      index=5;   // se tick_number divide por 50 sem o restante, ent√£o o estilo √© STYL
   if(tick_number%40==0)
      index=4;   // ... style is STYLE_DASHDOT
   if(tick_number%30==0)
      index=3;   // ... STYLE_DOT
   if(tick_number%20==0)
      index=2;   // ... STYLE_DASH
   if(tick_number%10==0)
      index=1;   // ... STYLE_SOLID
//--- se o estilo est√° definido, estabele√ßa-o      
   if(index!=-1)
      IndicatorSetInteger(INDICATOR_LEVELSTYLE,level,styles[index]);
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
Propriedades de Indicador Personalizado, Propriedades (#property) de programa, Estilos de Desenho</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2715
<h3>IndicatorSetString</h3>
A fun√ß√£o define o valor da propriedade do indicador correspondente. Propriedade do indicador deve
ser do tipo string. Existem duas variantes da fun√ß√£o.
Chamar especificando o identificador da propriedade.
</p>
<pre><code class="language-mql5">
bool¬† IndicatorSetString(
   int¬†    prop_id,¬†          // identificador
   string¬† prop_value¬†        // valor a ser definido
   );
</code></pre>
<p>
Chamar especificando o identificador e o modificador da propriedade.
</p>
<pre><code class="language-mql5">
bool¬† IndicatorSetString(
   int¬†    prop_id,¬†          // identificador
   int¬†    prop_modifier,¬†    // modificador
   string¬† prop_value¬†        // valor a ser definido
   )
</code></pre>
<p>
<h3>Par√¢metros</h3>
prop_id
[in]  Identificador da propriedade do indicador. O valor pode ser um dos valores do enumerador
ENUM_CUSTOMIND_PROPERTY_STRING.
prop_modifier
[in]  Modificador da propriedade espec√≠fica. Somente as propriedades de n√≠vel requerem um
modificador.
prop_value
[in]  Valor de propriedade.
<h3>Valor do Retorno</h3>
Em caso de execu√ß√£o bem sucedida, retorna true, do contr√°rio - false.
<h3>Observa√ß√£o</h3>
Numera√ß√£o das propriedades (modificadores) come√ßa a partir de 1 (um) quando usa a diretiva de
</p>
<pre><code class="language-mql5">
#property, enquanto que a fun√ß√£o usa numera√ß√£o a partir de (zero). No caso do n√∫mero de n√≠vel ser
</code></pre>
<p>
definido incorretamente, o visor do indicador  pode ser diferente do pretendido.
Por exemplo, na ordem para definir a descri√ß√£o da primeira linha horizontal usar o √≠ndice zero:
¬∑ IndicatorSetString(INDICATOR_LEVELTEXT, 0, &quot;Primeiro N√≠vel&quot;) - √≠ndice 0 √© usado para definir a
descri√ß√£o de texto do primeiro n√≠vel.
Exemplo: indicador que define etiquetas de texto para as linhas horizontais do indicador.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2716
</p>
<pre><code class="language-mql5">
#property indicator_separate_window
#property indicator_minimum 0
#property indicator_maximum 100
//--- visualiza tr√™s n√≠veis horizontais na janela separada
#property indicator_level1 30
#property indicator_level2 50
#property indicator_level3 70
//--- definir a cor dos n√≠veis horizontais
#property indicator_levelcolor clrRed
//--- definir o estilo dos n√≠veis horizontais
#property indicator_levelstyle STYLE_SOLID
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
int OnInit()
  {
//--- definir as descri√ß√µes dos n√≠veis horizontais
   IndicatorSetString(INDICATOR_LEVELTEXT,0,&quot;Primeiro N√≠vel (√≠ndice 0)&quot;);
   IndicatorSetString(INDICATOR_LEVELTEXT,1,&quot;Segundo N√≠vel (√≠ndice 1)&quot;);
   IndicatorSetString(INDICATOR_LEVELTEXT,2,&quot;Terceiro N√≠vel (√≠ndice 2)&quot;);
//--- define o mome abreviado para o indicador
   IndicatorSetString(INDICATOR_SHORTNAME,&quot;IndicatorSetString() Demo&quot;);
//---
   return(INIT_SUCCEEDED);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2717
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
//---
   
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
<h3>Tamb√©m Veja</h3>
Propriedades de Indicador Personalizado, Propriedades (#property) de Programa</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2718
<h3>PlotIndexSetDouble</h3>
A fun√ß√£o define o valor da propriedade correspondente da linha do indicador correspondente. A
propriedade indicador deve ser do tipo double.
</p>
<pre><code class="language-mql5">
bool¬† PlotIndexSetDouble(
   int¬†    plot_index,¬†    // plotando o √≠ndice do estilo
   int¬†    prop_id,¬†       // propriedade identificador
   double¬† prop_value¬†     // valor para ser definido
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
plot_index
[in]  √çndice de plotagem gr√°fica
prop_id
[in] O valor pode ser um dos valores do enumerador ENUM_PLOT_PROPERTY_DOUBLE.
prop_value
[in]  O valor da propriedade.
<h3>Valor do Retorno</h3>
Se com sucesso, retorna true, do contr√°rio false.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2719
<h3>PlotIndexSetInteger</h3>
A fun√ß√£o define o valor da propriedade correspondente da linha do indicador correspondente. A
propriedade do indicador deve ser do tipo int, char, bool ou color. Existem 2 variantes da fun√ß√£o.
Chamar indicando o identificador da propriedade.
</p>
<pre><code class="language-mql5">
bool¬† PlotIndexSetInteger(
   int¬† plot_index,¬†       // plotagem do √≠ndice do estilo
   int¬† prop_id,¬†          // propriedade identificador
   int¬† prop_value¬†        // valor a ser definido
   );
</code></pre>
<p>
Chamar indicando o identificador e o modificador da propriedade.
</p>
<pre><code class="language-mql5">
bool¬† PlotIndexSetInteger(
   int¬† plot_index,¬†       // plotagem do √≠ndice do estilo
   int¬† prop_id,¬†          // propriedade identificador
   int¬† prop_modifier,¬†    // propriedade modificador
   int¬† prop_value¬†        // valor a ser definido
   )
</code></pre>
<p>
<h3>Par√¢metros</h3>
plot_index
[in]  √çndice de plotagem gr√°fica
prop_id
[in] O valor pode ser um dos valores do enumerador ENUM_PLOT_PROPERTY_INTEGER.
prop_modifier
[in]  Modificador da propriedade espec√≠fica. Propriedades de √≠ndice de cor apenas requerem um
modificador.
prop_value
[in]  O valor da propriedade.
<h3>Valor do Retorno</h3>
Se com sucesso, retorna true, do contr√°rio false.
Exemplo: um indicador que desenha uma linha de tr√™s cores. O esquema de cores muda a cada 5
ticks.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2720
</p>
<pre><code class="language-mql5">
#property indicator_chart_window
#property indicator_buffers 2
#property indicator_plots   1
//---- plotar ColorLine
#property indicator_label1  &quot;ColorLine&quot;
#property indicator_type1   DRAW_COLOR_LINE
#property indicator_color1  clrRed,clrGreen,clrBlue
#property indicator_style1  STYLE_SOLID
#property indicator_width1  3
//--- buffers do indicador
double         ColorLineBuffer[];
double         ColorBuffer[];
int            MA_handle;
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
void OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,ColorLineBuffer,INDICATOR_DATA);
   SetIndexBuffer(1,ColorBuffer,INDICATOR_COLOR_INDEX);
//--- obter manipulador MA
   MA_handle=iMA(Symbol(),0,10,0,MODE_EMA,PRICE_CLOSE);
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Obter √≠ndice de cor¬†                                          |
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2721
</p>
<pre><code class="language-mql5">
int getIndexOfColor(int i)
  {
   int j=i%300;
   if(j&lt;100) return(0);// primeiro √≠ndice
   if(j&lt;200) return(1);// segundo √≠ndice
   return(2); // terceiro √≠ndice
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
//---
   static int ticks=0,modified=0;
   int limit;
//--- primeiro c√°lculo ou n√∫mero de barras foi alterado
   if(prev_calculated==0)
     {
      //--- copia valores da MA dentro do buffer do indicador ColorLineBuffer
      int copied=CopyBuffer(MA_handle,0,0,rates_total,ColorLineBuffer);
      if(copied&lt;=0) return(0);// c√≥pia falhou - lan√ßar fora
      //--- agora definir a cor da linha para cada barra
      for(int i=0;i&lt;rates_total;i++)
         ColorBuffer[i]=getIndexOfColor(i);
     }
   else
     {
      //--- copia valores da MA dentro do buffer do indicador ColorLineBuffer
      int copied=CopyBuffer(MA_handle,0,0,rates_total,ColorLineBuffer);
      if(copied&lt;=0) return(0);
      ticks++;// contando ticks
      if(ticks&gt;=5)//√© hora de mudar o esquema de cores
        {
         ticks=0; // zerar o contador
         modified++; // contador de mudan√ßas de cor
         if(modified&gt;=3)modified=0;// zerar o contador
         ResetLastError();
         switch(modified)
           {</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2722
</p>
<pre><code class="language-mql5">
            case 0:// primeiro esquema de cor
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,0,clrRed);
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,1,clrBlue);
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,2,clrGreen);
               Print(&quot;Esquema de cor &quot;+modified);
               break;
            case 1:// segundo esquema de cor
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,0,clrYellow);
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,1,clrPink);
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,2,clrLightSlateGray);
               Print(&quot;Esquema de cor &quot;+modified);
               break;
            default:// terceiro esquema de cor
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,0,clrLightGoldenrod);
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,1,clrOrchid);
               PlotIndexSetInteger(0,PLOT_LINE_COLOR,2,clrLimeGreen);
               Print(&quot;Esquema de cor &quot;+modified);
           }
        }
      else
        {
         //--- definir posi√ß√£o inicial
         limit=prev_calculated-1;
         //--- Agora vamos definir a cor da linha para cada barra
         for(int i=limit;i&lt;rates_total;i++)
            ColorBuffer[i]=getIndexOfColor(i);
        }
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2723
<h3>PlotIndexSetString</h3>
A fun√ß√£o define o valor da propriedade correspondente da linha do indicador correspondente. A
propriedade indicador deve ser do tipo string.
</p>
<pre><code class="language-mql5">
bool¬† PlotIndexSetString(
   int¬†    plot_index,¬†    // plotando o √≠ndice do estilo
   int¬†    prop_id,¬†       // propriedade identificador
   string¬† prop_value¬†     // valor para ser definido
   );
</code></pre>
<p>
<h3>Par√¢metros</h3>
plot_index
[in]  √çndice de representa√ß√£o gr√°fica
prop_id
[in] O valor pode ser um dos valores do enumerador ENUM_PLOT_PROPERTY_STRING.
prop_value
[in]  O valor da propriedade.
<h3>Valor do Retorno</h3>
Se com sucesso, retorna true, do contr√°rio false.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2724
<h3>PlotIndexGetInteger</h3>
A fun√ß√£o define o valor da propriedade correspondente da linha do indicador correspondente. A
propriedade do indicador deve ser do tipo int, color, bool ou char. Existem 2 variantes da fun√ß√£o.
Chamar indicando o identificador da propriedade.
</p>
<pre><code class="language-mql5">
int¬† PlotIndexGetInteger(
   int¬† plot_index,¬†       // plotagem do √≠ndice do estilo
   int¬† prop_id,¬†          // propriedade identificador
   );
</code></pre>
<p>
Chamar indicando o identificador e o modificador da propriedade.
</p>
<pre><code class="language-mql5">
int¬† PlotIndexGetInteger(
   int¬† plot_index,¬†       // plotagem do √≠ndice
   int¬† prop_id,¬†          // propriedade identificador
   int¬† prop_modifier¬†     // propriedade modificador
   )
</code></pre>
<p>
<h3>Par√¢metros</h3>
plot_index
[in]  √çndice de plotagem gr√°fica
prop_id
[in] O valor pode ser um dos valores do enumerador ENUM_PLOT_PROPERTY_INTEGER.
prop_modifier
[in]  Modificador da propriedade espec√≠fica. Propriedades de √≠ndice de cor apenas requerem um
modificador.
<h3>Observa√ß√£o</h3>
Fun√ß√£o √© projetado para extrair as configura√ß√µes do desenho da linha da indicador apropriada. A
fun√ß√£o trabalha em conjunto com a fun√ß√£o PlotIndexSetInteger para copiar as propriedades de
desenho de uma linha para outra.
Exemplo: um indicador que colore as velas dependendo do dia da semana. Cores para cada dia s√£o
criados de uma maneira programada.</p>
<p><h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2725
</p>
<pre><code class="language-mql5">
#property indicator_separate_window
#property indicator_buffers 5
#property indicator_plots   1
//---- plotar ColorCandles
#property indicator_label1  &quot;ColorCandles&quot;
#property indicator_type1   DRAW_COLOR_CANDLES
#property indicator_style1  STYLE_SOLID
#property indicator_width1  1
//--- buffers do indicador
double         OpenBuffer[];
double         HighBuffer[];
double         LowBuffer[];
double         CloseBuffer[];
double         ColorCandlesColors[];
</code></pre>
<p>
color          ColorOfDay[6]={CLR_NONE,clrMediumSlateBlue,
</p>
<pre><code class="language-mql5">
                              clrDarkGoldenrod,clrForestGreen,clrBlueViolet,clrRed};
//+------------------------------------------------------------------+
//| Fun√ß√£o de inicializa√ß√£o do indicador customizado¬†                |
//+------------------------------------------------------------------+
void OnInit()
  {
//--- mapeamento de buffers do indicador
   SetIndexBuffer(0,OpenBuffer,INDICATOR_DATA);
   SetIndexBuffer(1,HighBuffer,INDICATOR_DATA);
   SetIndexBuffer(2,LowBuffer,INDICATOR_DATA);
   SetIndexBuffer(3,CloseBuffer,INDICATOR_DATA);
   SetIndexBuffer(4,ColorCandlesColors,INDICATOR_COLOR_INDEX);
//--- definir o n√∫mero de cores em buffer de cor</p>
<p></code></pre>
<p>
<h3>Indicadores Customizados</h3>
¬© 2000-2025, MetaQuotes Ltd.
2726
</p>
<pre><code class="language-mql5">
   PlotIndexSetInteger(0,PLOT_COLOR_INDEXES,6);
//--- definir cores para o buffer de cores
   for(int i=1;i&lt;6;i++)
      PlotIndexSetInteger(0,PLOT_LINE_COLOR,i,ColorOfDay[i]);
//--- define acuracidade
   IndicatorSetInteger(INDICATOR_DIGITS,_Digits);
   printf(&quot;We have %u colors of days&quot;,PlotIndexGetInteger(0,PLOT_COLOR_INDEXES));
//---
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+
//| Fun√ß√£o de itera√ß√£o do indicador customizado¬†                     |
//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &amp;time[],
                const double &amp;open[],
                const double &amp;high[],
                const double &amp;low[],
                const double &amp;close[],
                const long &amp;tick_volume[],
                const long &amp;volume[],
                const int &amp;spread[])
  {
//---
   int i;
   MqlDateTime t;
//----
   if(prev_calculated==0) i=0;
   else i=prev_calculated-1;
//----
   while(i&lt;rates_total)
     {
      OpenBuffer[i]=open[i];
      HighBuffer[i]=high[i];
      LowBuffer[i]=low[i];
      CloseBuffer[i]=close[i];
      //--- definir a cor de cada vela
      TimeToStruct(time[i],t);
      ColorCandlesColors[i]=t.day_of_week;
      //---
      i++;
     }
//--- valor retorno de prev_calculated para a pr√≥xima chamada
   return(rates_total);
</code></pre>
<p>
  }
</p>
<pre><code class="language-mql5">
//+------------------------------------------------------------------+</p>
<p></code></pre></p>
        </article>
        
        <footer>
            <p>Documenta√ß√£o MQL5 - Fonte: MetaQuotes Ltd.</p>
        </footer>
    </main>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        hljs.highlightAll();
        
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('open');
        }
        
        function filterNav() {
            const filter = document.getElementById('search').value.toLowerCase();
            const items = document.querySelectorAll('.nav-list li');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(filter) ? '' : 'none';
            });
        }
    </script>
</body>
</html>